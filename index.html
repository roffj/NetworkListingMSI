<!DOCTYPE html>
<html>
<head>
<title>Network Listing</title>
<meta charset="UTF-8">

<script src="js/jQuery/jquery-1.11.1.min.js"></script>
<script src="js/jQuery/jquery-ui.min.js"></script>
<script src="js/jQuery/jquery.cookie.js"></script>
<script src="js/jQuery/jquery.blockUI.js"></script>
<script src="js/jQuery/jquery-ui-tabs.js"></script>

<script src="js/app/dialogLoading.js"></script>
<script src="js/app/util.js"></script>
<script src="js/app/RESTUtil_v1.js"></script>

<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyB0wy06coUW9kJYWXA8Gqh-hBkBB17odLw&sensor=true&libraries=geometry,places"></script>

<script type="text/javascript" src="js/drag_sortTable/jquery.dragtable.js"></script>
<script type="text/javascript" src="js/drag_sortTable/jquery.tablesorter.js"></script>
<script type="text/javascript" src="js/drag_sortTable/jquery.tablednd.js"></script>

<script src="js/excellentexport.js"></script>
<script src="js/deepmerge.js"></script>

<script src="js/gmap3/gmap3.min.js"></script> 
<script src="js/gmap3/gmap3-menu.js"></script>

<script src="js/jQuery/jquery.ui.datepicker.js"></script>
<script src="js/jQuery/jquery.contextMenu.js"></script>

<script src="js/app/settingDataManager.js"></script>
<script src="js/app/orgUnitUtil.js"></script>

<script src="js/app/orgUnitPopupManager_v3.js"></script>
<script src="js/app/analyticRelated.js"></script>


<!-- OrgUnit Tree Related -->
<script type="text/javascript" src="js/DHIS/oust.js"></script>


<link rel="stylesheet" href="css/jQuery/jquery-ui.css" />
<link rel="stylesheet" href="css/jQuery/jquery.ui.tabs.css" />
<link rel="stylesheet" href="css/dragtable/dragtable-default.css" type="text/css" />
<link rel="stylesheet" href="css/dragtable/tablednd.css" type="text/css" />
<link rel="stylesheet" href="css/app/style.css">
<!--<link rel="stylesheet" href="css/tablesorter/tablesorter.theme.default.css" />-->
<link rel="stylesheet" href="css/tablesorter/blue/style.css" />
<link rel="stylesheet" href="css/gmap3/gmap3-menu.css" />
<link rel="stylesheet" href="css/jQuery/jquery.contextMenu.css">

<script>

	// ================================
	// -- SetUp Note:
	//		- For data processing count message, we use an sql view
	//			that can be imported via included 'sqlViews metaData.xml'.
	//
	// ================================

	// ================================
	// -- Classes Listing

	// === Core Classes ===
	// - PreLoadProcessManager
	// - OrgUnitAttributeManager
	// - UserSecurityManager
	// - SystemSettingDataManager	<-- In separate JS file.

	// - ProviderNetwork		- entire app class
	// - ViewManager			- view class
	// - OrgUnitSearchManager	- OrgUnit Search Manager Class
	// - DataListingTableManager  - data listing class

	// - ViewServiceManager - 
	// - ViewColumnsTableManager - 

	// - OrgUnitSearchManager	- Search Network/Child orgUnits


	// === Popup Form Classes ===
	// - SettingDataPopupForm	<-- In separate JS file.
	// - ControlsPopupForm
	// - ViewColumnsPopupForm
	// - ViewManagePopupForm
	// - ViewCreatePopupForm
	// - ViewLinkPopupForm
	// - SecuritySettingPopupForm
	// - OrgUnitPopupManager	<-- In separate JS file.
	// - OrgUnitSelectionTreePopup  - OrgUnit Selection Popup


	// === Static Helper Util Classes ===
	// - MsgManager Class	- Message Display Class
	// - AppUtil Class		- Application Helper Class
	// - DBSetting Class	- DHIS Setting Get/Set Helper Class


	// === Common Static Helper Class in JS File ===
	// - DialogLoading Class (Static)
	// - Util Class (Static)		
	// - RESTUtil Class (Static)

	// ================================


	// ================================
	// Global variables/objects
	
	// ------------------------------------
	// -- App Manifest Json (Get this via Synch, so that it is defined ahead)
	var _appManifest = $.parseJSON( RESTUtil.getSynchData( 'manifest.webapp' ) );
	// -- URLs
	var _appURL = _appManifest.activities.dhis.href.replace( '/dhis-web-maintenance-appmanager', '' ) + '/';

	var _dhisURL = _appURL + 'dhis-web-dashboard-integration/index.action';	
	var _queryURL_api = _appURL + 'api/';
	var _queryURL_me = _queryURL_api + "me.json?fields=*,userGroups[id,name],userCredentials[username,userRoles[name,authorities]]";
	var _queryURL_appTitle = _queryURL_api + 'systemSettings?key=applicationTitle';
	var _queryURL_OrgUnit = _queryURL_api + "organisationUnits";
	var _queryURL_OrgUnitLevels = _queryURL_api + 'organisationUnitLevels.json?paging=false&fields=level,name,id';

	var _loginPagePopupForm;
	var _preLoadProcessManager;
	var _providerNetwork;

	var _param_viewId = "viewId";

	var _enable_ColumnDrag = true;
	var _enable_TableSorting = true;

	var _disableSorting = false;

	var _deploymentManagerId = 'jamesc'; // userID for some feature on 'Config' popup - 'latest version number update.

	var _mode_Edit = "Edit";
	var _mode_View = "View";
	var _mode_Add = "Add";

	// --------------
	var _middleSpeed = 400;
	var _fastSpeed = 400;

	var _appSetting = { "msgAutoHide": true };
	// ================================


	// =========================================================
	// On Page Load Run

	$( document ).ready( function() 
	{
		_preLoadProcessManager = new PreLoadProcessManager( function( loadedInfo )
		{
			// Network Setting Data Manager create and pass in.
			var networkSettingDataManager = new SystemSettingDataManager( "App_ProdiverNetwork_Settings" );

			// Perform some initial action on Network Setting Data..
			PNSettingDataManager.networkSettingDataInitialAction( networkSettingDataManager, _preLoadProcessManager.userSecurityManager, function( settingData )
			{
				_providerNetwork = new ProviderNetwork( networkSettingDataManager, _preLoadProcessManager.orgUnitAttributeManager, _preLoadProcessManager.userSecurityManager, loadedInfo );

				//var providerMetricsToolManage = new ProviderMetricsToolManage( $( 'div.customTabDiv' ) );
				//providerMetricsToolManage.run();

			});
		});
	});



	// =========================================================
	//  Classes

	function PreLoadProcessManager( executeFunc )
	{
		var me = this;
		
		me.orgUnitAttributeManager;
		me.userSecurityManager;

		me.status_orgUnitLevelsInfoSet = false;
		me.status_orgUnitAttributeSet = false;
		me.status_userSecuritySet = false;
		me.status_checkOUParents = false;
		me.status_checkDhisVersion = false;

		me.loadedInfo = { "ouParentsExists": false, "dhisVersion": undefined, "orgUnitLevelsInfo": undefined, "userInfo": undefined };

		me.executeFunc = executeFunc;


		// -----------------------------------------------

		me.preLoadProcess = function()
		{
			// Start the form hiding
			MsgManager.appBlock( "Preload Step Processing" );

			me.getOrgUnitLevelsInfo( function( orgUnitLevelsInfo )
			{
				me.loadedInfo.orgUnitLevelsInfo = orgUnitLevelsInfo;

				me.status_orgUnitLevelsInfoSet = true;

				me.checkAllProcessFinished_AndExecute();
			});


			me.orgUnitAttributeManager.performSetup( function()
			{
				me.status_orgUnitAttributeSet = true;

				me.checkAllProcessFinished_AndExecute();
			});


			me.userSecurityManager.performSetup( function( oUserSecurityManager)
			{
				me.status_userSecuritySet = true;

				me.loadedInfo.userInfo = oUserSecurityManager.userInfo;

				me.checkAllProcessFinished_AndExecute();
			});

			
			me.checkOrgUnitParents( function( found )
			{
				me.loadedInfo.ouParentsExists = found;

				me.status_checkOUParents = true;

				me.checkAllProcessFinished_AndExecute();
			});

			
			AppUtil.getDhisVersion( function( dhisVersion )
			{
				me.loadedInfo.dhisVersion = dhisVersion;

				me.status_checkDhisVersion = true;

				me.checkAllProcessFinished_AndExecute();
			});
				
		};


		me.checkAllProcessFinished_AndExecute = function()
		{
			if ( me.status_orgUnitLevelsInfoSet && me.status_orgUnitAttributeSet && me.status_userSecuritySet && me.status_checkOUParents && me.status_checkDhisVersion ) 
			{
				MsgManager.appUnblock();

				// Finish this class and return with me.loadedInfo
				me.executeFunc( me.loadedInfo );
			}
		}

		// -----------------------------------------------


		me.getOrgUnitLevelsInfo = function( returnFunc )
		{
			RESTUtil.getAsynchData( _queryURL_OrgUnitLevels, function( json_Data )
			{
				if ( json_Data !== undefined && json_Data.organisationUnitLevels !== undefined )
				{
					returnFunc( json_Data.organisationUnitLevels );
				}
			}
			, function() { alert( 'Failed to retrieve organisationUnit Level Info.  Please resolve this first.' ); }
			);		
		}


		me.checkOrgUnitParents = function( returnFunc )
		{
			var queryURL = _queryURL_OrgUnit + '.json?level=1&fields=id,name,parents,ancestors';

			RESTUtil.getAsynchData( queryURL, function( json_Data )
			{
				if ( json_Data !== undefined && json_Data.organisationUnits && json_Data.organisationUnits.length > 0 )
				{
					var firstOu = json_Data.organisationUnits[0];

					returnFunc( ( firstOu.ancestors !== undefined || firstOu.parents !== undefined ) );
				}
				else
				{
					alert( 'Failed to find top level orgUnits via Web API' );
				}
			}
			, function() { alert( 'Failed during top level orgUnit Web API data retrieval - for checking "parents" and "ancestors".' ); }
			);			
		};


		// -----------------------------------------------

		me.initialSetup = function()
		{						
			_loginPagePopupForm = new LoginPagePopupForm();

			AppUtil.checkAndRedirect_DHISSession( function()
			{
				MsgManager.initialSetup();

				// instanticate the managers
				me.orgUnitAttributeManager = new OrgUnitAttributeManager();		
				me.userSecurityManager = new UserSecurityManager();	

				me.preLoadProcess();
			});
		};


		// Initial Setup Call
		me.initialSetup( );
	}


	function OrgUnitAttributeManager()
	{
		var me = this;

		me.basicAttributeList = [
				{ name: "ID", value: "id", mandatory : false, length : 11, valueType : "string" }
				,{ name: "Name", value: "name", mandatory : true, length : 230, valueType : "string" }
				,{ name: "Display name", value: "displayName", mandatory : false, length : 230, valueType : "string" }
				,{ name: "Short name", value: "shortName", mandatory : true, length : 50, valueType : "string" }
				,{ name: "Description", value: "description", mandatory : false, valueType : "string" }
				,{ name: "Code", value: "code", mandatory : false, length : 50, valueType : "string" }
				,{ name: "Opening date", value: "openingDate", mandatory : true, valueType : "date" }
				,{ name: "Closed date", value: "closedDate", mandatory : false, valueType : "date" }
				//,{ name: "Registers data", value: "active", mandatory : false, length : 5, valueType : "bool" }
				,{ name: "Comment", value: "comment", mandatory : false, valueType : "string" }
				,{ name: "Feature type", value: "featureType", mandatory : false, length : 50, valueType : "string", hidden: true }
				,{ name: "Coordinates", value: "coordinates", mandatory : false, valueType : "string" , hidden: true }
				,{ name: "URL", value: "url", mandatory : false, length : 255, valueType : "string" }
				,{ name: "Contact person", value: "contactPerson", mandatory : false, length : 255, valueType : "string" }
				,{ name: "Address", value: "address", mandatory : false, length : 255, valueType : "string" }
				,{ name: "Email", value: "email", mandatory : false, length : 150, valueType : "string" }
				,{ name: "Phone number", value: "phoneNumber", mandatory : false, length : 150, valueType : "string" }
			];

		// Full Attribute JSON info
		me.orgUnitDynamicAttributeList = [];

		// Name/value pair data listing of basic AttributeList + Dynamic List
		me.orgUnitAttributeList = [];
		
		// Name/value pair OUGS listing
		me.orgUnitGroupSetList = [];
		// -----------------------------------------------------


		me.getOrgUnitAttributeList = function()
		{
			return me.orgUnitAttributeList;
		};
		
		me.getOrgUnitGroupSetList = function()
		{
			return me.orgUnitGroupSetList;
		};

		me.getDynamicAttributeList = function()
		{
			return me.orgUnitDynamicAttributeList;
		};

		me.retrieveOrgUnitDynamicAttrs = function( runFunc )
		{
			var queryURL = _queryURL_api + 'attributes.json?paging=false&filter=organisationUnitAttribute:eq:true&fields=id,name,displayName,valueType,mandatory';

			// We can not call this again since typeList gets larger?
			RESTUtil.retrieveManager.retrieveData( queryURL
			, function( json_attrs ) 
			{
				var orgUnitAttributes = [];
				
				var listOrdered = Util.sortByKey( json_attrs.attributes, "displayName" );

				$.each( listOrdered, function( i_attr, item_attr )
				{
					orgUnitAttributes.push( item_attr );
				});

				//setTimeout( function() { }, 2000 );
				runFunc( orgUnitAttributes );

			}
			, function()
			{
				alert( 'Failed to load OrgUnit Dynamic Attributes' );
			});

		};

		me.retrieveOrgUnitGroupSets = function( runFunc )
		{
			var queryURL = _queryURL_api + 'organisationUnitGroupSets.json?paging=false&fields=name,displayName,id,organisationUnitGroups[id,name,displayName]';

			// We can not call this again since typeList gets larger?
			RESTUtil.retrieveManager.retrieveData( queryURL
			, function( json_Data ) 
			{
				var ouGroupSets = Util.sortByKey( json_Data.organisationUnitGroupSets, "displayName" );
				runFunc( ouGroupSets );
			}
			, function()
			{
				alert( 'Failed to load OrgUnit Group Sets' );
			});

		};

		me.checkAllProcessFinished = function()
		{
			return ( me.status_OUAttributes && me.status_OrgUnitGroupSets ); 
		};
		
		me.retrieveAndSet_OUAttributes = function( runFunc )
		{

			// Copy the basic attributes
			$.each( me.basicAttributeList, function( i_att, item_att )
			{
				me.orgUnitAttributeList.push( item_att );
			});


			// Retrieve and set dynamic attributes
			me.retrieveOrgUnitDynamicAttrs( function( json_attr )
			{
				$.each( json_attr, function( i_attr, item_attr )
				{
					me.orgUnitDynamicAttributeList.push( item_attr );

					me.orgUnitAttributeList.push( { name: item_attr.displayName, value: AppUtil.dynamicAttrStr + item_attr.id } );
				});

				me.status_OUAttributes = true;

				if( me.checkAllProcessFinished() ){
					// Run the runFunc
					if( runFunc !== undefined ) runFunc( me );
					FormBlock.block( false );
				}
			});
			
			me.retrieveOrgUnitGroupSets( function( json_ouGroupSets )
			{
				me.orgUnitGroupSetList = json_ouGroupSets;

				me.status_OrgUnitGroupSets = true;
				// Run the runFunc
				if( me.checkAllProcessFinished() ){
					// Run the runFunc
					if( runFunc !== undefined ) runFunc( me );
					FormBlock.block( false );
				}
				
			});
		}
		

		me.performSetup = function( returnFunc )
		{
			me.retrieveAndSet_OUAttributes( function() { returnFunc( me ); } );
		};


		// ========================================================

		me.initialSetup = function( )
		{	
		};

		// Initial Setup Call
		me.initialSetup( );
	}


	function UserSecurityManager( oProviderNetwork )
	{
		var me = this;
		
		me.oProviderNetwork = oProviderNetwork;

		me.userInfo;
		me.userGroups = [];

		// -----------------------------------------------------

		me.getUserId = function()
		{
			return me.userInfo.id;
		};

		me.getUserName = function()
		{
			return me.userInfo.name;
		};

		me.getUserLoginId = function()
		{
			return me.userInfo.userCredentials.username;
		};

		me.isAppSuperUser = function()
		{
			var userLoginId = me.getUserLoginId();

			return ( userLoginId == "jamesc" || userLoginId == "rmelia" || userLoginId == "apptester" || userLoginId == "tranc"	);
		};

		me.isSecretUser = function()
		{
			var userLoginId = me.getUserLoginId();

			return ( userLoginId == "jamesc" || userLoginId == "tranc"  );
		};

		me.getInitialSecurity = function()
		{
			return { "owner": { "id": me.getUserId(), "name": me.getUserName()}, "permissions": [] };
		};

		me.existsInUserGroups = function( userGroupId )
		{
			return Util.checkExistInList( me.userGroups, userGroupId );
		};

		me.existsInUserGroupsWithList = function( permissions, permType )
		{
			// permissions - [], { 'id': selectedVal, 'type': 'Edit' }
			var permit = false;

			$.each( permissions, function( i_pm, item_pm )
			{
				var permTypeOK = false;

				if ( permType == 'Edit' )
				{
					if ( item_pm.type == 'Edit' ) permTypeOK = true;
				}
				else if ( permType == 'View' )
				{
					if ( item_pm.type == 'View' || item_pm.type == 'Edit' ) permTypeOK = true;
				}

				if ( permTypeOK )
				{
					if ( Util.checkExistInList( me.userGroups, item_pm.id ) )
					{
						permit = true;
						return false;
					}
				}
			});

			return permit;
		};


		me.getUserPermission_OrgUnitAccess = function()
		{
			return { "Editable" : me.userInfo.organisationUnits, "Viewable" : me.userInfo.dataViewOrganisationUnits };
		}


		me.getUserPermission_Authorities = function()
		{
			var authorities = { "OrgUnit_Edit": false
							, "OrgUnit_Move": false
							, "Network_Edit": false
							, "View_Edit": false
							};

			var roleAuthorities = me.getRoleAuthorities();

			//console.log( '==== roleAuthorities: ' + JSON.stringify( roleAuthorities ) );
			
			var hasSuperUserRole = ( roleAuthorities.indexOf( "ALL" ) >= 0 );

			if ( hasSuperUserRole )
			{
				authorities.OrgUnit_Edit = true;
				authorities.OrgUnit_Move = true;
				authorities.Network_Edit = true;
				authorities.View_Edit = true;
			}
			else
			{
				authorities.OrgUnit_Edit = ( roleAuthorities.indexOf( "F_ORGANISATIONUNIT_ADD" ) >= 0 );
				authorities.OrgUnit_Move = ( roleAuthorities.indexOf( "F_ORGANISATIONUNIT_MOVE" ) >= 0 );


				var userGroups = me.userInfo.userGroups;

				authorities.Network_Edit = Util.checkExistInList( userGroups, "Network App - Network Creation", "name" );
				authorities.View_Edit = Util.checkExistInList( userGroups, "Network App - View Creation", "name" );
			}

			return authorities;
		}


		me.getRoleAuthorities = function()
		{
			var authorities = [];

			$.each( me.userInfo.userCredentials.userRoles, function( i_role, item_role )
			{
				$.each( item_role.authorities, function( i_auth, item_auth )
				{
					authorities.push( item_auth );
				});
			});

			return authorities;
		}


		// -----------------------------------------------------

		me.retrieveUserInfo = function( runFunc )
		{			
			RESTUtil.retrieveManager.retrieveData( _queryURL_me
			, function( json_Data ) 
			{
				me.userInfo = json_Data;

				if ( json_Data.userGroups !== undefined )
				{					
					me.userGroups = json_Data.userGroups;
				}

				runFunc();
			});
		};


		// This gets called on preload step of the main
		me.performSetup = function( returnFunc )
		{
			me.retrieveUserInfo( function()
			{
				// Run the runFunc
				returnFunc( me );
			});
		};


		// ========================================================

		me.initialSetup = function( )
		{	
		};

		// Initial Setup Call
		me.initialSetup();
	}



	// -------------------------------------------
	// Class - ProviderNetwork
	//			- The main class.  This class represents the entire ProviderNetwork, thus, includes all the class/object.
	function ProviderNetwork( systemSettingDataManager, orgUnitAttributeManager, userSecurityManager, loadedInfo )
	{
		var me = this;

		me.systemSettingDataManager = systemSettingDataManager;
		me.orgUnitAttributeManager = orgUnitAttributeManager;
		me.userSecurityManager = userSecurityManager;
		me.loadedInfo = loadedInfo;  //{ "ouParentsExists": false };

		// Classes
		me.settingDataPopupForm;
		me.controlsPopupForm;
		me.securitySettingPopupForm;
		me.configDialogForm;

		me.viewManager;
		me.dataListingTableManager;

		me.orgUnitSearchManager;
		
			
		// Tags
		me.settingPopupFormOpenTag = $( '#settingPopupFormOpen' );
		//me.controlsPopupFormOpenTag = $( '#controlsPopupFormOpen' );
		me.configPopupFormOpenTag = $( '#configPopupFormOpen' );

		me.configControlSectionTag = $( 'div.configControlSection' );
		me.settingControlSectionTag = $( 'div.settingControlSection' );
		//me.divControlsPopupFormOpenTag = $( '#divControlsPopupFormOpen' );

		me.settingDialogFormTag = $( '#settingDialogForm' );
		me.sectionNetworkListTag = $( '#sectionNetworkList' );

		me.sectionNetworkListLoadingTag = $( '#sectionNetworkListLoading' );

		me.divViewOUSearchSectionTag = $( '#divViewOUSearchSection' );


		// Memory Variables
		me.network_Name = "Network";
		me.networkChild_Name = "NetworkChild";

		me.networkSettingData_simplified;

		me.networkAttributeValueList;
		me.networkChildAttributeValueList;

		me.networkData; 

		me.pivotLevelColor = "#F2F8FF";  // #EAF8FF

		// -----------------------------------------------


		// =============================================
		// ---- initial Setup and Related --------------

		me.initialSetup = function()
		{

			me.InitializeObjects();

			// Setup Top Section button clicks and visibility
			me.setupTopSection( me.userSecurityManager );


			// Check the latest version and alert - for cached older version on user browser.
			me.configDialogForm.checkForLatestVersion();


			// Populate Network Lists
			me.populateNetworkList_Default();

			// Events
			me.setUpEvent_NetworkSelection( me.sectionNetworkListTag );

			// Set visibility by user permission
			me.setVisibility_ByUserPermission( me.getUserPermission_Authorities() );

			// Detect parameter and perform action
			me.detectParameterAndAction();


			me.setUp_ViewOUSearchToggling();


			// Set for REST Testing Section..//me.setUpRESTTest();
		};



		me.setUp_ViewOUSearchToggling = function()
		{
			$( '#divViewSection' ).click( function() 
			{
				me.switchSectionToggling( $( '#divViewSection' ), $( '#divNetworkViewList' ), $( '#divOuSearchSection' ), $( '#divOuSearch' ), function() {} );
			});

			$( '#divOuSearchSection' ).click( function() 
			{
				me.switchSectionToggling( $( '#divOuSearchSection' ), $( '#divOuSearch' ), $( '#divViewSection' ), $( '#divNetworkViewList' ), function()
				{
					$( '#orgUnitName' ).val( '' ).focus();
				});
			});
		}


		me.switchSectionToggling = function( selectedSectionTag, selectedContentTag, nonSelectedSectionTag, nonSelectedContentTag, afterShowAction )
		{
			var toggleSpeed = 300;

			selectedSectionTag.removeClass( 'switchSection_Off' ).attr( 'title', '' ).find( '.divSectionTitle' ).removeClass( 'divSectionTitle_Off' );
			
			// 'font-weight', 'bold' ).css( 'font-weight', 'bold' );			
			nonSelectedSectionTag.addClass( 'switchSection_Off' ).attr( 'title', 'Click to expand' ).find( '.divSectionTitle' ).addClass( 'divSectionTitle_Off' );
			

			selectedContentTag.show( toggleSpeed, afterShowAction );
			nonSelectedContentTag.hide( toggleSpeed );
		}


		// Move to other places....
		me.setVisibility_ByUserPermission = function( authorities )
		{	
			//if ( me.isAppSuperUser() ) me.divControlsPopupFormOpenTag.show();

			if ( authorities.Network_Edit ) me.settingControlSectionTag.show();
			// For now, put it over here..  But move it later~~  Make it more secure..
		}


		me.InitializeObjects = function()
		{
			// Instantiate the objects..
			me.settingDataPopupForm = new SettingDataPopupForm( me, me.settingDialogFormTag, me.systemSettingDataManager, me.orgUnitAttributeManager );

			//me.controlsPopupForm = new ControlsPopupForm( me );
			me.configDialogForm = new ConfigDialogForm();

			me.securitySettingPopupForm = new SecuritySettingPopupForm( me );

			me.viewManager = new ViewManager( me, me.orgUnitAttributeManager, me.settingDataPopupForm );

			me.dataListingTableManager = new DataListingTableManager( me );


			me.orgUnitSearchManager = new OrgUnitSearchManager( me, me.userInfo, me.onOrgUnitSelect_FromSearch );
		};

		// ---- initial Setup and Related --------------
		// ---------------------------------------------


		// ----------------------------------------
		// -- Event Related ---------
		
		me.setUpEvent_NetworkSelection = function( sectionNetworkListTag )
		{
			sectionNetworkListTag.change( function()
			{				
				var selectedNetwork = $( this ).val();

				me.resetSection_Network();

				if ( selectedNetwork != "" )
				{
					me.setNetworkAttributeValueList( selectedNetwork );
					me.setNetworkChildAttributeValueList( selectedNetwork );

					me.retrieveNetworkData( selectedNetwork, function( networkData )
					{
						// Set it as saved variable
						me.setNetworkData( networkData );

						// Call this on ViewManager
						me.viewManager.populateNetworkView();
						me.divViewOUSearchSectionTag.show( 'medium' );
					});
				}

			});
		};


		me.onOrgUnitSelect_FromSearch = function( orgUnit )
		{
			var networkSettingData = me.getSelectedNetworkData();

			var orgUnitEditPermission = me.checkOrgunitEditPermission( orgUnit );
			var viewMode = ( orgUnitEditPermission ) ? _mode_Edit : _mode_View;

			me.dataListingTableManager.orgUnitPopupManager.openForm( networkSettingData.countryInfo, orgUnit.level, me.network_Name, viewMode, orgUnit.id, orgUnit.name );
		};


		// -- Event Related ---------
		// ----------------------------------------
		// ========================================


		// =======================================
		// Exposed Methods - Interfaces..

		me.getPivotLevelColor = function()
		{
			return me.pivotLevelColor;
		};

		// ----- User Info Related ----
		me.getUserId = function() 
		{ 
			return me.userSecurityManager.getUserId(); 
		};

		me.getUserName = function() 
		{ 
			return me.userSecurityManager.getUserName(); 
		};

		me.isAppSuperUser = function() 
		{ 
			return me.userSecurityManager.isAppSuperUser(); 
		};

		me.isSecretUser = function() 
		{ 
			return me.userSecurityManager.isSecretUser(); 
		};

		me.getUserPermission_OrgUnitAccess = function() 
		{ 
			return me.userSecurityManager.getUserPermission_OrgUnitAccess(); 
		};

		me.getUserPermission_Authorities = function()
		{
			return me.userSecurityManager.getUserPermission_Authorities();
		};

		// ----------------------------

		// ----- Network Related -----			
		me.getSelectedNetworkVal = function() 
		{ 
			return me.sectionNetworkListTag.val(); 
		};

		me.getSelectedNetworkName = function() 
		{ 
			return me.sectionNetworkListTag.find( 'option:selected' ).text(); 
		};

		me.getSelectedNetworkData = function() 
		{ 
			return me.networkData; 
		};

		me.setNetworkData = function( networkData )
		{
			me.networkData = networkData; 
		};

		me.populateNetworkList = function( sectionNetworkList )
		{
			me.sectionNetworkListTag.empty();

			var newList = new Array();
			
			$.each( sectionNetworkList, function( i, item )
			{
				if ( item != "General" ) newList.push( item );
			});

			Util.populateSelect( me.sectionNetworkListTag, "Section", newList, "Array" );
		};
		// --------------------------------

		// ----- Network View Related -----		
		me.getViewSecurityPermission = function( permType, viewId, returnFunc ) 
		{ 
			me.viewManager.getViewSecurityPermission( permType, viewId, returnFunc ); 
		};
		
		// --------------------------------

		// ----- View Column Table Related -----		

		me.getViewQueryStrParameters = function()
		{
			return me.viewManager.getViewQueryStrParameters();
		};

		me.getViewColumnRowData = function( rowTag )
		{
			return me.viewManager.getViewColumnRowData( rowTag );
		};

		me.getViewColumnsTableSortings = function()
		{
			return me.viewManager.getViewColumnsTableSortings();
		};
		
		me.getViewData = function()
		{
			return me.viewManager.viewColumnsTableManager.viewData;
		};
		
		// --------------------------------

		// ----- DataListingTable Related -----

		me.getDataListingTableTag = function()
		{
			return me.dataListingTableManager.getDataListingTableTag();
		};

		me.runBtnSectionVisibility = function( show )
		{
			me.dataListingTableManager.runBtnSectionVisibility( show );
		};

		me.setUp_DataListingColumns = function( columnsTableTag )
		{
			me.dataListingTableManager.setUp_DataListingColumns( columnsTableTag );
		};

		me.rerunDataListing = function()
		{
			me.dataListingTableManager.rerunDataListing();
		};

		me.dataList_renameColumnHeader = function( trViewRowTag, viewColumnsTableTag )
		{
			me.dataListingTableManager.renameColumnHeader( trViewRowTag, viewColumnsTableTag );
		};

		me.dataList_setUpColumnTags = function( trViewRowTag, viewColumnsTableTag )
		{
			me.dataListingTableManager.setUpColumnTags( trViewRowTag, viewColumnsTableTag );
		};

		me.dataList_populateColumnData = function( trViewRowTag, optional_SingleRow_OuData, aggDataValues )
		{
			me.dataListingTableManager.populateColumnData( trViewRowTag, optional_SingleRow_OuData, aggDataValues );
		};

		me.dataList_removeColumn = function( rowId )
		{
			me.dataListingTableManager.removeColumn( rowId );
		}

		me.reorderDataListColumns = function( viewColumnsTableTag )
		{
			me.dataListingTableManager.reorderDataListColumns( viewColumnsTableTag );
		};

		me.dataList_resetSection = function()
		{
			me.dataListingTableManager.resetSection();
		};

		me.removeSorting_DataListingTable = function()
		{
			me.dataListingTableManager.removeSorting_DataListingTable();
		};

		me.dataList_makeTableSortable = function()
		{
			me.dataListingTableManager.makeTableSortable();
		};

		me.checkOrgUnitUserAccess = function( ouData, accessOrgUnits )
		{
			return me.dataListingTableManager.checkOrgUnitUserAccess( ouData, accessOrgUnits );
		}

		me.checkOrgunitEditPermission = function( orgUnit, orgUnitParent )
		{
			return me.dataListingTableManager.checkOrgunitEditPermission( orgUnit, orgUnitParent );
		}

		// ------------------------------------


		me.getTypeList = function()
		{
			return me.viewManager.viewColumnsTableManager.getTypeList();
		};

		me.getOrgUnitAttributeList_FromTypeList = function()
		{
			var typeList = me.getTypeList();

			return ( Util.getFromList( typeList, 'OrgUnitAttr' ) ).values;
		};

		me.getNetworkAttributeValueList_FromSetting = function()
		{
			return me.networkAttributeValueList;
		};

		me.getOUDynamicAttributeList = function(){
			return me.orgUnitAttributeManager.getDynamicAttributeList();
		};

		me.getOrgUnitGroupSetList = function(){
			return me.orgUnitAttributeManager.getOrgUnitGroupSetList();
		};
		
		me.getNetworkChildAttributeValueList_FromSetting = function()
		{
			return me.networkChildAttributeValueList;			
		};

		me.getInitialSecurity = function()
		{
			return me.userSecurityManager.getInitialSecurity();
		};

		me.getSecurityOrCreate = function( targetObj )
		{
			return me.userSecurityManager.getSecurityOrCreate( targetObj );
		};


		// ---------------------
		// SettingDataPopup Ones

		me.getNetworkCodeByViewId = function( viewId, returnFunc )
		{
			me.settingDataPopupForm.getNetworkCodeByViewId( viewId, returnFunc );
		};

		me.updateSettingDataChanges = function( returnFunc )
		{
			me.settingDataPopupForm.updateSettingDataChanges( returnFunc );
		};

		// SettingDataPopup Ones
		// --------------------

		// ---------------------
		// Others

		me.checkUseIndividualDataRetrieval = function()
		{
			return false;
			//return me.controlsPopupForm.checkUseIndividualDataRetrieval();
		};

		me.checkOrgunitEditAuthority = function()
		{
			return me.getUserPermission_Authorities().OrgUnit_Edit;
		};

		me.checkEnableAppSecretUserMode = function() 
		{ 
			return true; //me.controlsPopupForm.checkEnableAppSecretUserMode(); 
		};

		// Others
		// ---------------------

		// Exposed Methods
		// -------------------------------------------


		// -------------------------------------------
		// Call 'settingDataPopupForm' Methods
		me.setNetworkAttributeValueList = function( selectedNetwork )
		{
			me.networkAttributeValueList = me.settingDataPopupForm.getNetworkAttributeValueList( selectedNetwork , 'Network_Attr' );			
		};

		me.setNetworkChildAttributeValueList = function( selectedNetwork )
		{
			me.networkChildAttributeValueList = me.settingDataPopupForm.getNetworkAttributeValueList( selectedNetwork , 'NetworkChild_Attr' );				
		};

		me.retrieveNetworkData = function( networkCode, returnFunc )
		{
			me.settingDataPopupForm.getNetworkData( networkCode, returnFunc );
		};

		// Call 'settingDataPopupForm' Methods
		// -------------------------------------------


		// -----------------------------------
		// Methods

		me.setupTopSection = function( userSecurityManager )
		{
			// Set click event - back to application
			$( '#headerBanner,#headerText,#closeButton' ).click( function() { window.location.href = _dhisURL; } );

			// Get application title
			$.get( _queryURL_appTitle, function( json_Data )
			{
				$( '#headerText' ).text( Util.getNotEmpty( json_Data.applicationTitle ) );
			});


			// Show/Hide Click Button..
			if ( userSecurityManager.getUserLoginId() == _deploymentManagerId ) 
			{
				me.configControlSectionTag.show();
			}


			// Set button click events
			me.settingPopupFormOpenTag.click( function()
			{
				AppUtil.checkAndRedirect_DHISSession( function()
				{
					me.settingDataPopupForm.openForm( me.sectionNetworkListTag.val() );
				});
			});


			me.configPopupFormOpenTag.click( function()
			{
				me.configDialogForm.openForm();
			});


			/*me.controlsPopupFormOpenTag.click( function()
			{
				me.controlsPopupForm.openForm();
			});*/

		};

		me.populateNetworkList_Default = function()
		{
			me.settingDataPopupForm.getSectionList( function( sectionNetworkList )
			{
				me.populateNetworkList( sectionNetworkList );
			});
		}

		me.detectParameterAndAction = function()
		{
			var viewId = ( Util.getParameterByName( _param_viewId ) ).split( '/' )[0];

			if ( viewId != "")
			{
				// Get the network code by view ID..
				me.getNetworkCodeByViewId( viewId, function( networkCode )
				{					
					// Get the network selected
					me.sectionNetworkListTag.val( networkCode ).change();

					me.viewManager.getNetworkViewListTag().val( viewId ).change();

					me.dataListingTableManager.runBtnTag.click();
				});
			}
		};


		me.resetSection_Network = function()
		{
			me.divViewOUSearchSectionTag.hide( 'fast' );

			me.viewManager.resetSection_View();


			me.switchSectionToggling( $( '#divViewSection' ), $( '#divNetworkViewList' ), $( '#divOuSearchSection' ), $( '#divOuSearch' ) );
	
			me.orgUnitSearchManager.resetSection();
		};


		me.setUpRESTTest = function()
		{
			$( '#btnRESTTest' ).click( function()
			{
				var inputRESTTestVal = Util.trim( $( '#inputRESTTest' ).val() );
				var loadingTag = $( '#RESTTest_loading' );

				if ( inputRESTTestVal != "" )
				{
					RESTUtil.getAsynchData( inputRESTTestVal, function( json_Data )
					{ }
					, function() {}
					, function() { loadingTag.show(); }
					, function() { loadingTag.hide(); }
					);
				}
			});
		};


		// ---------------------------------------
		
		// Initial Setup Call
		me.initialSetup();
	}

	// Class - ProviderNetwork
	// -------------------------------------------


	// -------------------------------------------
	// Class - ViewManager

	function ViewManager( oProviderNetwork, orgUnitAttributeManager, settingDataPopupForm )
	{
		var me = this;

		me.oProviderNetwork = oProviderNetwork;
		me.orgUnitAttributeManager = orgUnitAttributeManager;
		me.settingDataPopupForm = settingDataPopupForm;

		// -- Popup Form Clases ---------
		me.viewColumnsPopupForm;
		me.viewManagePopupForm;
		me.viewLinkPopupForm
		me.viewCreatePopupForm;

		// -- Service and Manager Classes ---------
		me.viewServiceManager;
		me.viewColumnsTableManager;	

		// -- Tags ---------
		me.networkViewListTag = $( '#networkViewList' );
		me.divViewAssociatedButtonsTag = $( '#divViewAssociatedButtons' );
		me.mainContentTag = $( '#mainContent' );  // Shouldn't this be placed in 'DataTableList' ?


		// -- Variables -------

		me.currentViewPermission = false;


		// ------------------------------
		// -- Exposed Method ------------

		me.getSelectedViewVal = function()
		{
			return me.networkViewListTag.val();
		};

		me.getSelectedViewName = function()
		{
			return me.networkViewListTag.find( 'option:selected' ).text();
		};

		me.getNetworkViewListTag = function()
		{
			return me.networkViewListTag;
		};

		me.changeView = function( viewId )
		{
			me.networkViewListTag.val( viewId ).change();
		};

		me.reload_NetworkViewListTag = function()
		{
			me.populateNetworkView();

			me.networkViewListTag.val( '' );
			me.networkViewListTag.change();
		};

		me.deleteNetworkView = function( networkName, viewId, returnFunc )
		{
			me.settingDataPopupForm.deleteNetworkView( networkName, viewId, returnFunc );
		};

		me.checkNetworkViewByName = function( networkName, viewName, returnFunc )
		{
			me.settingDataPopupForm.checkNetworkViewByName( networkName, viewName, returnFunc );
		};

		me.saveNetworkViewObjData = function( networkName, viewData, returnFunc )
		{
			me.settingDataPopupForm.saveNetworkViewObjData( networkName, viewData, returnFunc );
		};

		me.getNetworkViewObjData = function( networkName, viewId, returnFunc )
		{
			me.settingDataPopupForm.getNetworkViewObjData( networkName, viewId, returnFunc );
		};

		me.renameNetworkView = function( networkName, viewId, viewName_New, returnFunc )
		{
			me.settingDataPopupForm.renameNetworkView( networkName, viewId, viewName_New, returnFunc );
		};

		me.getCurrentViewPermission = function()
		{
			return me.currentViewPermission;
		};

		me.getViewChangePivotSelectTag = function()
		{
			return me.viewManagePopupForm.getViewChangePivotSelectTag();
		};

		me.switchPivot = function( value )
		{
			me.viewColumnsTableManager.switchPivot( value );
		};

		me.getViewQueryStrParameters = function()
		{
			return me.viewColumnsTableManager.getViewQueryStrParameters();
		};

		me.getViewColumnRowData = function( rowTag )
		{
			return me.viewColumnsTableManager.getViewColumnRowData( rowTag );
		};

		me.getViewColumnsTableSortings = function()
		{
			return me.viewColumnsTableManager.getViewColumnsTableSortings();
		};
		
		// -- Exposed Method ------------
		// ------------------------------


		// -- Internal Methods -----------------
		// -------------------------------------

		me.populateNetworkView = function()
		{
			// Clear the list.
			me.networkViewListTag.empty();

			var networkName = me.oProviderNetwork.getSelectedNetworkName();

			me.settingDataPopupForm.getNetworkViewList( networkName, function( json_Data )
			{
				me.networkViewListTag.append( '<option value="">Select View</option>' );

				if ( json_Data !== undefined )
				{
					$.each( json_Data, function( i_view, item_view )
					{
						me.getViewSecurityPermission( 'View', item_view.id, function( hasPermission )
						{
							if ( hasPermission )
							{
								me.networkViewListTag.append( '<option value="' + item_view.id + '">' + item_view.name + '</option>' );
							}
						});
					});
				}				
			});
		};


		me.saveNetworkCurrentViewData = function( viewPivotVal, jsonTableData, jsonFilters, runFunc )
		{
			var networkName = me.oProviderNetwork.getSelectedNetworkName();
			var viewId = me.getSelectedViewVal();

			if ( viewId == "" )
			{
				alert( 'Can not proceed!  Empty view is selected!' );
			}
			else
			{ 
				var viewObjData = { "id": viewId, "pivot": viewPivotVal, "data": jsonTableData };
				if( jsonFilters !== undefined ) {
					viewObjData["filter"] = jsonFilters;
				}
				me.saveNetworkViewObjData( networkName, viewObjData, runFunc );
			}
		};
		
		me.getNetworkCurrentViewObjData = function( runFunc )
		{
			var viewName = me.getSelectedViewVal();

			if ( viewName == "" )
			{
				alert( 'Can not proceed!  Empty view is selected!' );
			}
			else
			{
				me.getNetworkViewObjData( me.oProviderNetwork.getSelectedNetworkName(), viewName, function( json_Data )
				{
					runFunc( json_Data );
				});	
			}
		};

		me.resetSection_View = function()
		{
			// Reset the View related Action/Interface
			me.mainContentTag.hide( 'fast' );
			me.divViewAssociatedButtonsTag.hide( 'fast' );
			
			me.viewColumnsTableManager.resetSection();

			// reset the security related display
			me.oProviderNetwork.runBtnSectionVisibility( false );

			// reset the run result msg
			MsgManager.networkListingMsgHide();

			//me.viewManagePopupForm.resetSection();
			me.currentViewPermission = false;
		};


		me.getViewSecurityPermission = function( permType, viewId, returnFunc )
		{
			var networkName = me.oProviderNetwork.getSelectedNetworkName();
			//var viewId = me.getSelectedViewVal();

			if ( networkName == "" || viewId == "" )
			{
				returnFunc( false );
			}
			else
			{
				// Get userGroupId - if exists..
				me.getNetworkViewObjData( networkName, viewId, function( viewData )
				{
					var hasPermission = false;

					// If view owner, enable the tags.
					var currentUserId = me.oProviderNetwork.getUserId();

					if ( ( viewData.owner !== undefined && currentUserId == viewData.owner )
						|| ( me.oProviderNetwork.isSecretUser() && me.oProviderNetwork.checkEnableAppSecretUserMode() )
						)
					{
						hasPermission = true;
					}
					else
					{
						if ( viewData.security !== undefined )
						{

							if ( permType == 'Edit' )
							{
								hasPermission = ( Util.checkValue( viewData.security.permissions ) ) ? me.oProviderNetwork.userSecurityManager.existsInUserGroupsWithList( viewData.security.permissions, permType ) : false ;
							}
							else if ( permType == 'View' )
							{
								if ( viewData.security.anybodyView )
								{
									hasPermission = true;
								}
								else
								{
									hasPermission = ( Util.checkValue( viewData.security.permissions ) ) ? me.oProviderNetwork.userSecurityManager.existsInUserGroupsWithList( viewData.security.permissions, permType ) : false ;
								}
							}
						}
						else
						{
							// if userGroup was not set for this view, show all.
							hasPermission = false;
						}
					}

					returnFunc( hasPermission );
				});
			}
		};

		// -------------------------------------
		// -- Internal Methods -----------------


		// -------------------------------------
		// -- 'initialSetup' called Methods ---

		me.setUpEvent_NetworkView = function( networkViewListTag )
		{
			// View Selection Setup
			networkViewListTag.change( function()
			{				
				var selectedVal = $( this ).val();

				me.resetSection_View();


				if ( selectedVal != "" )
				{
					var selectedNetwork = me.oProviderNetwork.getSelectedNetworkVal();

					me.divViewAssociatedButtonsTag.show( 'medium' );
					
					me.oProviderNetwork.runBtnSectionVisibility( true );


					// Get User View Permission first
					me.getViewSecurityPermission( 'Edit', selectedVal, function( hasPermission )
					{
						me.currentViewPermission = hasPermission;


						// NOTE: Modified to get & set this below when 'Network' is seletec
						// 1. Get Network setting data and set column type list (to be used on below population)
						//me.oProviderNetwork.retrieveNetworkData( selectedNetwork, function( networkData )
							// Set it as saved variable
							var networkData = me.oProviderNetwork.getSelectedNetworkData();


							// construct org Unit Levels - for orgUnit level selection
							// set org Unit Levels
							me.viewColumnsTableManager.setOrgUnitTypeList( networkData.orgUnitLevels );

							// retrieve saved column settings
							me.viewColumnsTableManager.retrieveAndPopulate( me.oProviderNetwork.getSelectedNetworkName(), function( columnsTableTag )
							{												
								// populate column list on main data listing table
								me.oProviderNetwork.setUp_DataListingColumns( columnsTableTag );
							});


							// Show content
							me.mainContentTag.show( 'medium' );

						//});

					});
				}
			});
		};

		me.InitializeObjects = function()
		{
			// Instantiate the objects..
			me.viewServiceManager = new ViewServiceManager( me.oProviderNetwork, me );

			me.viewColumnsPopupForm = new ViewColumnsPopupForm( me.oProviderNetwork, me );
			me.viewManagePopupForm = new ViewManagePopupForm( me.oProviderNetwork, me );
			me.viewLinkPopupForm = new ViewLinkPopupForm( me.oProviderNetwork, me );
			me.viewCreatePopupForm = new ViewCreatePopupForm( me.oProviderNetwork, me );

			me.viewColumnsTableManager = new ViewColumnsTableManager( me.oProviderNetwork, me, me.orgUnitAttributeManager );
		};

		// ========================================================

		me.initialSetup = function()
		{
			me.InitializeObjects();

			me.setUpEvent_NetworkView( me.networkViewListTag );
		};

		// Initial Setup Call
		me.initialSetup();
	}

	// Class - ViewManager
	// -------------------------------------------


	// -------------------------------------------
	// Class - ViewColumnsTableManager

	function ViewColumnsTableManager( oProviderNetwork, viewManager, orgUnitAttributeManager )
	{
		var me = this;

		me.oProviderNetwork = oProviderNetwork;
		me.viewManager = viewManager;

		me.orgUnitAttributeManager = orgUnitAttributeManager;

		me.analyticEditPopupForm = new AnalyticEditPopupForm( oProviderNetwork, me );


		// --- Tags ------
		me.viewColumnsDivTag = $( '#viewColumnsDiv' );

		me.viewColumnsTableTag = $( '#viewColumnsTable' );
		
		me.viewOrgunitFilterTBTag = $( '#viewOrgunitFilterTB' );
		me.addOrgunitFilterTBTag = $( '#addViewOrgunitGroupFilter' );
		me.applyOUGroupFilterBtnTag = $( '#applyOUGroupFilterBtn');
		
		me.viewPivotTag = $( '#viewPivot' );
		me.divViewPivot_OUGroupUseTag = $( '#divViewPivot_OUGroupUse' );

		me.addNewRowBtnTag = $( '#addNewRow_ViewColumns' );
		
		me.filterValuePopupTag = $("#filterValuePopup");
		me.viewColumnFilterTableTag = $("#viewColumnFilterTable");


		// --- Object, Variables ------
		me.typeList = [
					{ name: "OrgUnit Levels", id: "OrgUnitLvl", networkType: "All", valueType: "dropdown", values: 
					[ 
						//{ name: "L4", value: "4" }, { name: "L5", value: "5" }
					] }
					,{ name: "Network Property", id: "OrgUnitAttr", networkType: me.oProviderNetwork.network_Name , valueType: "dropdown", values: 
					[ 						
						//{ name: "ID", value: "id" },{ name: "Name", value: "name" }
					] }
					// remove if 'use' flag is not set
					,{ name: "Network Relations", id: "OrgUnitRelations", networkType: me.oProviderNetwork.network_Name, valueType: "dropdown", values: [
						 { name: "Data sets", value: "dataSets" }
						,{ name: "Programs", value: "programs" }						
						,{ name: "OrgUnit Groups", value: "orgUnitGroups" }
						
					] }

					,{ name: "Network Analytic", id: "Analytic", networkType: me.oProviderNetwork.network_Name, valueType: "popupButton", values: [] }

					,{ name: "Network Custom Call", id: "Custom", networkType: me.oProviderNetwork.network_Name, valueType: "inputTextbox", values: [] }

					,{ name: "NetworkChild Property", id: "OrgUnitAttr_NC", networkType: me.oProviderNetwork.networkChild_Name, valueType: "dropdown", values: [] }

					// remove if 'use' flag is not set
					,{ name: "NetworkChild Relations", id: "OrgUnitRelations_NC", networkType: me.oProviderNetwork.networkChild_Name, valueType: "dropdown", values: [
						 { name: "Data sets", value: "dataSets" }
						,{ name: "Programs", value: "programs" }						
						,{ name: "OrgUnit Groups", value: "orgUnitGroups" }						
					] }

					,{ name: "NetworkChild Analytic", id: "Analytic_NC", networkType: me.oProviderNetwork.networkChild_Name, valueType: "popupButton", values: [] }

					,{ name: "NetworkChild Custom Call", id: "Custom_NC", networkType: me.oProviderNetwork.networkChild_Name, valueType: "inputTextbox", values: [] }
				];


		me.orgUnitDynamicAttributes = [];

		me.initialPivot = { name: "", type: "OrgUnitLvl", value: "", pivot: "true", rowid: 0 };

		me.initialColumn;
		
		me.viewData;

		me.pivotFilterGroupName = "";

		me.addType_Prev = "Prev";
		me.addType_Next = "Next";


		// -------------------------------------------
		// Initial Setup Methods

		// Initial Setup Call
		me.initialSetup = function()
		{	
			me.viewPivotTag.css( 'background-color', me.oProviderNetwork.getPivotLevelColor() );

			// Set up Event Handlers
			me.setup_Events();

			me.setup_AttributeVariables( orgUnitAttributeManager, me.typeList );
		};


		me.setup_Events = function()
		{			
			me.setUp_viewPivotTagChange( me.viewPivotTag );
			
			me.setup_OrgunitGroupFilterChange();
		};

		// Initial Setup Methods
		// -------------------------------------------

		// -------------------------------------------
		// Exposed Methods

		me.getTypeList = function()
		{
			return me.typeList;
		};

		me.isPivot_Network = function()
		{
			return ( me.viewPivotTag.val() == me.oProviderNetwork.network_Name );
		};
	
		me.isPivot_NetworkChild = function()
		{
			return ( me.viewPivotTag.val() == me.oProviderNetwork.networkChild_Name );
		};

		me.getPivotName = function()
		{
			return me.viewPivotTag.val();
		};

		me.switchPivot = function( value )
		{
			me.viewPivotTag.val( value ).change();
		};

		me.getPivotLevel = function()
		{
			var selectedPivotVal = me.viewPivotTag.val();
			var networkData = me.oProviderNetwork.getSelectedNetworkData();

			var pivotLevel;

			if ( selectedPivotVal == me.oProviderNetwork.network_Name )
			{
				pivotLevel = networkData.Network_LVL;
			}
			else if ( selectedPivotVal == me.oProviderNetwork.networkChild_Name )
			{
				pivotLevel = networkData.NetworkChild_LVL;
			}

			return pivotLevel;
		};

		me.getPivotFilterGroupId = function()
		{
			var selectedPivotVal = me.viewPivotTag.val();
			var networkData = me.oProviderNetwork.getSelectedNetworkData();

			var filterGroupId;

			if ( selectedPivotVal == me.oProviderNetwork.network_Name )
			{
				filterGroupId = networkData.network_OUGroupID;
			}
			else if ( selectedPivotVal == me.oProviderNetwork.networkChild_Name )
			{
				filterGroupId = networkData.networkChild_OUGroupID;
			}
			
			return filterGroupId;
		};


		me.getPivotFilterGroupName = function()
		{
			return me.pivotFilterGroupName;
		};


		me.setOrgUnitTypeList = function( orgUnitLevelList )
		{
			var orgUnitLevel = Util.getFromList( me.typeList, "OrgUnitLvl", "id" );

			orgUnitLevel.values = orgUnitLevelList;
		};


		me.reorderViewColumnsRows = function( dataTableTag )
		{
			var dataTable_ColumnOrders = [];

			dataTableTag.find( 'th' ).each( function( i )
			{
				dataTable_ColumnOrders.push( parseInt( $( this ).attr( 'rowid' ) ) );
			});

			var headerRowTag = me.viewColumnsTableTag.find( 'tr.trHeader' );
			

			var dataTableColumnRowId_Top = dataTable_ColumnOrders[0];

			var rowTag_Top = me.viewColumnsTableTag.find( 'tr.trDataNew[rowid="' + dataTableColumnRowId_Top + '"]' );


			for ( var i = dataTable_ColumnOrders.length - 1; i >= 1; i-- )
			{
				var dataTableColumnRowId = dataTable_ColumnOrders[i];

				var rowTag = me.viewColumnsTableTag.find( 'tr.trDataNew[rowid="' + dataTableColumnRowId + '"]' );

				rowTag.insertAfter( rowTag_Top );
			}


			console.log( 'Finished the reordering' );


			// ?? Save afterward
			me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );
		};


		// --- View Column Data Selection List Get Related...

		me.getViewQueryStrParameters = function()
		{
			var queryStr = "";
			var queryStr_NonPivot = "";
			var pivot_Data = { 'hasDynamicAttr': false, 'hasOrgUnitGroupSet': false };
			var nonPivot_Data = { 'hasDynamicAttr': false, 'hasOrgUnitGroupSet': false };
			
			var parents = [];
			var conditions = { "orgUnitGroup": false };


			me.viewColumnsTableTag.find( 'tr.trDataNew[rowid]' ).each( function( i )
			{
				var viewColumnRowData = me.getViewColumnRowData( $( this ) );
				var type = viewColumnRowData.type;

				if ( type != "OrgUnitRelations" && type != "OrgUnitRelations_NC" && Util.checkValue( viewColumnRowData.typeValue ) )
				{
					var queryStrTemp = "";

					var isDynamicCase = ( AppUtil.getDynamicAttrId( viewColumnRowData.typeValue ) != "" ) ? true : false;
					var isOugsCase = AppUtil.startsWith( viewColumnRowData.typeValue, "ougs_" );

					if ( !isDynamicCase && !isOugsCase )
					{
						var returnData = me.get_QueryStr( viewColumnRowData.type, viewColumnRowData.typeValue );

						if ( returnData.orgsCase ) isOugsCase = true;
						else if ( returnData.queryStr != "" ) queryStrTemp = ',' + returnData.queryStr;
					}

					// put queries into pivot and non-pivot
					if ( viewColumnRowData.isPivotLevel )
					{
						if ( isDynamicCase ) pivot_Data.hasDynamicAttr = true;
						//else if ( isOugsCase ) pivot_Data.hasOrgUnitGroupSet = true;						
						else queryStr += queryStrTemp;
					}
					else
					{
						if ( isDynamicCase ) nonPivot_Data.hasDynamicAttr = true;
						//else if ( isOugsCase ) nonPivot_Data.hasOrgUnitGroupSet = true;						
						else queryStr_NonPivot += queryStrTemp;					
					}
				}
			});
			

			// dynamic attributes set..
			queryStr += ( pivot_Data.hasDynamicAttr ) ? ',attributeValues' : '';
			queryStr_NonPivot += ( nonPivot_Data.hasDynamicAttr ) ? ',attributeValues' : '';
			

			// if View OrgUnitGroup filter exists, set it for orgUnitGroup
			// if ( me.existsViewOUGFilter() ) pivot_Data.hasOrgUnitGroupSet = true;

			// orgUnitGroupSet attributes set..
			// queryStr += ( pivot_Data.hasOrgUnitGroupSet ) ? ',organisationUnitGroups[id,name,organisationUnitGroupSet[id,name]]' : '';
			// queryStr_NonPivot += ( nonPivot_Data.hasOrgUnitGroupSet ) ? ',organisationUnitGroups[id,name,organisationUnitGroupSet[id,name]]' : '';


			// nonPivot query add to 'queryStr'
			if ( queryStr_NonPivot != "" )
			{
				// If pivot is the network level, nonPivot query is for network child.
				// If pivot is the network child level, nonPivot query is for network, which is parent of pivot.
				var nonPivotLevelStr = ( me.isPivot_Network ) ? "children[id,name" : "parent[id,name";
				//"children[id,organisationUnitGroups[id,name,organisationUnitGroupSet[id,name]],dataSets[id,name],programs[id,name]" : "parent[id";

				queryStr += "," + nonPivotLevelStr + queryStr_NonPivot + "]";
			}

			return queryStr;
		};
		


		me.get_QueryStr = function( type, typeValue )
		{
			var queryStr = "";
			var orgsCase = false;

			if ( type == "OrgUnitAttr" || type == "OrgUnitAttr_NC" )
			{				
				queryStr = typeValue;
			}
			else if ( type == "OrgUnitRelations" || type == "OrgUnitRelations_NC" )
			{								
				if ( typeValue == 'dataSets' ) queryStr = 'dataSets[id,name]';
				else if ( typeValue == 'programs' ) queryStr = 'programs[id,name]';
				else if ( typeValue == 'orgUnitGroups' ) orgsCase = true;
				else if ( typeValue == 'orgUnitGroupSets' ) orgsCase = true;
			}
			//else if ( viewColumnRowData.type == "OrgUnitLvl" ) { .. parent, }

			return { 'queryStr': queryStr, 'orgsCase': orgsCase };
		};



		me.getViewColumnsTableSortings = function()
		{
			var sortingList = [];

			me.viewColumnsTableTag.find( 'tr.trDataNew[rowid]' ).each( function( i )
			{
				var trRowTag = $( this );

				if ( Util.checkValue( trRowTag.find( '.sortNumber' ).val() ) )
				{
					sortingList.push( 
						{ rowIndex: i
						, sortNumber: Number( trRowTag.find( '.sortNumber' ).val() )
						, sortDirection: trRowTag.find( '.sortDirection' ).val()
						} 
					);
				}
			});

			return sortingList;
		};


		// Exposed Methods
		// -------------------------------------------


		// -------------------------------------------
		// Interal Methods


		me.getParentsQueryStr = function( parents )
		{
			var queryStr = "";

			var pivotLvl = me.getPivotLevel();  

			var parentsOrdered = Util.sortByKey( parents, "level" );

			// Get the lowest level, and see the difference between the pivot level..
			// loop through those levels.. create..

			var topOuLevel = parentsOrdered[0].level;

			for ( var i = pivotLvl - 1; i >= topOuLevel; i-- )
			{
				queryStr += ',parent[id,name';
			}

			for ( var i = pivotLvl - 1; i >= topOuLevel; i-- )
			{
				queryStr += ']';
			}

			return queryStr;
		};


		me.existsViewOUGFilter = function()
		{
			var exists = false;

			if ( me.viewData !== undefined && me.viewData.filter !== undefined )
			{
				var oug_filters = me.viewData.filter;
				$.each( oug_filters, function( i_oug, item_oug )
				{
					if( item_oug !== undefined && item_oug != null && item_oug.value != "" )
					{
						exists = true;
						return false;
					}
				});
			}	
			
			return exists;
		}

		// View OrgUnitGroup Filtering Set <-- Not being used!!!  // Need to be changed!!!!
		me.getOrgUnitGroupFilterQueryStr = function()
		{
			var orgUnitGroupFilterStr = "";

			if ( me.viewData !== undefined && me.viewData.filter !== undefined )
			{
				var oug_filters = me.viewData.filter;
				$.each( oug_filters, function( i_oug, item_oug )
				{
					if( item_oug !== undefined && item_oug != null )
					{
						orgUnitGroupFilterStr += '&filter=organisationUnitGroups.id:eq:' + item_oug.value;
					}
				});
			}	

			return orgUnitGroupFilterStr;
		}


		me.getViewColumnRowData_ByRowId = function( rowId )
		{
			return me.getViewColumnRowData( me.viewColumnsTableTag.find( 'tr.trDataNew[rowid="' + rowId + '"]' ) );
		};

		me.getViewColumnRowData = function( trViewRowTag )
		{
			var viewColumnRowData = { 'title': ''
				, 'type': ''
				, 'typeValue': ''
				, 'rowid': ''
				, 'isPivotLevel': false
				, 'ouLevel': 0
				, 'previousRowInfo': {}  //{ rowId: 3, location: right/left }
				};

			if ( trViewRowTag.length == 1 )
			{
				var rowId = trViewRowTag.attr( 'rowid' );
				var rowsTag = me.viewColumnsTableTag.find( 'tr.trDataNew[rowid]' );

				viewColumnRowData = { 'title': trViewRowTag.find( 'input.settingName' ).val()
					, 'type': trViewRowTag.find( 'select.settingType' ).val()
					, 'typeValue': trViewRowTag.find( 'td.typeValue' ).find( 'input,select' ).val()
					, 'rowid': rowId
					, 'isPivotLevel': ( trViewRowTag.attr( 'isPivotLevel' ) == "true" )
					, 'ouLevel': Number( trViewRowTag.attr( 'ouLevel' ) )
					, 'previousRowInfo': AppUtil.getPreviousRowIdInfo( AppUtil.getArrayFromTags( rowsTag, 'rowid' ), rowId )
				};

			}

			return viewColumnRowData
		};


		me.populatePivotNetworkList = function( viewPivotTag, viewData )
		{
			var pivotNetworkList = [ me.oProviderNetwork.network_Name ];

			if ( viewData.useNetworkChild !== undefined && viewData.useNetworkChild ) pivotNetworkList.push( me.oProviderNetwork.networkChild_Name );

			Util.populateSelect_ByList( viewPivotTag, pivotNetworkList, "Array" );


			viewPivotTag.val( viewData.pivot );

		};


		// Create table rows from data.
		me.populateViewColumnsTable = function( tableTag, viewData )
		{

			// Pivot listing reset and populate and select
			me.populatePivotNetworkList( me.viewPivotTag, viewData );

			// If 'viewChangePivotTag' exists, populate as well
			var viewChangePivotSelectTag = me.viewManager.getViewChangePivotSelectTag();
			if ( viewChangePivotSelectTag !== undefined ) me.populatePivotNetworkList( viewChangePivotSelectTag, viewData );


			// Clear table rows
			tableTag.find( '.trDataNew' ).remove();
			// Clear filter table rows
			me.viewOrgunitFilterTBTag.find("tr").remove();
				

			if ( viewData.data.length == 0 )
			{
				// If empty view, add a single entry row

				me.addNewRowBtnTag.click();
			}
			else
			{
				$.each( viewData.data, function( i, item )
				{
					if( item.type !== "filter" )
					{
						// Create new empty row
						var newRowTag = me.createNewRow( tableTag, me.typeList, item, item.rowid );

						// populate the row with data
						me.populateRowInfo( newRowTag, item, me.typeList );
					}
				});
				
				// Show/Hide Creating Analytics columns in views
				var networkData = me.oProviderNetwork.getSelectedNetworkData();
				var analyticsSetting = networkData.analytics;				
				// do not offer the possibility to add a column for analytics in views
				if( analyticsSetting == "" )
				{
					tableTag.find("select.settingType option:selected[value='Analytic']").closest("tr").find(".settingRemove").click();
					tableTag.find("select.settingType option:selected[value='Analytic_NC']").closest("tr").find(".settingRemove").click();					
				}
				
				var hasFilters = false;
				if( viewData.filter !== undefined ){
					for( var i in viewData.filter )
					{
						if( viewData.filter[i] !== undefined && viewData.filter[i] != null && viewData.filter[i].value !== undefined )
						{
							var ouGroupFilterId = viewData.filter[i].value;
							me.createNewOUGroupFilterRow( ouGroupFilterId );
							hasFilters = true;
						}
					}
				}
				
				Util.disableTag( me.applyOUGroupFilterBtnTag, true );				
			}

		};
		
		// populate the row with data
		me.populateRowInfo = function( newRowTag, item, typeList )
		{
			var valueTdTag = newRowTag.find( '.typeValue' );


			// Name Set
			newRowTag.find( 'input.settingName' ).val( item.name );


			// Type Set
			var typeTag = newRowTag.find( 'select.settingType' ).val( item.type );


			// Generate Value List by Type selection
			me.populateTypeValues( newRowTag, typeTag.val(), typeList, valueTdTag );


			// Value Set
			
			valueTdTag.find( 'input,select' ).val( item.value );
			
			if( item.type == "Analytic" || item.type == "Analytic_NC"){
				var analyticURL = new AnalyticURL();
				analyticURL.setURL( item.value );
				if( analyticURL.checkValid() == analyticURL.VALID )
				{
					valueTdTag.find("div.displayURL").css( "background-color", "LightGreen" );
					valueTdTag.find("div.displayURL").attr( "title", "Analytic is properly defined:\n" + item.value );
				}
				else
				{
					valueTdTag.find("div.displayURL").css( "background-color", "LightGray" );
					valueTdTag.find("div.displayURL").attr( "title", "Analytic is not properly defined yet" );
				}
			}
			
			// Sorting Number
			newRowTag.find( '.sortNumber' ).val( item.sortNumber );

			// Filter Value
			var filterValue = ( item.filter !== undefined ) ? JSON.stringify( item.filter ) : "";
			newRowTag.find( '.settingFilter' ).attr( 'filterValue', filterValue );
			if( filterValue != "" )
			{
				newRowTag.find( '.settingFilter' ).removeClass( "dimImgWHover" );
				var operator = item.filter.operator;
				newRowTag.find( '.settingFilter' ).attr( "title", "Filter : " + me.filterValuePopupTag.find("#filterOperator option[value='" + operator + "']").text() + " '" + item.filter.value + "'");
			}
			
			// If empty, set as default sort direction, Ascending.
			if ( !Util.checkValue( item.sortDirection ) ) item.sortDirection = 'A';
			newRowTag.find( '.sortDirection' ).val( item.sortDirection );

			
			// Paint if emtpy..
			me.paintEmptyValues( newRowTag );
		};
		
		me.paintEmptyValues = function( rowTag )
		{
			// Paint if emtpy
			rowTag.find( 'input[type!="image"],select[type!="sort"]' ).each( function()
			{
				Util.paintWarningIfEmpty( $( this ) );
			});
		};


		me.markForPivotLevelRow = function( tableTag )
		{
			tableTag.find( 'tr.trDataNew' ).each( function()
			{
				var trRowTag = $( this );
				
				trRowTag.css( 'background-color', '' );


				var type = trRowTag.find( 'select.settingType' ).val();
				var value = trRowTag.find( '.typeValue' ).find( 'input,select' ).val();

				var isType_NetworkChild = Util.endsWith( type, '_NC' );
				var isPivotLevelRow = false;


				var networkData = me.oProviderNetwork.getSelectedNetworkData();
				var ouLevel = "";


				if ( type == "OrgUnitLvl" )
				{
					if ( value !== undefined )
					{
						if ( me.getPivotLevel() == value ) isPivotLevelRow = true;

						ouLevel = value;
					}
				}
				else if ( type != "" )
				{
					if ( ( me.isPivot_Network() && !isType_NetworkChild ) 
					|| ( me.isPivot_NetworkChild() && isType_NetworkChild ) )
					{
						isPivotLevelRow = true;
					}

					if ( isType_NetworkChild ) ouLevel = networkData.NetworkChild_LVL;
					else ouLevel = networkData.Network_LVL;
				}
				

				trRowTag.attr( 'isPivotLevel', isPivotLevelRow );
				trRowTag.attr( 'ouLevel', ouLevel );
					
				if ( isPivotLevelRow )
				{
					trRowTag.css( 'background-color', me.oProviderNetwork.getPivotLevelColor() );
				}

			});
		};
	
		me.populateTypeValues = function( trRowTag, type, typeList, valueTdTag )
		{
			var contentsTag = "";

			$.each( typeList, function( i_type, item_type )
			{
				if ( item_type.id == type )
				{
					if ( item_type.valueType == "dropdown" )
					{	
						var valueOptions = '<option value="">Select Value</option>';


						if ( item_type.id == "OrgUnitAttr" || item_type.id == "OrgUnitAttr_NC" )
						{
							var attrLimits;
							
							if ( item_type.networkType == me.oProviderNetwork.network_Name  )
							{
								attrLimits = me.oProviderNetwork.getNetworkAttributeValueList_FromSetting();
							}
							else if ( item_type.networkType == me.oProviderNetwork.networkChild_Name  )
							{
								attrLimits = me.oProviderNetwork.getNetworkChildAttributeValueList_FromSetting();
							}
							
							// If type is 'OrgUnitAttr', limit the listing by Network Attribute Value List
							$.each( item_type.values, function( i_val, item_val )
							{
								if ( Util.findItemFromList( attrLimits, "value", item_val.value ) )
								{
									valueOptions += '<option value="' + item_val.value +  '">' + item_val.name + '</option>';
								}
							});
							
							$.each( me.oProviderNetwork.getOrgUnitGroupSetList(), function( i_val, item_val )
							{
								if ( Util.findItemFromList( attrLimits, "value", item_val.id ) )
								{
									valueOptions += '<option value="ougs_' + item_val.id +  '">' + item_val.name + '</option>';
								}
							});
						}
						else
						{
							$.each( item_type.values, function( i_val, item_val )
							{
								valueOptions += '<option value="' + item_val.value +  '">' + item_val.name + '</option>';
							});
						}

						contentsTag = $( '<select class="settingValue" style="width:115px;">' + valueOptions + '</select>' );


						// if the list type is orgUnit level, replace the level name with orgUnit level name. 
						if ( item_type.id == "OrgUnitLvl" )
						{							
							contentsTag.find( 'option' ).each( function( i_option )
							{
								var optionTag = $( this );

								$.each( me.oProviderNetwork.loadedInfo.orgUnitLevelsInfo, function( i_oul, item_oul )
								{
									if ( optionTag.val() == item_oul.level )
									{
										optionTag.text( item_oul.name );
										return false;
									}
								});
							});							
						}
					}
					else if ( item_type.valueType == "inputTextbox" )
					{
						contentsTag = $( '<input class="settingValue" type="text" size="20" style="width:115px;"/>' );
					}
					else if ( item_type.valueType == "popupButton" )
					{
						contentsTag = $("<div></div>");
						contentsTag.append( $( '<input class="settingValue" style="display:none;width:115px;" type="text" size="20" />' ) );
						contentsTag.append( $( '<div style="float: left; margin-right: 7px;"><button class="popupAction" type="button">Edit</button>' ) );
						contentsTag.append( $( '<div class="displayURL" style="float: left; height: 16px; width: 16px; background-color: LightGray;" title="Analytic is not properly defined yet"></div>' ) );
					}

					return false;
				}
			
			});

			valueTdTag.html( contentsTag );

			
			// Set value change event.
			me.setup_ValueChangeEvent( trRowTag );			
		};


		me.generateSettingDataFromTable = function( tableTag )
		{
			var list = new Array();

			tableTag.find( "tr.trData,tr.trDataNew" ).each( function()
			{
				var trCurrent = $( this );

				var item_Name = trCurrent.find( '.settingName' ).text();
				var item_Type = trCurrent.find( '.settingType' ).text();
				var item_Value = trCurrent.find( '.settingValue' ).val();
				var item_SortNumber = trCurrent.find( '.sortNumber' ).val();
				var item_SortDirection = trCurrent.find( '.sortDirection' ).val();

				list.push( { name: item_Name, type: item_Type, value: item_Value, sortNumber: item_SortNumber, sortDirection: item_SortDirection } );
			});

			return list;
		};
		

		me.saveViewColumnsInfo = function( tableTag, viewPivotTag, returnFunc )
		{
			var jsonTableData = [];

			tableTag.find( 'tbody tr.trDataNew' ).each( function()
			{
				var rowTag = $( this );
				var value = ( rowTag.find( '.settingValue' ).length > 0 ) ? rowTag.find( '.settingValue' ).val() : '' ;
				if( value != "" )
				{
				
					var rowData = {}; // name: '', type: '', value: '', rowid: '' };

					rowData.rowid = rowTag.attr( 'rowid' );
					rowData.pivot = rowTag.attr( 'pivot' );

					rowData.name = rowTag.find( '.settingName' ).val();
					rowData.type = rowTag.find( '.settingType' ).val();
					rowData.value = value;

					rowData.sortNumber = rowTag.find( '.sortNumber' ).val();
					rowData.sortDirection = rowTag.find( '.sortDirection' ).val();
					
					var filter = rowTag.find( '.settingFilter' ).attr("filtervalue");
					if( filter !== undefined && filter != "" )
					{
						rowData.filter = JSON.parse( rowTag.find( '.settingFilter' ).attr("filtervalue") );
					}

					jsonTableData.push( rowData );
				}
			});

			// Set OU group filter value

			var jsonFilters = [];
			me.viewOrgunitFilterTBTag.find(".ouGroupFilter").each( function(){
				var value = $(this).val();
				if( value != "" )
				{
					var jsonFilter = {};  // { type: '', value: '' };
					jsonFilter.type = "OUGroupFilter";
					jsonFilter.value = value;
					jsonFilters.push( jsonFilter );
				}
			});

			// Save the view columns to current view
			me.viewManager.saveNetworkCurrentViewData( viewPivotTag.val(), jsonTableData, jsonFilters, function( status )
			{
				if( returnFunc !== undefined ) returnFunc();
			});

		};
		
		
		me.getNextRowId = function( tableTag )
		{
			var rows = tableTag.find( 'tr[rowid]' );

			if ( rows.length == 0 )
			{
				return 0;
			}
			else
			{
				var maxRowId;

				tableTag.find( 'tr[rowid]' ).each( function()
				{
					var rowid = Number( $( this ).attr( 'rowid' ) );

					if ( maxRowId === undefined )
					{
						maxRowId = rowid;
					}
					else if ( maxRowId < rowid )
					{
						maxRowId = rowid;
					}
				});

				return maxRowId + 1;
			}
		};


		me.getPreviousRowId = function( tableTag )
		{
			var rows = tableTag.find( 'tr[rowid]' );

			if ( rows.length == 0 )
			{
				return 0;
			}
			else
			{
				var minRowId;

				tableTag.find( 'tr[rowid]' ).each( function()
				{
					var rowid = $( this ).attr( 'rowid' );

					if ( minRowId === undefined )
					{
						minRowId = rowid;
					}
					else if ( minRowId > rowid )
					{
						minRowId = rowid;
					}
				});

				return parseInt( minRowId ) - 1;
			}
		};

		
		// Create new empty row
		me.createNewRow = function( tableTag, typeList, item, rowid, addType )
		{
			var newRowTag;
			
			rowid = ( rowid === undefined ) ? 0 : rowid;

			var typeOptionTags = '<option value="">Select Type</option>';


			// Filter the type dropdown depending on Network Child usage/existance
			var filteredTypeList = [];
			
			if ( me.oProviderNetwork.getSelectedNetworkData().useNetworkChild )
			{
				filteredTypeList = typeList;
			}
			else
			{
				$.each( typeList, function( i_ty, item_ty )
				{
					if ( item_ty.networkType == me.oProviderNetwork.network_Name || item_ty.networkType == "All" )
					{
						filteredTypeList.push( item_ty );
					}
				});
			}

			// Remove 'Analytic' and 'Analytic_NC' options from filteredTypeList
			var networkData = me.oProviderNetwork.getSelectedNetworkData();
			var analyticsSetting = networkData.analytics;
							
			$.each( filteredTypeList, function( i_type, item_type )
			{
				var hidden = "";
				if( analyticsSetting == "" && ( item_type.id == "Analytic" || item_type.id == "Analytic_NC" ) )
				{
					hidden = "style='display:none;'";
				}
				typeOptionTags += '<option value="' + item_type.id + '" ' + hidden + '>' + item_type.name + '</option>';
			});


			var content = "<tr id='viewrow-" + rowid + "' class='trDataNew' rowid='" + rowid + "' >"
				+ "<td class='dragHandle dimImgWHover'></td>"
				+ "<td><input type='text' class='settingName' style='padding-left: 3px;' /></td>"
				+ "<td><select class='settingType'>"
				+ typeOptionTags
				+ "</select></td>"
				+ "<td class='typeValue'></td>"
				+ "<td class='settingSort' nowrap><div class='divNoArrow'><select class='sortNumber' title='Sorting Orders' type='sort'><option value='' selected></option></select></div><div class='divNoArrow' style='margin-left: 1px;'><select class='sortDirection' title='A - Ascending, D - Descending' type='sort'><option value='A' selected>A</option><option value='D'>D</option></select></div></td>"
				+ "<td><input type='image' class='settingFilter dimImgWHover' title='[empty]' src='img/filter_value.png' style='border: 0px solid;' /></td>"
				+ "<td><input type='image' class='settingRemove dimImgWHover' alt='Delete Row' title='Delete Row' src='img/cross.png' style='border: 0px solid;' /></td>"
				+ "</tr>";


			if ( addType !== undefined && addType == me.addType_Prev )
			{	
				tableTag.find( 'tbody tr.trDataNew:first' ).before( content );

				newRowTag = tableTag.find( 'tr.trDataNew:first' );
			}
			else
			{
				tableTag.find( 'tbody' ).append( content );

				newRowTag = tableTag.find( 'tr.trDataNew:last' );
			}

			

			// Sort Number Setup
			me.reset_sortOrderLists( tableTag );


			// Sort Direction Setup
			var sortDirectionTag = newRowTag.find( '.sortDirection' );
			sortDirectionTag.val( 'A' );	// Set is as defult


			me.setup_RowOnChangeEvent( newRowTag, newRowTag.find( '.typeValue' ), typeList );

			me.setup_RemoveRowEvent( tableTag, newRowTag );

			me.setUp_RowDragSort( tableTag, newRowTag );
			
			me.setup_FilterValueColumn( newRowTag );

			return newRowTag;
		};


		me.reset_sortOrderLists = function( tableTag )
		{
			// Step 1. Sort tabs by the order..
			var tagList = [];
			
			var sortOrderTags = tableTag.find( '.sortNumber' );

			sortOrderTags.each( function( i ) {
				var tag = $( this );
				tagList.push( { 'val': Number( tag.val() ), 'tag': tag } );
			});


			var sortedListTags = Util.sortByKey( tagList, 'val' );
			var listJson = [];
			
			// Step 2. Set the trimmed value + create 'listJson' for new listing
			var iSortNum = 1;
			$.each( sortedListTags, function( i_tag, item_tag ) {
				if ( item_tag.val > 0 ) {
					item_tag.tag.val( iSortNum );
					iSortNum++;
				}

				var countNumber = i_tag + 1;
				listJson.push( { 'id': countNumber, 'name': countNumber } );
			});


			// Step 3. Switch back 0 to empty value - was set on top
			sortOrderTags.each( function( i ) {
				var tag = $( this );
				if ( tag.val() == 0 ) tag.val( '' );
			});


			// Step 4. Re-list the dropdown selections with value copy
			Util.reset_tagsListData( sortOrderTags, listJson );

		}


		// -----------------------------
		// -- Events Related

		me.setUp_viewPivotTagChange = function( viewPivotTag )
		{
			viewPivotTag.change( function()
			{				
				// Save the column setting Table data
				me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );

				me.markForPivotLevelRow( me.viewColumnsTableTag );

				// If the data listing Table has 'Run' status, run it again
				me.oProviderNetwork.rerunDataListing();

				me.afterRender();
			});
		};


		//me.setup_ApplyRowEvent = function( trViewRowTag )
		me.setup_RowOnChangeEvent = function( trViewRowTag, valueTdTag, typeList )
		{
			me.paintEmptyValues( trViewRowTag );

			// Name Change Event
			trViewRowTag.find( '.settingName' ).change( function()
			{
				if ( $( this ).val() == "" ) Util.paintWarning( $( this ) );
				else Util.paintWhite( $( this ) );

				me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );

				// After change of name, redo the name on data listing column
				me.oProviderNetwork.dataList_renameColumnHeader( trViewRowTag, me.viewColumnsTableTag );

				me.oProviderNetwork.dataList_makeTableSortable();
			});


			// Type Change Event
			trViewRowTag.find( '.settingType' ).change( function()
			{
				var selectedType = $( this ).val();

				if ( selectedType == "" ) Util.paintWarning( $( this ) );
				else Util.paintWhite( $( this ) );


				// Has 'Value' change events in it.
				me.populateTypeValues( trViewRowTag, selectedType, typeList, valueTdTag );

				// Save the row info and update the Pivot Level setting..
				me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );

				me.markForPivotLevelRow( me.viewColumnsTableTag );

				me.oProviderNetwork.dataList_setUpColumnTags( trViewRowTag, me.viewColumnsTableTag );

				// Since 'Value' is empyt, it will simply clean it by this.
				me.oProviderNetwork.dataList_populateColumnData( trViewRowTag );				

			});


			// Setting Sort Change Event
			trViewRowTag.find( 'select.sortNumber,select.sortDirection' ).change( function()
			{
				var parentTag = $( this ).closest( 'td' );
				var sortDirectionTag = parentTag.find( '.sortDirection' );

				if ( $( this ).hasClass( 'sortNumber' ) && Util.checkValue( $( this ) ) )
				{
					if ( !Util.checkValue( sortDirectionTag.val() ) ) sortDirectionTag.val( 'A' );
					
					// Check duplicate sort-number
					var selectedSortNumber = $( this ).val();
					trViewRowTag.closest( 'div' ).css( "border-color", "" );
					trViewRowTag.closest( "tbody" ).find( "select.sortNumber" ).each( function( i, item )
					{
						var sortNumberTag = $( item );
						if( selectedSortNumber != "" && sortNumberTag.val() != ""
							&& i !== trViewRowTag.index() 
							&& sortNumberTag.val() === selectedSortNumber )
						{
							sortNumberTag.val( "" );
							sortNumberTag.closest( 'div' ).css( "border-color", "red" );
						}
						else
						{
							sortNumberTag.closest( 'div' ).css( "border-color", "" );
						}
					});
				}

				me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );

				me.oProviderNetwork.dataList_makeTableSortable();
			});

		};


		me.setup_ValueChangeEvent = function( trViewRowTag )
		{
			// Value Change Event
			trViewRowTag.find( '.settingValue' ).change( function()
			{
				if ( $( this ).val() == "" ) Util.paintWarning( $( this ) );
				else Util.paintWhite( $( this ) );

				// Save and populate data on data listing table
				me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );

				me.markForPivotLevelRow( me.viewColumnsTableTag );

				me.oProviderNetwork.dataList_setUpColumnTags( trViewRowTag, me.viewColumnsTableTag );
									
				me.oProviderNetwork.dataList_populateColumnData( trViewRowTag );

				me.oProviderNetwork.removeSorting_DataListingTable();
			});


			trViewRowTag.find( 'button.popupAction' ).click( function()
			{
				me.analyticEditPopupForm.openForm( $(this).closest("tr") );

				// Save and populate data on data listing table
				//me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );
			});

		};


		me.addNewRowBtnTag.click( function()
		{
			var trViewRowTag = me.createNewRow( me.viewColumnsTableTag, me.typeList, undefined, me.getNextRowId( me.viewColumnsTableTag ) );
			
			// Paint if emtpy - initially.
			me.paintEmptyValues( trViewRowTag );
			

			// Save the column setting Table data
			me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );

			me.markForPivotLevelRow( me.viewColumnsTableTag );

			me.oProviderNetwork.dataList_setUpColumnTags( trViewRowTag, me.viewColumnsTableTag );

		});


		me.setup_RemoveRowEvent = function( tableTag, trRow )
		{
			trRow.find( 'input.settingRemove' ).click( function()
			{
				trRow.hide( _middleSpeed, function()
				{
					trRow.remove();

					me.reset_sortOrderLists( tableTag );

					// Save the column setting Table data
					me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );

					me.oProviderNetwork.dataList_removeColumn( trRow.attr( 'rowid' ) );

				});
			});
		};

		me.setUp_RowDragSort = function( tableTag, trRowTag )
		{
			tableTag.tableDnD(
			{
				onDrop: function( table, row ) {
					console.log( 'moved row Num:' + $( row ).attr( 'rowid' )  );

					me.oProviderNetwork.reorderDataListColumns( me.viewColumnsTableTag );
					
					// Save the column setting Table data
					me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );

				},
				dragHandle: ".dragHandle"
			});

			//trRowTag.off( 'mouseenter mouseleave' ).hover( 
			trRowTag.hover( 
			function() 
			{
				$( this.cells[0] ).addClass( 'showDragHandle' );
			}
			, function() 
			{
				$( this.cells[0] ).removeClass( 'showDragHandle' );
			});
		};
		
		me.setup_FilterValueColumn = function( trRowTag )
		{
			var inputTag = trRowTag.find( 'input.settingFilter' );
			inputTag.click( function()
			{
				me.setup_filterValueDialog( trRowTag );
				var operatorTag = me.filterValuePopupTag.find("#filterOperator");
				var filterValueTag = me.filterValuePopupTag.find("#filterValue");
				
				if( inputTag.attr("filtervalue") !== undefined && inputTag.attr("filtervalue") != "" ){
					var filter = JSON.parse( inputTag.attr("filtervalue") );
					operatorTag.val( filter.operator );
					filterValueTag.val( filter.value );
				}
				else
				{
					operatorTag.val( "" );
					filterValueTag.val( "" );				
				}
				operatorTag.change();
				me.filterValuePopupTag.dialog("open");					
			});
		};
		
		me.setup_filterValueDialog = function( trRowTag )
		{
			me.filterValuePopupTag.dialog({
				  autoOpen: false
				  ,title: "Filter Value Setting"
				  ,width: me.filterValuePopupTag.attr('formWith')
				  ,height: me.filterValuePopupTag.attr('formHeight')				  
				  ,modal: true				
				  ,close: function( event, ui ) 
					{
						me.filterValuePopupTag.dialog("close");
					}				
					,buttons: {
						"Remove": function() 
						{
							var settingFilterBtnTag = trRowTag.find( 'input.settingFilter' );
							var operatorTag = me.filterValuePopupTag.find("#filterOperator");
							var valueTag = me.filterValuePopupTag.find("#filterValue");
							Util.paintBorderClear( operatorTag );
							Util.paintBorderClear( valueTag );

							settingFilterBtnTag.attr("filterValue", "" );
							settingFilterBtnTag.addClass( "dimImgWHover" );
							settingFilterBtnTag.attr("title", "[empty]" );

							me.oProviderNetwork.dataListingTableManager.dataRetrieveCount = 0; //dataListingTableTag.find("tbody tr").length;

							me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );

							// After change of name, redo the name on data listing column
							me.oProviderNetwork.dataList_renameColumnHeader( trRowTag, me.viewColumnsTableTag );

							me.oProviderNetwork.dataList_makeTableSortable();
							
							// Set filter setting for column of tables
							var dataListingTableManager = me.oProviderNetwork.dataListingTableManager;
							var dataListingTableTag = dataListingTableManager.dataListingTableTag;
							var rowId = trRowTag.attr("rowid");
							dataListingTableTag.find("tr th[rowId=" + rowId + "]").removeAttr("filterValue");

							// Filter values							 
							dataListingTableManager.filterTableValue( dataListingTableManager.dataListingTableTag );
							
							/*
							// Compose Run Result Message
							var viewColumnsTableManager = me.oProviderNetwork.viewManager.viewColumnsTableManager;							
							var messageText = 'Pivot: ' + viewColumnsTableManager.getPivotName();							
							var groupFilterName = viewColumnsTableManager.getPivotFilterGroupName();

							if ( groupFilterName != "" )
							{
								messageText += ', OUGroup Filter: ' + groupFilterName;
							}

							var tableBodyTag = dataListingTableTag.find( 'tbody' );
							messageText += ', OU Found: ' + tableBodyTag.find("tr:visible").length;
							

							// Display message
							MsgManager.networkListingMsgShow( messageText );
							*/
									
							me.filterValuePopupTag.dialog("close");
						},
						"Save": function() {
							var settingFilterBtnTag = trRowTag.find( 'input.settingFilter' );
							var operatorTag = me.filterValuePopupTag.find("#filterOperator");
							var operator = operatorTag.val();
							var valueTag = me.filterValuePopupTag.find("#filterValue");
							
							Util.paintBorderClear( operatorTag );
							Util.paintBorderClear( valueTag );

							if( operator == "" || valueTag.val() == "" )
							{
								if( operator == "" ){
									Util.paintBorderWarning( operatorTag );
								}
								if( valueTag.val() == "" )
								{
									Util.paintBorderWarning( valueTag );							
								}
								
								alert( "Please fill all madatory fields first." );
							}
							else if( operator != "" && valueTag.val() != "" )
							{
								if( ( operator == 'less_than' || operator == 'less_equals' || operator == 'greater_than' || operator == 'greater_equals' ) && !Util.isNumeric(valueTag.val() ) && !Util.isDate( valueTag.val() )  )
								{
									Util.paintBorderWarning( valueTag );
									alert( "Please enter a number/date in 'Filter' field." );
								}
								else
								{
									var json_Data = {
										"operator" : operatorTag.val(),
										"value" : valueTag.val()
									};
									settingFilterBtnTag.attr( "filterValue", JSON.stringify( json_Data ) );

									settingFilterBtnTag.attr( "title", "Filter : " + me.filterValuePopupTag.find("#filterOperator option[value='" + operatorTag.val() + "']").text() + " '" + json_Data.value + "'");
									settingFilterBtnTag.removeClass( "dimImgWHover" );


									me.oProviderNetwork.dataListingTableManager.dataRetrieveCount = 0; //dataListingTableTag.find("tbody tr").length;

									me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );

									// After change of name, redo the name on data listing column
									me.oProviderNetwork.dataList_renameColumnHeader( trRowTag, me.viewColumnsTableTag );

									me.oProviderNetwork.dataList_makeTableSortable(); 
									
									// Set filter setting for column of tables
									var dataListingTableManager = me.oProviderNetwork.dataListingTableManager;
									var dataListingTableTag = dataListingTableManager.dataListingTableTag;
									var rowId = trRowTag.attr("rowid");
									dataListingTableTag.find("tr th[rowId=" + rowId + "]").attr("filterValue", JSON.stringify( json_Data ) );
									
									// Filter values
									dataListingTableManager.filterTableValue( dataListingTableTag );

									/*		
									// Compose Run Result Message
									var viewColumnsTableManager = me.oProviderNetwork.viewManager.viewColumnsTableManager;							
									var messageText = 'Pivot: ' + viewColumnsTableManager.getPivotName();							
									var groupFilterName = viewColumnsTableManager.getPivotFilterGroupName();

									if ( groupFilterName != "" )
									{
										messageText += ', OUGroup Filter: ' + groupFilterName;
									}

									var tableBodyTag = dataListingTableTag.find( 'tbody' );
									messageText += ', OU Found: ' + tableBodyTag.find("tr:visible").length;
									
									// Display message
									MsgManager.networkListingMsgShow( messageText );
																		
									*/

									
									me.filterValuePopupTag.dialog("close");
								}
							}
						}
					}				
				});
		};
		

		me.setup_OrgunitGroupFilterChange = function()
		{

			me.addOrgunitFilterTBTag.click( function(){			
				me.createNewOUGroupFilterRow();				 
			});	


			me.applyOUGroupFilterBtnTag.click( function()
			{			
				// If the data listing Table has 'Run' status, run it again
				me.oProviderNetwork.rerunDataListing();

				me.afterRender();	 
			});
			
		};
		
		me.createNewOUGroupFilterRow = function( selectedValue )
		{
			me.loadOUGroupList( function( orgUnitGroups ){
				
				// Selector for filter
				var selector = $("<select class='ouGroupFilter' style='width:200px;'></select>" );
				Util.populateSelectDefault( selector, '[Please selected]', orgUnitGroups );
				
				// Set value for filter field
				if( selectedValue !== undefined ){
					selector.val( selectedValue );
				}
				
				var rowTag = $( "<tr></tr>" );
				var noCell = $("<td>#</td>");
				var firstCell = $("<td></td>");
				firstCell.append( selector );	
				var secondCell = $("<td><input type='image' class='removeOUGroupFilter dimImgWHover' alt='Delete Row' title='Delete Row' src='img/cross.png' style='border: 0px solid;' /></td>");
				rowTag.append( noCell );
				rowTag.append( firstCell );
				rowTag.append( secondCell );
				
				// Set event for removing row button
				me.setupEvent_OUGroupFilter( rowTag );
				
				me.viewOrgunitFilterTBTag.append( rowTag );	
			
			}); 
			
		};
		
		me.setupEvent_OUGroupFilter = function( rowTag )
		{
			rowTag.find("select.ouGroupFilter").change( function(){					
				// Save the column setting Table data
				me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );
				
				Util.disableTag( me.applyOUGroupFilterBtnTag, false );				
			});

			rowTag.find("input.removeOUGroupFilter").click( function(){
				var groupId = rowTag.find("select.ouGroupFilter").val();				
				rowTag.remove();
				if( groupId != "" )
				{
					// Save the column setting Table data
					me.saveViewColumnsInfo( me.viewColumnsTableTag, me.viewPivotTag );
					Util.disableTag( me.applyOUGroupFilterBtnTag, false );
				}
			});
		};
		
		me.loadOUGroupList = function( doneFunc )
		{
			var queryURL = _queryURL_api + 'organisationUnitGroups.json?paging=false&fields=id,name,displayName';
			
			RESTUtil.retrieveManager.retrieveData( queryURL, function( json_Data )
			{
				if ( json_Data !== undefined && json_Data.organisationUnitGroups !== undefined )
				{
					var orgUnitGroups = Util.sortByKey( json_Data.organisationUnitGroups, "name" );

					if( doneFunc !== undefined ) doneFunc( orgUnitGroups );
				}
			});
		};
		
		
		// -- Events Related
		// -----------------------------


		me.setDisplay_OUGroupUse = function( divViewPivot_OUGroupUseTag )
		{
			divViewPivot_OUGroupUseTag.hide();			
			me.pivotFilterGroupName = '';

			var pivotGroupId = me.getPivotFilterGroupId();

			if ( Util.checkValue( pivotGroupId ) )
			{
				// Get OU Group and update <-- use the memory retrieve
				var queryURL = _queryURL_api + "organisationUnitGroups/" + pivotGroupId + ".json?fields=name";

				RESTUtil.retrieveManager.retrieveData( queryURL, function( json_Data )
				{
					if ( json_Data !== undefined )
					{
						me.pivotFilterGroupName = json_Data.name;

						var ouGroupText = "*<span style='text-decoration: underline;'>'" + json_Data.name + "'</span> orgUnit group used.";

						divViewPivot_OUGroupUseTag.find( 'span' ).html( ouGroupText );

						divViewPivot_OUGroupUseTag.show( 'fast' );
					}
				});

			}

		};

		// ----------------------------------------------------------

		// Method to be called after a change on 'ViewColumn' Section
		me.afterRender = function()
		{
			// Depending on pivot selection, set ouGroup Use indicator
			me.setDisplay_OUGroupUse( me.divViewPivot_OUGroupUseTag );
		};

		// Retrieve and popoulate the Network View Data
		me.retrieveAndPopulate = function( selectedNetworkName, runFunc )
		{
			me.viewManager.getNetworkCurrentViewObjData( function( json_Data )
			{
				json_Data.useNetworkChild = me.oProviderNetwork.getSelectedNetworkData().useNetworkChild;

				me.populateViewColumnsTable( me.viewColumnsTableTag, json_Data );

				me.markForPivotLevelRow( me.viewColumnsTableTag );

				me.viewData = json_Data;
				
				me.afterRender();

				runFunc( me.viewColumnsTableTag );				
			});
			
		};
		

		me.setup_AttributeVariables = function( orgUnitAttributeManager, typeList ) //, orgUnitPopupManager )
		{
			var ouAttributes = orgUnitAttributeManager.getOrgUnitAttributeList();

			var networkAttributes = Util.getFromList( typeList, 'OrgUnitAttr' );
			var networkChildAttributes = Util.getFromList( typeList, 'OrgUnitAttr_NC' );

			$.each( ouAttributes, function( i_attr, item_attr )
			{
				networkAttributes.values.push( item_attr );				
				networkChildAttributes.values.push( item_attr );				
			});
		};


		me.resetSection = function()
		{
			// Reset dataListingTableManager as well.
			me.oProviderNetwork.dataList_resetSection();
		};


		// Initial Setup Call
		me.initialSetup();

	}

	// -- ViewColumnsTableManager Class
	// -------------------------------------------


	// -------------------------------------
	// -- OrgUnit Search Manage Class

	function OrgUnitSearchManager( oProviderNetwork, userInfo, onOrgUnitSelect )
	{
		var me = this;

		me.oProviderNetwork = oProviderNetwork;
		me.userInfo = userInfo;
		me.onOrgUnitSelect = onOrgUnitSelect;

		me.orgUnitNameTag = $( '#orgUnitName' );	// Default OrgUnit Search By Name
		me.orgUnitTreeBtnTag = $( '#orgUnitTreeBtn' );

		// OrgUnit Selection Tree Popup
		me.orgUnitSelectionTreePopup = new OrgUnitSelectionTreePopup();

		me.orgUnitSearchRequests = [];
		me.orgUnitSearchParentsRequests = [];

		me.queryURL_OrgUnitNameQuery = _queryURL_api + 'organisationUnits.json?paging=false&fields=name,id,level,ancestors[id,name,level]&filter=name:ilike:';

		me.orgUnitSelectedId;


		// ===============================================

		me.initialSetup = function( )
		{	
			me.setUp_OrgUnitSearch_AutoComplete( me.orgUnitNameTag );

			me.setUp_orgUnitTreePopup( me.selectOrgUnitAction );
		};

		// ===============================================


		me.resetSection = function()
		{
			// TODO: later, remove the selection (if saved in memory)
			me.orgUnitSelectedId = undefined;

			me.orgUnitNameTag.val( '' );
		}


		me.getNetworkData = function()
		{
			var data = { "hasData":false, "countryUid":"", "ouLvlFilter":"" };

			var networkSettingData = me.oProviderNetwork.getSelectedNetworkData();

			if ( networkSettingData )
			{
				data.hasData = true;
				data.countryUid = networkSettingData.countryInfo.id;
				
				var ouTopLvl = networkSettingData.Network_LVL;
				var ouBottomLvl = ( networkSettingData.useNetworkChild ) ?  networkSettingData.NetworkChild_LVL : networkSettingData.Network_LVL;

				data.ouLvlFilter += '&filter=level:ge:' + ouTopLvl + '&filter=level:le:' + ouBottomLvl;
			}
			else
			{
				alert( 'Could not find network setting data.' );
			}

			return data;
		}


		me.setUp_OrgUnitSearch_AutoComplete = function( orgUnitNameTag )
		{
			orgUnitNameTag.autocomplete( {
				source: 
					function( request, response ) 
					{
						orgUnitNameTag.removeClass( "ui-autocomplete-loading" );

						// Reset orgUnitSelectedId and below section		
						var json_orgUnitList_new = new Array();

						
						var searchWords = Util.trim( request.term );

						// Limit the text as at least 2
						if ( searchWords.length >= 2 )
						{

							var networkData = me.getNetworkData();

							if ( networkData.hasData )
							{

								var xhr_ouSearch = RESTUtil.getAsynchData( me.queryURL_OrgUnitNameQuery + searchWords + networkData.ouLvlFilter
								, function( json_orgUnits ) 
								{

									var json_orgUnitList = json_orgUnits.organisationUnits;


									if( Util.checkDataExists( json_orgUnitList ) )
									{
										
										var deferredArrActions_ouAccessCheck = [];

										// mark it as parents - used in user permission check
										AppUtil.copyAncestorsToParents( json_orgUnitList );

										$.each( json_orgUnitList, function( i_ou, item_ou)
										{

											if ( me.checkUserAccessable( me.oProviderNetwork.loadedInfo.userInfo, item_ou.parents ) && me.checkUnderCountry( item_ou.parents, networkData.countryUid ) )
											{
												json_orgUnitList_new.push( me.getOUSelectionFormatted( item_ou, item_ou.parents ) );
											}
										});


										// 'deferredArrActions_ouAccessCheck' is not being used anymore
										$.when.apply($, deferredArrActions_ouAccessCheck ).then( function( ) 
										{
											QuickLoading.dialogShowRemove( 'orgUnitLoading' );

											var json_orgUnitList_new_Sorted = Util.sortByKey( json_orgUnitList_new, "value" );

											response( json_orgUnitList_new_Sorted );
										});
									}
								}
								, function() {}
								, function() { QuickLoading.dialogShowAdd( 'orgUnitLoading' ); }
								, function() { QuickLoading.dialogShowRemove( 'orgUnitLoading' ); }
								);

								me.orgUnitSearchRequests.push( xhr_ouSearch );

							}
							else
							{
								console.log( "Does not have 'Network Data'.  Found out what is going on." );
							}

						}
						else
						{
							response( json_orgUnitList_new );

							Util.paintAttention( orgUnitNameTag );
						}
					}
				,minLength: 0
				,delay: 800
				,select: 
					function( event, ui ) 
					{							
						me.orgUnitSelectionTreePopup.selectOrgUnit( ui.item.orgUnit.id, ui.item.parents );

						// On select, set orgunit info and perform followup steps
						me.selectOrgUnitAction( ui.item.orgUnit );

						orgUnitNameTag.removeClass( "ui-autocomplete-loading" );
						orgUnitNameTag.autocomplete( "close" );
					}
			} );
		}


		me.checkUserAccessable = function( userInfo, parentOUs )
		{
			var isUserAccessOU = false;

			if ( Util.checkValue( parentOUs ) )
			{
				$.each( parentOUs, function( i_parentOU, item_parentOU )
				{
					$.each( userInfo.organisationUnits, function( i_userOU, item_userOU)
					{
						if ( item_userOU.id == item_parentOU.id )
						{
							isUserAccessOU = true;
							return false;
						}
					});

					if ( isUserAccessOU ) return false;
				});
			}

			return isUserAccessOU;
		}


		me.checkUnderCountry = function( parentOUs, countryUid )
		{
			var foundMatch = false;

			if ( Util.checkValue( parentOUs ) )
			{
				$.each( parentOUs, function( i_parentOU, item_parentOU )
				{
					if ( item_parentOU.id == countryUid )
					{
						foundMatch = true;
						return false;
					}
				});
			}

			return foundMatch;
		}


		me.getOUSelectionFormatted = function( item_ou, parents )
		{
			var itemLabel = item_ou.name + " ( lvl:" + item_ou.level;

			if ( Util.getNotEmpty( item_ou.code ).length > 0)
			{
				itemLabel += ", code:" + Util.getNotEmpty( item_ou.code );
			}

			itemLabel += " )";

			return { "id": item_ou.id, "label": itemLabel, "value": item_ou.name, "orgUnit": item_ou, "parents": parents };
		}


		// On select, set orgunit info and perform followup steps
		me.selectOrgUnitAction = function( orgUnit )
		{
			me.setOrgUnitTags( orgUnit );

			if ( me.onOrgUnitSelect !== undefined ) me.onOrgUnitSelect( orgUnit );
		}


		me.setOrgUnitTags = function( orgUnit ) 
		{
			me.orgUnitNameTag.val( orgUnit.name );
			me.orgUnitSelectedId = orgUnit.id;

			//Util.paintClear( me.orgUnitNameTag );
		}


		me.setUp_orgUnitTreePopup = function( onOrgUnitSelectFunc )
		{
			me.orgUnitTreeBtnTag.click( function()
			{
				me.orgUnitSelectionTreePopup.openForm();

				//return false;
			});

			me.orgUnitSelectionTreePopup.onOrgUnitSelectSet( onOrgUnitSelectFunc );
		}

		// ========================================================

		// Initial Setup Call
		me.initialSetup( );
	}

	// -- OrgUnit Search Manage Class
	// -------------------------------------


	// -------------------------------------
	// -- Data Table Manage Class

	function DataListingTableManager( oProviderNetwork )
	{
		var me = this;

		me.oProviderNetwork = oProviderNetwork;

		// OrgUnitMap Popup
		me.orgUnitPopupManager = new OrgUnitPopupManager( $( '#orgUnitInfoDialogForm' ), $( '#divOrgUnitMap' ), me, oProviderNetwork );

		me.divOrgUnitTableTag = $( '#divDataListing' );

		me.dataListingTableTag = me.divOrgUnitTableTag.find( '.tbDataListingTable' );

		me.runBtnTag = $( '#runBtn' );

		me.searchTextBoxTag = $( '#searchTextBox');
		me.searchResultTag = $( '#searchResult' );				

		me.excelDownloadTag = $( '#excelDownload' );

		me.orgUnitAddTabTag = $( '#orgUnitAddTab' );


		me.divDraggerStr_disable = '<div class="dragtable-drag-handle" style="display: none;"></div>';

		me.divDraggerStr_Defined = ( _enable_ColumnDrag ) ? '<div class="dragtable-drag-handle"></div>' : me.divDraggerStr_disable;

		me.rowTemplate_Pivot = '<tr class="trData" ouid="" parentNetworkId=""></tr>';

		me.dataLoadingTemplateMain = '<div class="dataLoading main" style="display:none;"><img src="img/ui-anim_basic.gif"/></div>';

		me.dataLoadingTemplateSub = '<div class="dataLoading sub" style="display:none;"><img src="img/ui-anim_basic.gif"/></div>';

		me.divNetworkChildDataTemplate = '<div class="divNetworkChildData"></div>';

		me.childEmptyDefault = '<span style="color:White;">-</span>';

		me.PARAM_ORGUNIT = "{OrgUnit-ID}";
		
		me.providersData;

		me.hasRunState = false;
		me.sortPerformedBefore = false;

		me.dataRetrieveCount = 0;
		me.finishCount = 0;

		me.pivotOrgUnitRetrieved_InMemory;
		me.nonPivotOrgUnitRetrieved_InMemory;

		me.addClickedRowOuId = "";


		// -------------------------------------------
		// InitialSetup & Setup Methods

		me.initialSetup = function()
		{	
			me.resetSection();

			me.setUp_Events();
		};

		// InitialSetup Methods
		// -------------------------------------------

		// -------------------------------------------
		// -- Calls from InitialSetup 

		me.resetSection = function()
		{
			me.hideSection();

			me.hasRunState = false;

			// Clear Table Data
			me.dataListingTableTag.find( 'tr' ).remove();

			me.dataRetrieveCount = 0;
		};


		me.setUp_Events = function()
		{
			me.setup_searchEvent( me.searchTextBoxTag );

			me.setUp_runBtn_Action( me.runBtnTag );

			if ( _enable_ColumnDrag ) me.setUp_tableDraggable();


			// Excel download click setup
			me.excelDownloadTag.click( function()
			{
				// Remove all the dataLoading divs, so that excel does not get extra rows for these.
				me.dataListingTableTag.find( '.dataLoading' ).remove();

				return ExcellentExport.excel( this, 'datatable', 'networkData' );
			});
		}


		// This should be placed in DataTable class or Provider Network Class!!!!
		me.setUp_runBtn_Action = function( runBtnTag )
		{
			runBtnTag.on( 'click', function()
			{
				me.clearData = true;
				
				me.clearSearchRelatedTags();
				
				me.removeSorting_DataListingTable();

				var viewColumnsTableManager = me.oProviderNetwork.viewManager.viewColumnsTableManager;

				me.runDataListing( viewColumnsTableManager );			
			});
		};


		me.runDataListing = function( viewColumnsTableManager )
		{
			// Check for DHIS session connection first.
			AppUtil.checkAndRedirect_DHISSession( function()
			{
				me.showSection();
			
				me.hasRunState = true;
				me.dataRetrieveCount = 0;

				// Clear Table Data (Not Header, though)
				me.dataListingTableTag.find( 'tr.trData' ).remove();


				// Get varialbe/tags/etc for later use.
				var viewColumnTable = viewColumnsTableManager.viewColumnsTableTag;
				var networkData = me.oProviderNetwork.getSelectedNetworkData();
				var selectedCountryInfo = networkData.countryInfo;
				var pivotLevel = viewColumnsTableManager.getPivotLevel();
				var pivotName = viewColumnsTableManager.getPivotName();
				var pivotGroupIdFilter = viewColumnsTableManager.getPivotFilterGroupId();


				// Cancel any existing Ajax requests
				AppUtil.cancelGetAsynchDataRequests();


				// 1. Retrieve Pivot ou lists first.  2. From that, create rows.  3. And then, based on view, create columns.
				me.retrievePivotOrgUnits( pivotGroupIdFilter, selectedCountryInfo, pivotLevel, function( json_ouData ) 
				{
					// sort by name
					me.orgUnitsNameTrim( json_ouData );
					var ouData = Util.sortByKey( json_ouData, "name" );
				
					// Store the retreived pivot info (id, name, level) for reuse on same info retrieval.
					me.setMemory_OrgUnitRetrieved( ouData );

					var tableBodyTag = me.dataListingTableTag.find( 'tbody' );

					
					// 2. Generate pivot column row data (orgunit list) and a footer one.
					me.pivotDataRowsCreate( ouData, tableBodyTag, pivotLevel, pivotName, selectedCountryInfo.id );


					// 3. Generate other rows of columns - other than the above pivot one.
					me.dataRow_SetColumnsAndPopulateData( me.dataListingTableTag, viewColumnTable );


					// Apply sorting on table data if no ajax calls were made
					me.applySortingIfReady( me.dataRetrieveCount );

				});
			});
		};

		// -- Calls from InitialSetup 
		// -------------------------------------------

		// -------------------------------------------
		// Exposed Methods

		me.getDataListingTableTag = function()
		{
			return me.dataListingTableTag;
		};

		me.generateSingleRow_byOrgUnt = function( ouData, returnFunc )
		{			
			var tableBodyTag = me.dataListingTableTag.find( 'tbody' );
			var viewColumnTable = me.oProviderNetwork.viewManager.viewColumnsTableManager.viewColumnsTableTag;


			// Generate pivot column row data (orgunit list) and a footer one.
			var trRow = me.pivotDataRowCreate( ouData, tableBodyTag );

			// Display message
			//MsgManager.networkListingMsgShow( 'OrgUnit Added: ' + ouData.name );
			MsgManager.msgAreaShow( 'OrgUnit Added: ' + ouData.name );

			// Generate other rows of columns - other than the above pivot one.
			me.dataRow_SetColumnsAndPopulateData( me.dataListingTableTag, viewColumnTable, ouData );

			return trRow;
		};


		me.showSection = function()
		{
			me.divOrgUnitTableTag.show();
			me.dataListingTableTag.show( 'medium' );
		};

		me.hideSection = function()
		{
			me.divOrgUnitTableTag.hide(  );
			me.dataListingTableTag.hide( 'fast' );
		};

		me.runBtnSectionVisibility = function( show )
		{
			if ( show )
			{
				me.runBtnTag.show( 'medium' );
			}
			else
			{
				me.runBtnTag.hide();
				//me.runBtn_loadingTag.hide();
			}
		};

		me.rerunDataListing = function()
		{
			me.runBtnTag.click();
		};


		me.reorderDataListColumns = function( viewColumnsTableTag )
		{
			var viewTable_ColumnOrders = [];

			viewColumnsTableTag.find( 'tr.trDataNew' ).each( function( i )
			{
				viewTable_ColumnOrders.push( $( this ).find( 'input.settingName' ).val() );
			});

			if ( _enable_ColumnDrag ) me.dataListingTableTag.dragtable( 'order', viewTable_ColumnOrders );

			me.showSection();
		};


		me.getDivDragger = function()
		{
			return ( me.oProviderNetwork.viewManager.getCurrentViewPermission() ) ? me.divDraggerStr_Defined : me.divDraggerStr_disable ; 
		};


		me.setUp_DataListingColumns = function( columnTableTag )
		{
			var dataTableTag = me.dataListingTableTag;

			dataTableTag.find( 'tr' ).remove();
			
			dataTableTag.find( 'thead' ).append( '<tr class="trHeader tablesorter-headerRow"></tr>' );

			columnTableTag.find( 'tbody tr.trDataNew' ).each( function()
			{
				me.setUpColumnTags( $( this ), columnTableTag );
			});
			
		};

		// Exposed Methods
		// -------------------------------------------

		// -----------------------------------
		// Search Related

		me.setup_searchEvent = function( searchTag, callBackFunc )
		{
			searchTag.keyup( function()
			{
				var tableTag = me.dataListingTableTag;

				Util.paintClear( searchTag );
				Util.paintClear( tableTag.find( 'div.divTdData' ) );

				me.typewatch( function()
				{
					me.runSearch( searchTag, tableTag );

				}, 700 );
			});
		};


		me.typewatch = function()
		{
			var timer = 0;
			return function( callback, ms )
			{
				clearTimeout ( timer );
				timer = setTimeout( callback, ms );
			}  
		}();


		me.runSearch = function( searchTag, tableTag )
		{
			var trRows = tableTag.find( 'tbody tr.trData' );
			var searchKeyword = searchTag.val();

			// Hide main retrieval result when keyword search was performed.
			MsgManager.networkListingMsgHide();


			trRows.show();

			if ( searchKeyword.length > 0 )
			{

				var matchedRows = trRows.find( 'div.divTdData' ).filter( function()
				{
					return $( this ).text().match( new RegExp( searchKeyword, "ig" ) );
				});

				// Set to hide all, first
				trRows.hide();

				
				// Show the ones the matched
				matchedRows.each( function( i )
				{
					$( this ).closest( '.trData' ).show();
				});


				Util.paintSuccess( searchTag, true );

				// Message Found Count here....
				me.searchResultTag.text( matchedRows.length );

			}
			else
			{
				me.searchResultTag.text( '' );
			}
		};


		me.clearSearchRelatedTags = function()
		{
			me.searchTextBoxTag.val( '' );
			Util.paintClear( me.searchTextBoxTag );
			me.searchResultTag.text( '' );
		}

		// Search Related
		// -----------------------------------

		// ----------------------------------------
		// -------- Data Retrival Related ---------

		me.retrievePivotOrgUnits = function( pivotGroupIdFilter, countryInfo, pivotLevel, runFunc )
		{
			var hasPivotGroupFilter = ( Util.checkValue( pivotGroupIdFilter ) ) ? true : false;

			// is case - Network Group Filter?
			var queryUrl = me.getOrgUnitRetrievalURL( countryInfo, pivotLevel, hasPivotGroupFilter, pivotGroupIdFilter );


			// Get count first and compose right message to display during retrieval
			me.getOuCountMsg_SqlView( countryInfo, pivotLevel, hasPivotGroupFilter, pivotGroupIdFilter, function( retreivalMsg )
			{

				AppUtil.getAsynchData_WithPush( queryUrl, function( json_Data )
				{
					var orgUnitList = json_Data.organisationUnits;

					// If 'parents' are not available, construct 'parents' object from 'parent' recursive.
					// Also, if 'ancestors' exists, copy to 'parents'
					me.constructOuParents( orgUnitList );

					// Check if the list contains 'parents' info.
					me.checkAndAlert_OrgUnitParents( orgUnitList, function()
					{
						// Filter by the view orgUnits access..
						orgUnitList = me.filterOrgUnitByUserAccess( orgUnitList, me.oProviderNetwork.getUserPermission_OrgUnitAccess().Viewable );

						if ( hasPivotGroupFilter )
						{
							// Filter by level 
							orgUnitList = Util.findItemsFromList( orgUnitList, "level", pivotLevel );

							// Filter by country - using 'parents' 
							orgUnitList = me.filterOrgUnitByCountry( orgUnitList, countryInfo );
						}

						// Filter by view OUGroup Filter - using 'organisationUnitGroups' info in each orgUnit
						me.filterOrgUnitsByViewOUGroup( orgUnitList, function( ouFilterList )
						{

							MsgManager.networkListingMsgShow( 'Constructing datatable..', true, undefined, true );
							//MsgManager.divNetworkListingMsgTag.html( 'Constructing datatable..' );
							//MsgManager.divNetworkListingMsgAreaTag.show();

							// For displaying message before heavy js run, run after 1 sec..
							setTimeout( function()
							{
								runFunc( ouFilterList );
							}, 1000 );
						});

					});

				}
				, function() {}
				, function() 
				{ 
					MsgManager.networkListingMsgShow( retreivalMsg );
				}
				, function() 
				{
					//MsgManager.networkListingMsgHide();
					//MsgManager.networkListingMsgShow( 'Javascript Handling - and then sorting' );
				});
			});
		};


		// --------------------------------------------------------------------

		me.removeSorting_DataListingTable = function()
		{
			me.dataListingTableTag.find( 'th' ).off( 'click' );
			me.dataListingTableTag.find( 'th' ).removeClass( 'header' ).removeClass( 'headerSortUp' ).removeClass( 'headerSortDown' );
		};

		// ------------------------------------
		// -- Retrieval Memory Management

		me.getPivotOrgUnitRetrieved_ById = function( ouId )
		{
			return me.pivotOrgUnitRetrieved_InMemory[ ouId ];
		};

		me.setMemory_OrgUnitRetrieved = function( dataJson )
		{
			me.pivotOrgUnitRetrieved_InMemory = {};	// unique properties list
			me.nonPivotOrgUnitRetrieved_InMemory = {};

			// set with property..			
			$.each( dataJson, function( i_ou, item_ou )
			{
				me.setMemory_OrgUnitRetrieved_One_OrgUnit( item_ou );
			});
		};
		
		me.setMemory_OrgUnitRetrieved_One_OrgUnit = function( item_ou )
		{
			// Add Dynamic Attribute properties here
			me.setAttributeAsProperty( item_ou );
			
			if ( me.pivotOrgUnitRetrieved_InMemory ) me.pivotOrgUnitRetrieved_InMemory[ item_ou.id ] = item_ou;

			// For children or parent properties, set it as nonPivot.
			// If 'children' exists, that is the non-pivot child case.
			// Else if 'children' does not exists, check for 'parent' as non-pivot case
			if ( item_ou.children !== undefined )
			{
				$.each( item_ou.children, function( i_ouc, item_ouc )
				{
					me.setAttributeAsProperty( item_ouc );
				});
			}
			else if ( item_ou.parent !== undefined )
			{
				me.setAttributeAsProperty( item_ou.parent );
			}
		}

		me.setAttributeAsProperty = function( item_ou )
		{
			if ( item_ou.attributeValues !== undefined )
			{
				$.each( item_ou.attributeValues, function( i_av, item_av )
				{					
					item_ou[ AppUtil.dynamicAttrStr + item_av.attribute.id ] = item_av.value;
				});
			}
		};


		// -- Retrieval Memory Management
		// ------------------------------------


		// ============================================================
		// ---- SQL View Related ------------------------

		me.getOuCountMsg_SqlView = function( countryInfo, pivotLevel, hasPivotGroupFilter, pivotGroupIdFilter, returnFunc )
		{
			var retrievalMsg = "";
			var queryUrl = "";
			
			if ( hasPivotGroupFilter )
			{
				var viewColumnsTableManager = me.oProviderNetwork.viewManager.viewColumnsTableManager;

				retrievalMsg = " OrgUnits from OrgUnitGroup '" + viewColumnsTableManager.getPivotFilterGroupName() + "'";

				var _sqlView_NetworkListing_ougCount = 'DZH3dC2rcm3';

				queryUrl = _queryURL_api + 'sqlViews/' + _sqlView_NetworkListing_ougCount + '/data.json?var=ougid:' + pivotGroupIdFilter;

			}
			else
			{
				retrievalMsg = " OrgUnits (level " + pivotLevel + ") under country '" + Util.getNotEmpty( countryInfo.name ) + "'";

				var _sqlView_NetworkListing_ouCountInLevel = 'IA8tfwRSCOX';

				queryUrl = _queryURL_api + 'sqlViews/' + _sqlView_NetworkListing_ouCountInLevel + '/data.json?var=countryid:' + countryInfo.id + '&var=networklevel:' + pivotLevel;
			}


			AppUtil.getAsynchData_WithPush( queryUrl, function( json_Data )
			{
				var ouCount = me.getOuCount_SqlView( json_Data );

				if ( ouCount !== undefined )
				{
					returnFunc( "Searching through " + ouCount + retrievalMsg );
				}
				else
				{
					returnFunc( "Searching through" + retrievalMsg );
				}
			}
			, function()
			{
				returnFunc( "Searching through" + retrievalMsg );
			});
		}


		me.getOuCount_SqlView = function( json_Data )
		{
			var ouCount;

			if ( json_Data !== undefined && json_Data.rows !== undefined )
			{
				ouCount = json_Data.rows[0][0];
			}
			
			return ouCount;
		}

		// ---- SQL View Related ------------------------
		// ============================================================
		

		me.constructOuParents = function( orgUnitList )
		{

			// DHIS v2.20 vs v2.21 - If 'ancestors' exists, copy to 'parents'
			if ( me.oProviderNetwork.loadedInfo.ouParentsExists )
			{
				AppUtil.copyAncestorsToParents( orgUnitList );
			}


			if ( !me.oProviderNetwork.loadedInfo.ouParentsExists )
			{
				MsgManager.msgAreaShow( "'Parents'/'Ancestors' in OrgUnit not available.  Runing in slower mode." );

				$.each( orgUnitList, function( i_ou, item_ou )
				{
					item_ou.parents = [];
					me.getParentsObjFromParentStr( item_ou.level - 1, item_ou.parent, item_ou.parents );
				});
			}
		}


		me.getParentsObjFromParentStr = function( level, parentData, parentsList )
		{
			if ( level > 0 )
			{
				parentsList.push( { "id": parentData.id , "name": parentData.name , "level": level } );

				me.getParentsObjFromParentStr( level - 1, parentData.parent, parentsList );
			}
		}



		me.getOrgUnitRetrievalRootURL = function( countryInfo, pivotLevel, hasPivotGroupFilter, pivotGroupIdFilter, fieldParams )
		{
			var queryURL = "";

			if ( hasPivotGroupFilter )
			{
				queryURL = _queryURL_api + 'organisationUnitGroups/' + pivotGroupIdFilter + '.json?fields=organisationUnits[' + fieldParams + ']';				
			}
			else
			{
				var diffLevel = pivotLevel - countryInfo.level;
			
				queryURL = _queryURL_api + 'organisationUnits/' + countryInfo.id + '.json?level=' + diffLevel + '&fields=' + fieldParams;
			}

			return queryURL;
		}

		
		me.getOrgUnitRetrievalURL = function( countryInfo, pivotLevel, hasPivotGroupFilter, pivotGroupIdFilter  )
		{
			return me.getOrgUnitRetrievalRootURL( countryInfo, pivotLevel, hasPivotGroupFilter, pivotGroupIdFilter, me.getParamURLOrgUnitInfo() );
		}


		me.getParamURLOrgUnitInfo = function()
		{
			var viewColumnAttributes = me.oProviderNetwork.getViewQueryStrParameters();
			
			// if 'parents' on OU does not exists, get recursive 'parent' to top level, and use that info for creating 'parents' data.
			// 'parents' information is needed for security, etc..
			var ouParentToTopStr = "";
			if ( !me.oProviderNetwork.loadedInfo.ouParentsExists )
			{
				var viewColumnsTableManager = me.oProviderNetwork.viewManager.viewColumnsTableManager;
				var pivotLevel = Number( viewColumnsTableManager.getPivotLevel() );

				var ouParentToTopStr = me.getParentStrToTop( pivotLevel - 1 );
			}

			var ouParentStr = ( ouParentToTopStr != "" ) ? ouParentToTopStr : ',parent[id,name]';

			return 'id,name,displayName,level,parents[id,name,level],ancestors[id,name,level]' + ouParentStr + viewColumnAttributes;
		}


		me.getParentStrToTop = function( level )
		{
			if ( level > 0 )
			{
				return ",parent[id,name" + me.getParentStrToTop( level - 1 ) + "]";
			}
			else
			{
				return "";
			}
		}	



		// ------------------------------------------------
		// ----------- TO BE OBSOLETE ---------------------

		me.getViewOuGroups = function()
		{
			var viewOuGroupIds = [];

			if( me.oProviderNetwork.getViewData().filter !== undefined )
			{
				var filters = me.oProviderNetwork.getViewData().filter;
				
				$.each( filters, function( i, item )
				{
					if( item !== undefined && item != null )
					{
						viewOuGroupIds.push( item.value );
					}
				});
			}
			
			return viewOuGroupIds;
		}


		me.filterOrgUnitsByViewOUGroup = function( ouList, runFunc )
		{
			var ouData = [];

			var viewOuGroupIds = me.getViewOuGroups();

			if( viewOuGroupIds.length > 0 )
			{
				me.retrieveOuRelations( "OrgUnitRelations", "orgUnitGroups", function( relationData )
				{	
					$.each( ouList, function( i_ou, item_ou )
					{
						var searchGroupItem = Util.findItemFromList( relationData, "id", item_ou.id );
						var found = viewOuGroupIds.length;
						
						if( searchGroupItem.organisationUnitGroups.length == 0 )
						{
							found = 0;
						}
						else
						{
							found = 0;
							$.each( searchGroupItem.organisationUnitGroups, function( i_oug, item_oug )
							{
								$.each( viewOuGroupIds, function( i_voug, item_voug )
								{
									if ( item_oug.id == item_voug )
									{
										found++;
									}
								});

								if ( found == viewOuGroupIds.length ) return false;
							});
						
							if ( found == viewOuGroupIds.length ){
								ouData.push( item_ou );
							}
						}
					});
					
					runFunc( ouData );
				});
			}
			else
			{
				ouData = ouList;
			}
			
			runFunc( ouData );
		};



		me.filterOrgUnitByCountry = function( ouList, countryInfo )
		{
			var ouData = [];
		
			$.each( ouList, function( i_ou, item_ou )
			{
				if ( item_ou.parents !== undefined )
				{
					$.each( item_ou.parents, function( i_oup, item_oup )
					{
						if ( item_oup.level == countryInfo.level && item_oup.id == countryInfo.id )
						{
							ouData.push( item_ou );
							return false;
						}
					});
				}
			});

			return ouData;
		};


		me.checkAndAlert_OrgUnitParents = function( ouList, returnFunc )
		{
			if ( ouList.length > 0 && ouList[0].parents === undefined && ouList[0].ancestors === undefined )
			{
				alert( 'Issue: "Parents"/"Ancestors" data is not available in server.  Please restart Tomcat to see if "Parents"/"Ancestors" data becomes available.' );
			}
			else
			{
				returnFunc();
			}
		}


		me.filterOrgUnitByUserAccess = function( ouList, accessOrgUnits )
		{
			var ouList_New = [];

			// Check the orgUnit and the orgUnit's parents (all the way top) to see which orgUnits are 
			// allowed to be accessed by the user.
			$.each( ouList, function( i_ou, item_ou )
			{
				if ( me.checkOrgUnitUserAccess( item_ou, accessOrgUnits ) ) ouList_New.push( item_ou );
			});

			return ouList_New;
		}


		me.checkOrgUnitUserAccess = function( item_ou, accessOrgUnits, excludeSelf )
		{
			var hasAccess = false;

			// If the orgUnit is one of the viewable/editable orgUnit selection, add the orgUint to the new list.
			if ( Util.checkExistInList( accessOrgUnits, item_ou.id, "id" ) && ( excludeSelf === undefined ) )
			{
				hasAccess = true;
			}
			else
			{
				// If the orgUnit's parents (higher up) are one of the viewable/editable orgUnit selection, add the orgUnit to the new list.
				$.each( item_ou.parents, function( i_oup, item_oup )
				{
					if ( Util.checkExistInList( accessOrgUnits, item_oup.id, "id" ) )
					{
						hasAccess = true;
						return false;
					}						
				});
			}

			return hasAccess;
		}


		me.checkOrgunitEditPermission = function( orgUnit, orgUnitParent )
		{
			var checkPermission = false;

			var hasOrgUnitEditAuthority = me.oProviderNetwork.checkOrgunitEditAuthority();
			

			if ( orgUnit !== undefined && hasOrgUnitEditAuthority )
			{

				var dataCaptureOUs = me.oProviderNetwork.getUserPermission_OrgUnitAccess().Editable;

				// if parent ou were provided & permitted, the OU is permitted.
				if ( orgUnitParent !== undefined )
				{
					// If Network Child case, check with Network first.
					// If Network has permission, pass.  If not, check Network Child.
					var hasOrgUnitDataCapture = me.checkOrgUnitUserAccess( orgUnitParent, dataCaptureOUs );

					if ( !hasOrgUnitDataCapture )
					{
						hasOrgUnitDataCapture = Util.checkExistInList( dataCaptureOUs, orgUnit.id, "id" );
					}
				}
				else
				{
					var hasOrgUnitDataCapture = me.checkOrgUnitUserAccess( orgUnit, dataCaptureOUs );
				}

				if ( hasOrgUnitDataCapture ) checkPermission = true;
			}

			return checkPermission;
		};


		me.checkOrgunitAddNewChildPermission = function( orgUnit, parentId )
		{
			var checkPermission = false;
			var parents = orgUnit.parents;

			var hasOrgUnitEditAuthority = me.oProviderNetwork.checkOrgunitEditAuthority();
			
			if ( hasOrgUnitEditAuthority )
			{
				var dataCaptureOUs = me.oProviderNetwork.getUserPermission_OrgUnitAccess().Editable;

				// check the parents (except itself) to see if there is matches.
				checkPermission = me.checkOrgUnitUserAccess( orgUnit, dataCaptureOUs, parentId );
			}

			return checkPermission;
		};


		// -------- Data Retrival Related ---------
		// ----------------------------------------


		// ------------------------------------
		// -------- Populate Methods ---------

		me.removeColumn = function( rowid )
		{
			me.dataListingTableTag.find( 'th[rowid="' + rowid + '"],td[rowid="' + rowid + '"]' ).remove();
		};


		// Simply rename column header.
		me.renameColumnHeader = function( trViewRowTag, viewColumnsTable )
		{
			me.showSection();

			var title = trViewRowTag.find( 'input.settingName' ).val();

			var rowId = trViewRowTag.attr( 'rowid' );

			// Header Create - only if it does not already exists
			var existingHeaderTag = me.dataListingTableTag.find( 'tr.trHeader th[rowid="' + rowId + '"]' );

			if ( existingHeaderTag.length > 0 )
			{
				// if already exists, check the name change
				existingHeaderTag.find( 'span.headerName' ).text( title );
				existingHeaderTag.attr( 'data-header', title );
			}
		};

		me.checkOrgUnitNameAttrColumn = function( colType, settingValue, useNetworkChild )
		{
			return ( settingValue == "name" 
				&& ( colType == "OrgUnitAttr" || ( colType == "OrgUnitAttr_NC" && useNetworkChild ) ) );
		};
		

		// Setup the header and setup(initialize) the data columns (in each row) tags
		me.setUpColumnTags = function( trViewRowTag, viewColumnsTable, optional_SingleRow_OuData )
		{
			// This is mostly for generating column header / cell body frame at first time.
			// For 'Edit' case, only special cases were handled..

			var rowId = trViewRowTag.attr( 'rowid' );
			var analyticClearDataCase = ( me.clearData ) ? true : false;


			// CASE 1. If 'singleRow' option is passed, 
			//  'new' case - add data column cell 
			//  'update' case - on analytic case only, & 'clear' is set, clear the cell.  Otherwise, do nothing!!

			// CASE 2. If 'multipleRow' populate case, simple perform them!!

			if ( optional_SingleRow_OuData !== undefined )
			{
				// Populate Single Row Content Column (New Row / Edit case)
				// 'Edit' case, mostly do not do anything

				me.setup_BodyColumn( me.dataListingTableTag, rowId, optional_SingleRow_OuData, analyticClearDataCase );
			}
			else
			{
				// Setup Header/Content Column

				me.setup_HeaderColumn( me.dataListingTableTag, rowId, trViewRowTag, viewColumnsTable );

				me.setup_BodyColumn( me.dataListingTableTag, rowId, optional_SingleRow_OuData, analyticClearDataCase );
			}
		};


		me.setup_HeaderColumn = function( dataListingTableTag, rowId, trViewRowTag, viewColumnsTable )
		{

			var title = trViewRowTag.find( 'input.settingName' ).val();
			var type = trViewRowTag.find( 'select.settingType' ).val();

			var settingValue = trViewRowTag.find( 'select.settingValue' ).val();
			if ( settingValue !== undefined && settingValue != null && settingValue != "" ) settingValue = settingValue.replace("ougs_", "");

			var dataFilter_FromView = trViewRowTag.find( 'input.settingFilter' ).attr( "filterValue" );

			var existingHeaderTag = dataListingTableTag.find( 'tr.trHeader th[rowid="' + rowId + '"]' );


			// New Column Case
			if ( existingHeaderTag.length == 0 )
			{
				// Find previous colunm from Column setting table
				var previousRowIdInfo_header = me.getPreviousRowIdInfo( viewColumnsTable.find( 'tr.trDataNew[rowid]' ), rowId );

				var testPrev = ( previousRowIdInfo_header === undefined ) ? 'undefined' : 'not undefined';

				var thTag = $( '<th data-header="' + title + '" sorttable_customkey="' + rowId + '" rowid="' + rowId + '" style="white-space: nowrap;">' + me.getDivDragger() + '<span class="cpointer headerName">' + title + '</span></th>' );

				me.placeItInColumn( dataListingTableTag.find( 'tr.trHeader' ), 'th', previousRowIdInfo_header, rowId, thTag );

				me.check_SetOrgUnitAddBtn( thTag, type, settingValue );
			}
			else
			{
				// Set header name again - in case of change (from view table)
				existingHeaderTag.find( 'span.headerName' ).text( title );
				existingHeaderTag.attr( 'data-header', title );

				// Set dataFilter_FromView for header attribute
				if( dataFilter_FromView != "" ) existingHeaderTag.attr( 'filterValue', dataFilter_FromView );
				else existingHeaderTag.removeAttr( 'filterValue' );

				me.check_SetOrgUnitAddBtn( existingHeaderTag, type, settingValue );
			}
		}


		me.check_SetOrgUnitAddBtn = function( thTag, type, settingValue )
		{
			var useNetworkChild = me.oProviderNetwork.networkData.useNetworkChild;

			// If orgUnit Name column exists, add 'Add OrgUnit' button not already set
			// then, add 'Add OrgUnit' button
			if ( me.checkOrgUnitNameAttrColumn( type, settingValue, useNetworkChild ) && thTag.find( ".openOrgUnitForm" ).length == 0 )
			{
				var displayedAddBtn = ( me.oProviderNetwork.checkOrgunitEditAuthority() ) ? "" : "display:none;";

				var neworkTypeName = AppUtil.getNetworkTypeName_ByViewColumnType( type, me.oProviderNetwork );

				// Retrieve for orgUnit Level - if available.
				var orgUnitLevelName = AppUtil.getOrgUnitLevelName_ByNetworkType( neworkTypeName, me.oProviderNetwork.networkData, me.oProviderNetwork );
				
				thTag.append( '<button type="button" class="openOrgUnitForm steelBlueButton smallButton" style="margin-left:7px; ' + displayedAddBtn + '" networkType="' + neworkTypeName + '">Add ' + orgUnitLevelName + '</button>' );
				
				var buttonTag = thTag.find( "button.openOrgUnitForm" );				

				me.setupEvent_AddOrgUnit( buttonTag, neworkTypeName );
			}				
		}


		me.setup_BodyColumn = function( dataListingTableTag, rowId, optional_SingleRow_OuData, analyticClearDataCase )
		{

			var ouFilter = ( optional_SingleRow_OuData !== undefined ) ? '[ouid="' + optional_SingleRow_OuData.id + '"]' : '' ;


			// STEP 2. Column Body
			var existingContentTag = dataListingTableTag.find( 'tr.trData' + ouFilter + ' td[rowid="' + rowId + '"]' );


			if ( existingContentTag.length == 0 )
			{
				// create column contents placeholder

				// Body Create/Setup
				var header = dataListingTableTag.find( 'tr.trHeader' );
				var previousRowIdInfo_body = me.getPreviousRowIdInfo( header.find( 'th[rowid]' ), rowId );

				dataListingTableTag.find( 'tr.trData' + ouFilter ).each( function( idx, item )
				{
					var trDataRow = $( item );

					var bgColor = ( ouFilter != '' ) ? 'style="background-color:#B0FDA2"' : "";

					var tdTag = '<td ' + bgColor + ' rowid="' + rowId + '">'
						+ me.dataLoadingTemplateMain
						+ '<div class="divTdData"></div>'
						+ '</td>';

					me.placeItInColumn( trDataRow, 'td', previousRowIdInfo_body, rowId, tdTag );

				});
			}
			else
			{
				// existing cell, but not neccessarily 'update' case?
				// Must be the 'update' case!!

				// TODO: Ask Tran!!


				if( analyticClearDataCase ) 
				{
					existingContentTag.find( 'div.divTdData' ).html( '' );

					if( ouFilter != '' )
					{
						existingContentTag.closest( 'tr.trData' ).find( "td" ).css( "background-color", "#B0FDA2" );
					}
				}
			}			
		}


		me.setupEvent_AddOrgUnit = function( buttonTag, networkType, parentId, parentName )
		{
			buttonTag.off( "click" ).on( "click", function( e )
			{
			    if (!e) e = window.event;
			    e.stopPropagation();


				// Set addClickedRowOuId in global - for populating row right below it.
				// If header case, set is as empty.
				me.addClickedRowOuId = ( $( this ).closest( 'tr[ouid]' ).length > 0 ) ? $( this ).closest( 'tr[ouid]' ).attr( 'ouid' ) : "Top";


				// Prepare 'openForm' parameters
				var networkData = me.oProviderNetwork.getSelectedNetworkData();
				var orgUnitLevel = AppUtil.getNetworkLevel_ByNetworkType( networkType, networkData, me.oProviderNetwork );


				// Call orgUnit Popup's 'openForm' with parameters..
				me.orgUnitPopupManager.openForm( networkData.countryInfo, orgUnitLevel, networkType, "Add", undefined, undefined, parentId, parentName );

			});
		};

		// Set backgroundColor for pivotLevelColumn Heaaders
		me.setHeaderColor_PivotLevel = function( trViewRowTag )
		{
			
			var rowId = trViewRowTag.attr( 'rowid' );

			var dataListingColumnHeader = me.dataListingTableTag.find( 'tr.trHeader th[rowid="' + rowId + '"]' );
			

			var headerBackColor = "";
			if ( trViewRowTag.attr( 'isPivotLevel' ) == 'true' )
			{
				headerBackColor = me.oProviderNetwork.getPivotLevelColor();
			}

			dataListingColumnHeader.css( 'background-color', headerBackColor );
		};


		me.getPreviousRowIdInfo = function( refListTags, rowId )
		{
			var previousRowIdInfo;	// { rowId: 3, location: right/left }

			var tagRowIds = [];

			// put it on array
			refListTags.each( function()
			{
				tagRowIds.push( $( this ).attr( 'rowid' ) );
			});


			// get previousRowId (from left or right of it) with location info
			for ( i = 0; i < tagRowIds.length; i++ )
			{
				if ( tagRowIds[i] == rowId )
				{
					if ( i == 0 )
					{
						// Get next one as previousRowId
						previousRowIdInfo = { rowId: tagRowIds[ i + 1 ], loc: 'right' }
					}
					else
					{
						// Get next one as previousRowId
						previousRowIdInfo = { rowId: tagRowIds[ i - 1 ], loc: 'left' }
					}

					break;
				}
			}


			return previousRowIdInfo;
		};


		
		me.placeItInColumn = function( parentTag, tagType, previousRowIdInfo, rowId, insertTag )
		{
			// Based on ViewColumn rows, place datalisting table column

			var rowsTag = parentTag.find( tagType + '[rowid]' );
			insertTag = $(insertTag);

			if ( rowsTag.length == 0 )
			{
				parentTag.append( insertTag );
			}
			else
			{
				if ( previousRowIdInfo.loc == 'right' )
				{
					parentTag.find( tagType + '[rowid="' + previousRowIdInfo.rowId + '"]' ).before( insertTag );
				}
				else if ( previousRowIdInfo.loc == 'left' )
				{
					parentTag.find( tagType + '[rowid="' + previousRowIdInfo.rowId + '"]' ).after( insertTag );
				}

			}

		};


		me.populateColumnData = function( trViewRowTag, optional_SingleRow_OuData, relationData )
		{
			me.showSection();

			// Get Optional Data First - prepare for data population.
			var type = trViewRowTag.find( 'select.settingType' ).val();
			var typeValue = trViewRowTag.find( 'td.typeValue' ).find( 'input,select' ).val();
			
			var filterValue = trViewRowTag.find( 'input.settingFilter' ).attr("filterValue");
			filterValue = ( filterValue !== undefined && filterValue != "" ) ? JSON.parse(filterValue) : "";
			
			var rowid = trViewRowTag.attr( 'rowid' );
			var ouFilter = ( optional_SingleRow_OuData !== undefined ) ? '[ouid="' + optional_SingleRow_OuData.id + '"]' : '' ;

			var optionalData = me.generateNetworkOptionalData( type, typeValue );
			

			// For each row, populate the data.
			me.dataListingTableTag.find( 'tr.trData' + ouFilter ).each( function()
			{
				var trDataRow = $( this );			
				var rowOuId = trDataRow.attr( 'ouid' );
				var tdDataTag = trDataRow.find( 'td[rowid="' + rowid + '"]' );

				// If ouid is empty, it means it is the footer.
				// Do not load data, and simply hide the loading message div.
				if ( rowOuId == '' )
				{
					tdDataTag.find( '.dataLoading.main' ).remove();
				}
				else
				{
					var loadingTag = tdDataTag.find( '.dataLoading.main' );
					var divTdDataTag = tdDataTag.find( '.divTdData' );

					// Populate data in each row.
					me.populateCellDataDetail( rowOuId, type, typeValue, filterValue, loadingTag, divTdDataTag, optionalData, relationData, function()
					{ });
				}

			});
			
			// me.filterTableValue( me.dataListingTableTag );
		};


		// TODO: Need to clean up this - for not needed info.
		me.generateNetworkOptionalData = function( type, typeValue )
		{

			var networkData = me.oProviderNetwork.getSelectedNetworkData();
			var viewColumnsTableManager = me.oProviderNetwork.viewManager.viewColumnsTableManager;

			var isPivot_NetworkChild = viewColumnsTableManager.isPivot_NetworkChild();
			var isPivot_Network = viewColumnsTableManager.isPivot_Network();


			var optionalData = { networkTypeName: "", isNetworkChild: false, isNetwork: false, isPivotLevel: false, columnCase: "", orgUnitLevel: 0, ouLevel_BelowPivot: 1, pivotLevel: 0 ,parentLevel: 0, countryInfo: networkData.countryInfo };

			optionalData.pivotLevel = Number( viewColumnsTableManager.getPivotLevel() );

			optionalData.neworkTypeName = AppUtil.getNetworkTypeName_ByViewColumnType( type, me.oProviderNetwork );

			if ( Util.checkValue( type ) && Util.checkValue( typeValue ) )
			{

				if ( type == "OrgUnitLvl" )
				{
					// level, network/networkChild identification
					optionalData.orgUnitLevel = Number( typeValue );
					optionalData.parentLevel = optionalData.orgUnitLevel - 1;

					optionalData.isPivotLevel = ( optionalData.orgUnitLevel == optionalData.pivotLevel );

					if ( optionalData.orgUnitLevel == networkData.NetworkChild_LVL )
					{
						optionalData.isNetworkChild = true;
					}	
					else if ( optionalData.orgUnitLevel == networkData.Network_LVL )
					{
						optionalData.isNetwork = true;
					}


					// Pivot, Child, ParentAndNetwork type differentiation.
					if ( optionalData.isPivotLevel )
					{
						// Render as linked one - single row.
						optionalData.columnCase = "Pivot";
					}
					else if ( optionalData.isNetworkChild )
					{
						// Not pivot, but NetworkChild.  Network is pivot.
						// Display multiple child rows per network row.
						optionalData.columnCase = "Child";
					}
					else if ( optionalData.isNetwork )
					{
						// Not pivot, but Network.  NetworkChild is pivot.
						// display as parent level search..
						optionalData.columnCase = "ParentAndNetwork";
					}
					else
					{ 
						optionalData.caseName = "others";
					}
					
				}
				else
				{
					// Does 'type' end with '_NC'?
					var isType_NetworkChild = Util.endsWith( type, '_NC' );


					// level, network/networkChild identification
					if ( isType_NetworkChild )
					{
						optionalData.isNetworkChild = true;
						optionalData.orgUnitLevel = networkData.NetworkChild_LVL;
					}
					else
					{
						optionalData.isNetwork = true;
						optionalData.orgUnitLevel = networkData.Network_LVL;
					}

					optionalData.parentLevel = optionalData.orgUnitLevel - 1;
					optionalData.isPivotLevel = ( optionalData.orgUnitLevel == optionalData.pivotLevel );


					// Pivot, Child, ParentAndNetwork type differentiation.
					if ( ( isPivot_NetworkChild && isType_NetworkChild )
						|| ( isPivot_Network && !isType_NetworkChild )
						)
					{
						optionalData.columnCase = "Pivot";
					}
					else if ( isPivot_Network && isType_NetworkChild )
					{
						optionalData.columnCase = "Child";
					}
					else
					{
						optionalData.columnCase = "ParentAndNetwork";
					}

				}
			}

			return optionalData;
		};

		me.checkFitlerRowValueValid = function( values, filter )
		{
			if( filter === undefined || filter == "" || filter.operator == '' ) {
				return true;
			}
			else if( values=== undefined || values == '' ){
				return false;
			}
			else
			{			
				var arrValue = values.split( '#' );
				for( var i=0; i<arrValue.length; i ++ )
				{
					var value = arrValue[i];
					value = value + "";
					value = value.toLowerCase();
					var operator = filter.operator;
					var filterValue = filter.value.toLowerCase();
					
					if( operator == "begins_with" ){
						if( AppUtil.startsWith( value, filterValue ) ){
							return true;
						}
					}
					else if( operator== "ending_with" ){
						if( value.endsWith( filterValue ) ){
							return true;
						}
					}
					else if( operator== "within" ){
						if( value.indexOf( filterValue )>= 0 ){
							return true;
						}
					}
					else if( operator== "not_within" ){
						if( value.indexOf( filterValue ) < 0 ){
							return true;
						}
					}
					else if( operator== "diff" ){
						if( value != filterValue ){
							return true;
						}
					}
					else if( operator== "equals" ){
						if( value == filterValue ){
							return true;
						}
					}
					else
					{
						if( Util.isNumeric( filterValue ) )
						{						
							value = eval(value);
							filterValue = eval(filterValue);
						}
						
						if( operator== "less_than" ){
							if( value < filterValue ){
								return true;
							}
						}
						else if( operator== "less_equals" ){
							if( value <= filterValue ){
								return true;
							}
						}
						else if( operator== "greater_than" ){
							if( value > filterValue ){
								return true;
							}
						}
						else if( operator== "greater_equals" ){
							if( value >= filterValue ){
								return true;
							}
						}
					}
				}
				
				return false;
			}
		};

		me.filterTableValue = function( tableTag )
		{
			// Hide right away..
			MsgManager.networkListingMsgHide( true );

			var headers = tableTag.find("th");
			tableTag.find("tbody tr").show();
			
			for( var i=0; i<headers.length; i++ )
			{
				if( $(headers[i]).attr("filterValue") !== undefined )
				{
					var filter = JSON.parse( $(headers[i]).attr("filterValue") );
					var colIdx = i + 1;
					var cols = tableTag.find('tr td:nth-child(' + colIdx + ')');
					for( var j=0; j<cols.length; j++ )
					{
						var cell = $(cols[j]).find('div.divTdData');
						if( !me.checkFitlerRowValueValid( cell.attr('dataValue'), filter ) ){
							cell.closest('tr').hide();
						}
					}
				}
			}
			
			// Set message
			
			// var viewColumnsTableManager =  me.oProviderNetwork.viewManager.viewColumnsTableManager;
			
		};


		me.allowToAddNetworkChildOrgUnit = function( type, typeValue )
		{
			return ( me.oProviderNetwork.networkData.useNetworkChild && type == 'OrgUnitAttr' && typeValue == 'name' );
		};


		me.populateCellDataDetail = function( ouid, type, typeValue, filterValue, loadingTag, divTdDataTag, optionalData, relationData, finishRunFunc )
		{
			var queryURL = "";
			var trRowTag = divTdDataTag.closest( 'tr.trData' );
			var tdTag = divTdDataTag.closest( 'td' );

			var parentId = trRowTag.attr( 'parentNetworkId' );

			// Clear the data first
			if( me.clearData ) divTdDataTag.html( "" );


			// If the type and typeValue is not empty
			if ( Util.checkValue( type ) && Util.checkValue( typeValue ) )
			{

				if ( type == "OrgUnitLvl" )
				{
					divTdDataTag.addClass( 'content' );

					// Standard retrieval
					if ( !me.oProviderNetwork.checkUseIndividualDataRetrieval() )
					{
						var pivotOuData = me.getPivotOrgUnitRetrieved_ById( ouid );

						// loop through the layers if parent info to get the right one..
						var parentName = me.getParentNameByLevel( pivotOuData, optionalData.pivotLevel, typeValue );
						divTdDataTag.attr( 'dataValue', parentName );
						
						// If parent is Network case <-- When Network Child is the pivot..
						if ( optionalData.columnCase == "ParentAndNetwork" )
						{
							// Set 'pop' context-menu here - to be activated later by this.
							tdTag.addClass( 'context-menu' ).attr( 'level', typeValue ).attr( 'pop', 'Y' );

							// just one level above pivot.
							var newDivTag = me.generateNetworkLinkDivTag( parentId, parentName, divTdDataTag, optionalData, pivotOuData );						
						}
						else
						{
							// Normal Network Parent or other higher up level cases

							divTdDataTag.attr( 'ouid', parentId ).html( parentName );
								
							var checkLevel = eval( typeValue ) + 1;
							if( me.oProviderNetwork.networkData.Network_LVL == checkLevel )
							{
								// For parent level having 'Add network' context-menu,
								// only add the context-menu if able to Edit OrgUnit - since there is no 'pop' here. 
								if ( me.checkOrgunitAddNewChildPermission( pivotOuData, parentId ) )
								{

									tdTag.addClass( 'context-menu' ).attr( 'level', typeValue ).attr( 'addNew', 'Y' );
								
									var openFormTag = $( '<div class="addNew openNetworkParentOrgUnitForm" style="color:#555; display:none;"></div>' );
									divTdDataTag.append( openFormTag );

									me.setupEvent_AddOrgUnit( openFormTag, me.oProviderNetwork.network_Name, parentId, parentName );
									
									//divTdDataTag.find( "div.networkOU" ).css( "display", "inline" );
								}
							}
						}

						finishRunFunc();
						
						// What about finishing the loading message??						
					}
					else
					{

						if ( optionalData.caseName == "ParentAndNetwork" )
						{
							var pivotOuData = me.getPivotOrgUnitRetrieved_ById( ouid );		
							var parentName = pivotOuData.parent.name;

							tdTag.addClass( 'context-menu' ).attr( 'level', typeValue ).attr( 'pop', 'Y' );

							var newDivTag = me.generateNetworkLinkDivTag( parentId, parentName, divTdDataTag, optionalData, pivotOuData );
							divTdDataTag.attr( 'dataValue', parentName );
							
							finishRunFunc();
						}
						else
						{
							// Other OU (Parent) Level Case
							me.retrieveParentOU( ouid, typeValue, loadingTag, finishRunFunc, function( parentOu )
							{
								divTdDataTag.html( parentOu.name );
								divTdDataTag.attr( 'dataValue', parentOu.name );
							});
						}
					}

				}
				else if ( ( type == "OrgUnitAttr" || type == "OrgUnitAttr_NC" ) && !AppUtil.startsWith( typeValue, "ougs_" ) )
				{
					var dynamicAttrId = AppUtil.getDynamicAttrId( typeValue );


					// Get children of pivot and populate
					if ( optionalData.columnCase == "Child" )
					{

						// Standard Retrieval
						if ( !me.oProviderNetwork.checkUseIndividualDataRetrieval() )
						{

							var pivotOU = me.getPivotOrgUnitRetrieved_ById( ouid );
	
							// Get percentage of height..
							var heightPerc = 100;
							if( pivotOU.children !== undefined && pivotOU.children.length > 0 )
							{
								heightPerc = 100 / pivotOU.children.length;
							
								if ( pivotOU.children.length == 1 )
								{
									tdTag.addClass( 'context-menu' ).attr( 'level', optionalData.orgUnitLevel ).attr( 'pop', 'Y' );
								}

								$.each( pivotOU.children, function( i_ou, item_ou )
								{								
									var orgUnitDivTag = $( '<div ouid="' + item_ou.id + '" class="childDiv"></div>' );
									var divNetworkChildDataTag = $( me.divNetworkChildDataTemplate );

									divNetworkChildDataTag.addClass( 'content2' );

									orgUnitDivTag.append( divNetworkChildDataTag );
									divTdDataTag.append( orgUnitDivTag );
									var value = item_ou[ typeValue ];
									value = AppUtil.formatValByType( typeValue, value );
									divTdDataTag.attr( "dataValue", value );
									
									if ( typeValue == "id" || typeValue == "name" || typeValue == "displayName" )
									{
										// Set 'pop' context-menu
										if ( pivotOU.children.length > 1 ) divNetworkChildDataTag.addClass( 'context-menu' ).attr( 'level', optionalData.orgUnitLevel ).attr( 'pop', 'Y' );

										// In here, item_ou does not have .name?

										var newDivTag = me.generateNetworkLinkDivTag( item_ou.id, value, divNetworkChildDataTag, optionalData, item_ou, pivotOU );
									}
									else
									{
										divNetworkChildDataTag.html( value );
									}
									
									if ( i_ou > 0 ) orgUnitDivTag.addClass( 'showTopLine' );
									
								});
							}
							finishRunFunc();
						}
						else
						{
							// get it from 'children' --
							me.retrieveChildOUs( ouid, optionalData, loadingTag, finishRunFunc, function( json_orgUnits )
							{
								// Get percentage of height..
								var heightPerc = 100 / json_orgUnits.length;

								if ( json_orgUnits.length == 1 )
								{
									tdTag.addClass( 'context-menu' ).attr( 'level', optionalData.orgUnitLevel ).attr( 'pop', 'Y' );
								}

								$.each( json_orgUnits, function( i_ou, item_ou )
								{
									// For each orgUnit, add div (& loading tag)
									var orgUnitDivTag = $( '<div ouid="' + item_ou.id + '" class="childDiv"></div>' );
									
									var networkChildLoadingTag = $( me.dataLoadingTemplateSub );
									var divNetworkChildDataTag = $( me.divNetworkChildDataTemplate );

									divNetworkChildDataTag.addClass( 'content2' );

									orgUnitDivTag.append( networkChildLoadingTag );
									orgUnitDivTag.append( divNetworkChildDataTag );

									divTdDataTag.append( orgUnitDivTag );
									

									// For id/name property, reuse the child retrieval data.
									if ( typeValue == "id" || typeValue == "name" || typeValue == "displayName" )
									{

										if ( json_orgUnits.length > 1 ) divNetworkChildDataTag.addClass( 'context-menu' ).attr( 'level', optionalData.orgUnitLevel ).attr( 'pop', 'Y' );

										//var newDivTag = me.generateNetworkLinkDivTag( item_ou.id, item_ou[ typeValue ], divNetworkChildDataTag, optionalData, item_ou,  );											
										divTdDataTag.attr( "dataValue", item_ou[ typeValue ] );
									}
									else
									{
										me.retrieveOuAttribute( item_ou.id, dynamicAttrId, typeValue, networkChildLoadingTag, undefined, function( valueFound )
										{
											divNetworkChildDataTag.html( valueFound );
											divTdDataTag.attr( "dataValue", valueFound );
										});
									}

									if ( i_ou > 0 ) orgUnitDivTag.addClass( 'showTopLine' );
								});
							});
						}
					}
					else if ( optionalData.columnCase == "Pivot" )
					{

						divTdDataTag.addClass( 'content' );

						if ( !me.oProviderNetwork.checkUseIndividualDataRetrieval() )
						{
							var pivotOuData = me.getPivotOrgUnitRetrieved_ById( ouid );
							var value = pivotOuData[ typeValue ];
							value = AppUtil.formatValByType( typeValue, value );
							divTdDataTag.attr( "dataValue", value );

											
							if ( typeValue == "id" || typeValue == "name" || typeValue == "displayName" )
							{
								tdTag.addClass( 'context-menu' ).attr( 'level', optionalData.orgUnitLevel ).attr( 'pop', 'Y' );

								var newDivTag = me.generateNetworkLinkDivTag( ouid, value, divTdDataTag, optionalData, pivotOuData );
							}
							else
							{
								divTdDataTag.html( value );
							}

							if( me.allowToAddNetworkChildOrgUnit( type, typeValue ) )
							{								
								if ( me.checkOrgunitAddNewChildPermission( pivotOuData ) )
								{
									tdTag.addClass( 'context-menu' ).attr( 'level', optionalData.orgUnitLevel ).attr( 'addNew', 'Y' );
									
									var openFormTag = $( '<div class="addNew openNetworkChildOrgUnitForm" style="color:#555; display:none;"></div>' );
									divTdDataTag.append( openFormTag );
									
									me.setupEvent_AddOrgUnit( openFormTag, me.oProviderNetwork.networkChild_Name, ouid, value);
									
									//divTdDataTag.find( "div.networkOU" ).css( "display", "inline" );
								}
							}

							finishRunFunc();
						}
						else
						{
							// Individual Data Retrieval Case.
							if ( typeValue == "id" || typeValue == "name" || typeValue == "displayName" || typeValue == "level" )
							{
								var pivotOuData = me.getPivotOrgUnitRetrieved_ById( ouid );
								var value = pivotOuData[ typeValue ];
								value = AppUtil.formatValByType( typeValue, value );
								divTdDataTag.attr( "dataValue", valueFound );
								
								if ( typeValue == "id" || typeValue == "name" || typeValue == "displayName" )
								{
									tdTag.addClass( 'context-menu' ).attr( 'level', optionalData.orgUnitLevel ).attr( 'pop', 'Y' );

									var newDivTag = me.generateNetworkLinkDivTag( ouid, pivotOuData[ typeValue ], divTdDataTag, optionalData, pivotOuData );
								}
								else
								{								
									divTdDataTag.html( pivotOuData[ typeValue ] );	
								}

								finishRunFunc();
							}
							else
							{
								me.retrieveOuAttribute( ouid, dynamicAttrId, typeValue, loadingTag, finishRunFunc, function( valueFound )
								{
									divTdDataTag.html( valueFound );
									
									finishRunFunc();
								});
							}
						}

					}
					else if ( optionalData.columnCase == "ParentAndNetwork" )
					{

						divTdDataTag.addClass( 'content' );

						// If all in one retreival, which means it has been already retrieved..
						if ( !me.oProviderNetwork.checkUseIndividualDataRetrieval() )
						{
							var pivotOU = me.getPivotOrgUnitRetrieved_ById( ouid );
							var value = pivotOU.parent[ typeValue ];
							value = AppUtil.formatValByType( typeValue, value );
							divTdDataTag.attr( "dataValue", value );
								
							if ( typeValue == "id" || typeValue == "name" || typeValue == "displayName" )
							{
								tdTag.addClass( 'context-menu' ).attr( 'level', optionalData.orgUnitLevel ).attr( 'pop', 'Y' );

								var newDivTag = me.generateNetworkLinkDivTag( parentId, value, divTdDataTag, optionalData, pivotOU );
							}
							else
							{
								divTdDataTag.html( value );
							}

							finishRunFunc();
						}
						else
						{
							me.retrieveOuAttribute( parentId, dynamicAttrId, typeValue, loadingTag, finishRunFunc, function( valueFound )
							{
								divTdDataTag.attr( "dataValue", valueFound );
							
								if ( typeValue == "id" || typeValue == "name" || typeValue == "displayName" )
								{
									tdTag.addClass( 'context-menu' ).attr( 'level', optionalData.orgUnitLevel ).attr( 'pop', 'Y' );

									var newDivTag = me.generateNetworkLinkDivTag( parentId, valueFound, divTdDataTag, optionalData );
								}
								else
								{
									divTdDataTag.html( valueFound );
								}

							});
						}
					}
				}			
				else if ( type == "OrgUnitRelations" || type == "OrgUnitRelations_NC" 
					|| ( ( type == "OrgUnitAttr" || type == "OrgUnitAttr_NC" ) && typeValue.indexOf( "ougs_" ) >= 0 ) )
				{
					typeValue = ( typeValue == "orgUnitGroups" ) ? "organisationUnitGroups" : typeValue;
					
					if ( optionalData.columnCase == "Child" )
					{
						// If all in one retreival, which means it has been already retrieved..
						if ( !me.oProviderNetwork.checkUseIndividualDataRetrieval() )
						{
							var pivotOU = me.getPivotOrgUnitRetrieved_ById( ouid );
								
							var heightPerc = 100;
							if( pivotOU.children !== undefined ){
								heightPerc = 100 / pivotOU.children.length;
							}
							
							if( pivotOU.children !== undefined && pivotOU.children.length > 0 )
							{
								$.each( pivotOU.children, function( i_ou, item_ou )
								{
									// For each orgUnit, add div (& loading tag)
									var orgUnitDivTag = $( '<div ouid="' + item_ou.id + '" class="childDiv"></div>' );
									
									var networkChildLoadingTag = $( me.dataLoadingTemplateSub );
									var divNetworkChildDataTag = $( me.divNetworkChildDataTemplate );

									divNetworkChildDataTag.addClass( 'content2' );

									orgUnitDivTag.append( networkChildLoadingTag );
									orgUnitDivTag.append( divNetworkChildDataTag );

									divTdDataTag.append( orgUnitDivTag );
									
									var dataValues = "";
									var searched = Util.searchByName( relationData, 'id', item_ou.id );
									if( searched != "" )
									{
										valueFound = ""; //me.childEmptyDefault;
										if( searched[typeValue] !== undefined )
										{
											$.each( searched[typeValue], function ( i, item )
											{
												valueFound += '<span class="groupDiv" id="' + item.id + '">' + item.name + '</span><br>';
												dataValues += item.name + "#";
											});
										}
										divNetworkChildDataTag.html( valueFound );	
									}	
									
									divTdDataTag.attr( "dataValue", dataValues );
									
									Util.showDiv( loadingTag, false );	
									
									finishRunFunc();

									if ( i_ou > 0 ) orgUnitDivTag.addClass( 'showTopLine' );
								});
							}
							else
							{
								Util.showDiv( loadingTag, false );	
							}
						}
						else
						{
							me.retrieveChildOUs( ouid, undefined, optionalData, loadingTag, finishRunFunc, function( json_orgUnits )
							{
								// Get percentage of height..
								var heightPerc = 100 / json_orgUnits.length;

								$.each( json_orgUnits, function( i_ou, item_ou )
								{
									// For each orgUnit, add div (& loading tag)
									var orgUnitDivTag = $( '<div ouid="' + item_ou.id + '" class="childDiv"></div>' );
									
									var networkChildLoadingTag = $( me.dataLoadingTemplateSub );
									var divNetworkChildDataTag = $( me.divNetworkChildDataTemplate );

									divNetworkChildDataTag.addClass( 'content2' );

									orgUnitDivTag.append( networkChildLoadingTag );
									orgUnitDivTag.append( divNetworkChildDataTag );

									divTdDataTag.append( orgUnitDivTag );
									var dataValues = "";
									
									var searched = Util.searchByName( relationData, 'id', item_ou.id );
									if( searched != "" )
									{
										valueFound = ""; //me.childEmptyDefault;
										if( searched[typeValue] !== undefined )
										{
											$.each( searched[typeValue], function ( i, item )
											{
												valueFound += '<span class="groupDiv" id="' + item.id + '">' + item.name + '</span><br>';
												dataValues += item.name + "#";
											});
										}
										// divNetworkChildDataTag.html( valueFound );
									}
									
									divTdDataTag.attr( "dataValue", dataValues );
									Util.showDiv( networkChildLoadingTag, false );	
								
									finishRunFunc();
						
									if ( i_ou > 0 ) orgUnitDivTag.addClass( 'showTopLine' );
								});
							});
						}
					}
					else if ( optionalData.columnCase == "Pivot" )
					{	
						divTdDataTag.addClass( 'content' );

						var dataValues = "";
						var searched = Util.searchByName( relationData, 'id', ouid );
						if( searched != "" )
						{
							valueFound = ""; //me.childEmptyDefault;
							if( searched[typeValue] !== undefined )
							{
								$.each( searched[typeValue], function ( i, item )
								{
									valueFound += '<span class="groupDiv" id="' + item.id + '">' + item.name + '</span><br>';
									dataValues += item.name + "#";
								});
							}	
							
							divTdDataTag.attr( "dataValue", dataValues );
							divTdDataTag.html( valueFound );	
						}
						
						Util.showDiv( loadingTag, false );	
						
						finishRunFunc();
					}
					else if ( optionalData.columnCase == "ParentAndNetwork" )
					{
						divTdDataTag.addClass( 'content' );

						var dataValues = "";
						var searched = Util.searchByName( relationData, 'id', parentId );
						if( searched != "" )
						{
							valueFound = ""; //me.childEmptyDefault;
							if( searched[typeValue] !== undefined )
							{
								$.each( searched[typeValue], function ( i, item )
								{
									valueFound += '<span class="groupDiv" id="' + item.id + '">' + item.name + '</span><br>';
									dataValues += item.name + "#";
								});
							}
							divTdDataTag.attr( "dataValue", dataValues );
							divTdDataTag.html( valueFound );	
						}
						
						Util.showDiv( loadingTag, false );	
						
						finishRunFunc();
					}
				}
				else if ( type == "Analytic" || type == "Analytic_NC" || type == "Custom" || type == "Custom_NC"  )
				{

					var retrieveFunc = ( type == "Analytic" || type == "Analytic_NC" ) ? me.retrieveOuAnalytics : me.retrieveOuCustom;


					if ( optionalData.columnCase == "Child" )
					{

						// If all in one retreival, which means it has been already retrieved..
						if ( !me.oProviderNetwork.checkUseIndividualDataRetrieval() )
						{
							var pivotOU = me.getPivotOrgUnitRetrieved_ById( ouid );
							
							var heightPerc = 100;
							if( pivotOU.children !== undefined && pivotOU.children.length > 0 )
							{
								heightPerc = 100 / pivotOU.children.length;
								
								$.each( pivotOU.children, function( i_ou, item_ou )
								{
									// For each orgUnit, add div (& loading tag)
									var orgUnitDivTag = $( '<div ouid="' + item_ou.id + '" class="childDiv"></div>' );
																	
									//var networkChildLoadingTag = $( me.dataLoadingTemplateSub );
									var divNetworkChildDataTag = $( me.divNetworkChildDataTemplate );

									divNetworkChildDataTag.addClass( 'content2' );

									//orgUnitDivTag.append( networkChildLoadingTag );
									orgUnitDivTag.append( divNetworkChildDataTag );

									divTdDataTag.append( orgUnitDivTag );

									retrieveFunc( item_ou.id, typeValue, loadingTag, undefined, function( valueFound )
									{
										me.setLegendSet( valueFound, typeValue, divNetworkChildDataTag );									
										divTdDataTag.attr( "dataValue", valueFound );
									})				

									if ( i_ou > 0 ) orgUnitDivTag.addClass( 'showTopLine' );
								});
							}
						}
						else
						{	

							me.retrieveChildOUs( ouid, optionalData, loadingTag, finishRunFunc, function( json_orgUnits )
							{
								// Get percentage of height..
								var heightPerc = 100 / json_orgUnits.length;

								$.each( json_orgUnits, function( i_ou, item_ou )
								{
									// For each orgUnit, add div (& loading tag)
									var orgUnitDivTag = $( '<div ouid="' + item_ou.id + '" class="childDiv"></div>' );
																	
									var networkChildLoadingTag = $( me.dataLoadingTemplateSub );
									var divNetworkChildDataTag = $( me.divNetworkChildDataTemplate );

									divNetworkChildDataTag.addClass( 'content2' );

									orgUnitDivTag.append( networkChildLoadingTag );
									orgUnitDivTag.append( divNetworkChildDataTag );

									divTdDataTag.append( orgUnitDivTag );

									retrieveFunc( item_ou.id, typeValue, loadingTag, undefined, function( valueFound )
									{
										me.setLegendSet( valueFound, typeValue, divNetworkChildDataTag );									
										divTdDataTag.attr( "dataValue", valueFound );
									});							

									if ( i_ou > 0 ) orgUnitDivTag.addClass( 'showTopLine' );

								});
							});
						}
					}
					else if ( optionalData.columnCase == "Pivot" )
					{
						divTdDataTag.addClass( 'content' );

						retrieveFunc( ouid, typeValue, loadingTag, finishRunFunc, function( valueFound )
						{
							me.setLegendSet( valueFound, typeValue, divTdDataTag );									
							divTdDataTag.attr( "dataValue", valueFound );
						});
					}
					else if ( optionalData.columnCase == "ParentAndNetwork" )
					{
						divTdDataTag.addClass( 'content' );

						retrieveFunc( parentId, typeValue, loadingTag, finishRunFunc, function( valueFound )
						{
							me.setLegendSet( valueFound, typeValue, divTdDataTag );									
							divTdDataTag.attr( "dataValue", valueFound );
						});
					}				
				}

				
			}
		};


		me.retrieveParentOU = function( pivotId, parentLevel, loadingTag, finishRunFunc, runFunc )
		{
			var queryURL = _queryURL_OrgUnit + '/' + pivotId + '/parents.json';

			// use the 'typeValue' to query and ...
			RESTUtil.retrieveManager.retrieveData( queryURL, function( json_Data )
			{
				if ( json_Data.organisationUnits !== undefined )
				{
					$.each( json_Data.organisationUnits, function( i_p, item_p )
					{
						if ( item_p.level == parentLevel )
						{
							runFunc( item_p );
							return false;
						}
					});
				}
			}
			, function() {}
			, function() { Util.showDiv( loadingTag, true ); me.checkRequest( 1 ); }
			, function() { Util.showDiv( loadingTag, false ); finishRunFunc(); me.checkRequest( -1 ); }
			);
		};


		me.retrieveChildOUs = function( ouid, optionalData, loadingTag, finishRunFunc, dataRunFunc )
		{
			var queryURL = _queryURL_api + 'organisationUnits/' + ouid + '.json?level=1&fields=id,name,displayName';

			RESTUtil.retrieveManager.retrieveData( queryURL, function( json_Data )
			{
				if ( json_Data.organisationUnits !== undefined )
				{
					var ouListOrdered = Util.sortByKey( json_Data.organisationUnits, "name" );

					dataRunFunc( ouListOrdered );
				}
			}
			, function() {}
			, function() { Util.showDiv( loadingTag, true ); me.checkRequest( 1 ); }
			, function() 
				{ 
					Util.showDiv( loadingTag, false );
					if ( finishRunFunc !== undefined ) finishRunFunc(); 
					me.checkRequest( -1 );
				}
			);
		};


		me.retrieveOuAttribute = function( ouid, dynamicAttrId, typeValue, loadingTag, finishRunFunc, runFunc )
		{
			var queryURL = _queryURL_OrgUnit + '/' + ouid;
			
			queryURL += ( dynamicAttrId != '' ) ? '.json?fields=attributeValues' : '.json?fields=' + typeValue;
							

			// use the 'typeValue' to query and ...
			AppUtil.getAsynchData_WithPush( queryURL, function( json_Data )
			{
				if ( json_Data !== undefined )
				{
					if ( dynamicAttrId != '' )
					{
						$.each( json_Data.attributeValues, function ( i_attrVal, item_attrVal )
						{
							if ( item_attrVal.attribute.id == dynamicAttrId )
							{
								// if not undefined && empty string, 

								var value = ( item_attrVal.value == "" ) ? me.childEmptyDefault : item_attrVal.value ;

								runFunc( value );
								return false;
							}
						});
					}
					else
					{
						var retrievedValue = json_Data[ typeValue ];

						if ( retrievedValue !== undefined ) 
						{
							var value = ( retrievedValue == "" ) ? me.childEmptyDefault : retrievedValue ;

							runFunc( value );
						}
					}
				}
			}
			, function() {}
			, function() { Util.showDiv( loadingTag, true ); me.checkRequest( 1 ); }
			, function() { Util.showDiv( loadingTag, false ); if ( finishRunFunc !== undefined ) finishRunFunc(); me.checkRequest( -1 ); }   // .remove() 
			);
		};


		me.retrieveOuRelations = function( type, typeValue, runFunc )
		{
			// Get varialbe/tags/etc for later use.
			var viewColumnsTableManager = me.oProviderNetwork.viewManager.viewColumnsTableManager;
			var networkData = me.oProviderNetwork.getSelectedNetworkData();
			var countryInfo = networkData.countryInfo;
			var pivotLevel = viewColumnsTableManager.getPivotLevel();
			var pivotName = viewColumnsTableManager.getPivotName();
			var pivotGroupIdFilter = viewColumnsTableManager.getPivotFilterGroupId();
			
			var hasPivotGroupFilter = ( Util.checkValue( pivotGroupIdFilter ) ) ? true : false;			
			var fieldParams = "";
			
			if( type == "OrgUnitAttr" || type == "OrgUnitRelations" )
			{
				if( type == "OrgUnitAttr" && typeValue.indexOf("ougs_") >= 0 )
				{
					fieldParams = "organisationUnitGroups[id,name,organisationUnitGroupSet[id]],id";
				}
				else
				{
					typeValue = ( typeValue == "orgUnitGroups" ) ? "organisationUnitGroups" : typeValue;					
					fieldParams = typeValue + "[id,name],id";
				}
			}
			else if( type == "OrgUnitAttr_NC" || type == "OrgUnitRelations_NC" )
			{
				if( type == "OrgUnitAttr_NC" && typeValue.indexOf("ougs_") >= 0 )
				{
					fieldParams = "children[id,organisationUnitGroups[id,name,organisationUnitGroupSet[id]]]";
				}
				else
				{
					typeValue = ( typeValue == "orgUnitGroups" ) ? "organisationUnitGroups" : typeValue;
					fieldParams = "id,children[id," + typeValue + "[id,name]]";	
				}
			}
			/* else
			{
				typeValue = ( typeValue == "orgUnitGroups" ) ? "organisationUnitGroups" : typeValue;					
				fieldParams = typeValue + "[id,name],id";
			} */
					
			
			var queryURL = me.getOrgUnitRetrievalRootURL( countryInfo, pivotLevel, hasPivotGroupFilter, pivotGroupIdFilter, fieldParams  );			
				
			AppUtil.getAsynchData_WithPush( queryURL, function( json_Data )
			{
				// var ouList = json_Data.organisationUnits;
				
				//if( type == "OrgUnitAttr" || type == "OrgUnitAttr_NC" )
				//{
					ouList = [];
					var list = json_Data.organisationUnits;
					for( var i=0; i<list.length; i++ )
					{
						var ouData = me.getOuGroupSetData( list[i], type, typeValue );
						
						if( type == "OrgUnitAttr" || type == "OrgUnitRelations" )
						{
							ouList.push( ouData );
						}
						else if( type == "OrgUnitAttr_NC" || type == "OrgUnitRelations_NC" )
						{
							if( ouData.children !== undefined && ouData.children.length > 0 )
							{
								var children = ouData.children;
								$.each( children, function ( i_child, item_child )
								{
									ouList.push( item_child );
								});
							}
						}
					}
				//}
				
				
				/* var ouList = json_Data.organisationUnits;
				// var groupSetId = typeValue.replace( "ougs_", "" );
					
				if( type == "OrgUnitAttr" && typeValue.indexOf("ougs_") >= 0 )
				{
					for( var i=0; i<ouList.length; i++ )
					{
						// ouList[i][typeValue] = [];
						var organisationUnitGroups = ouList[i].organisationUnitGroups;
						
						if( organisationUnitGroups !== undefined && organisationUnitGroups.length > 0 )
						{
							$.each( organisationUnitGroups, function ( i_oug, item_oug )
							{
								if( item_oug.organisationUnitGroupSet !== undefined  ){
									var ouGroupKey = "ougs_" + item_oug.organisationUnitGroupSet.id;
									if( ouList[i][ouGroupKey] === undefined )
									{
										ouList[i][ouGroupKey] = [];
									}
									ouList[i][ouGroupKey].push( item_oug );
								}
							});
						}
					}
					//console.log( " === typeValue : " + typeValue );
					//console.log( ouList );
				}
				else if( type == "OrgUnitAttr_NC" && typeValue.indexOf("ougs_") >= 0 )
				{
					var parentOUList = json_Data.organisationUnits;
					ouList = [];
					for( var i=0; i<parentOUList.length; i++ )
					{
						if( parentOUList[i].children !== undefined && parentOUList[i].children.length > 0 )
						{
							var children = parentOUList[i].children;
							$.each( children, function ( i_child, item_child )
							{
								ouList.push( item_child );
								if( item_child.organisationUnitGroups !== undefined )
								{
									// item_child[typeValue] = [];
									$.each( item_child.organisationUnitGroups, function ( i_oug, item_oug )
									{
										if( item_oug.organisationUnitGroupSet !== undefined )
										{											
											var ouGroupKey = "ougs_" + item_oug.organisationUnitGroupSet.id;
											if( item_child[ouGroupKey] === undefined )
											{
												item_child[ouGroupKey] = [];
											}
											item_child[ouGroupKey].push( item_oug );
										}
									});
								}
							});
						}
					}
				} */
				
				runFunc( ouList );
			}
			, function() {}
			, function() {me.checkRequest( 1 )}
			, function() {me.checkRequest( -1 )}   // .remove() 
			);
			
		};
		
		me.getOuGroupSetData = function( ouData, type, typeValue )
		{
			if( type == "OrgUnitAttr" && typeValue.indexOf("ougs_") >= 0 )
			{
				var organisationUnitGroups = ouData.organisationUnitGroups;
				
				if( organisationUnitGroups !== undefined && organisationUnitGroups.length > 0 )
				{
					$.each( organisationUnitGroups, function ( i_oug, item_oug )
					{
						if( item_oug.organisationUnitGroupSet !== undefined  ){
							var ouGroupKey = "ougs_" + item_oug.organisationUnitGroupSet.id;
							if( ouData[ouGroupKey] === undefined )
							{
								ouData[ouGroupKey] = [];
							}
							ouData[ouGroupKey].push( item_oug );
						}
					});
				}
			}
			else if( type == "OrgUnitAttr_NC" && typeValue.indexOf("ougs_") >= 0 )
			{
				// var parentOUList = json_Data.organisationUnits;
				// ouList = [];
				// for( var i=0; i<parentOUList.length; i++ )
				// {
				if( ouData.children !== undefined && ouData.children.length > 0 )
				{
					var children = ouData.children;
					$.each( children, function ( i_child, item_child )
					{
						// ouList.push( item_child );
						if( item_child.organisationUnitGroups !== undefined )
						{
							// item_child[typeValue] = [];
							$.each( item_child.organisationUnitGroups, function ( i_oug, item_oug )
							{
								if( item_oug.organisationUnitGroupSet !== undefined )
								{											
									var ouGroupKey = "ougs_" + item_oug.organisationUnitGroupSet.id;
									if( item_child[ouGroupKey] === undefined )
									{
										item_child[ouGroupKey] = [];
									}
									item_child[ouGroupKey].push( item_oug );
								}
							});
						}
					});
				}
			}
			
			return ouData;
		}
		
		me.getLegendSet = function( url, doneFunc )
		{
			var queryURL = "";
			var analyticURL = new AnalyticURL();
			analyticURL.setURL( url );
			var dataType = analyticURL.getDataType();
			var objectId = analyticURL.getObjectId();
			
			if( dataType == analyticURL.PARAM_AGGREGATED_DATA_ELEMENT || dataType == analyticURL.PARAM_EVENT_DATA_ELEMENT ){
				queryURL = _queryURL_api + "dataElements/" + objectId + ".json?fields=legendSet[legends[startValue,endValue,color]]";
			}
			else if( dataType == analyticURL.PARAM_AGGREGATED_INDICATOR || dataType == analyticURL.PARAM_EVENT_INDICATOR ){
				queryURL = _queryURL_api + "indicators/" + objectId + ".json?fields=legendSet[legends[startValue,endValue,color]]";
			}
			
			
			RESTUtil.retrieveManager.retrieveData( queryURL
			, function( json_Data ) 
			{
				if( json_Data.legendSet !== undefined ){
					doneFunc( json_Data.legendSet.legends );
				}
				else{
					doneFunc( [] );
				}
			});

		};
		
		me.setLegendSet = function( value, url, divTag )
		{			
			//var loadingTag = divTag.closest('td').find('div.dataLoading main');
			var analyticURL = new AnalyticURL();
			analyticURL.setURL( url );
			var legend = analyticURL.getLegend();
			if( divTag !== undefined ){
				divTag.css('float', 'right')
				divTag.html( value );
				divTag.closest('td').css('background-color', '');
				divTag.css('color', 'black');
				divTag.find('.legendTrafficLight').remove();
				divTag.find('legendTrafficLightValue').css('float', 'right');
			}
			
			//Util.showDiv( loadingTag, true );
			me.getLegendSet( url, function( legends ){
				if( value != "" && legend != analyticURL.NO_LEGEND ){
					value = eval(value);
					var legendFound = false;
					if( legends.length > 0 ){
						for( var i=0; i<legends.length; i++ ){
							if( value>=legends[i].startValue && value<=legends[i].endValue ){
								if( legend == analyticURL.LEGEND_COLOR_CELL ){ 
									divTag.html( value );
									divTag.css("float", 'right' );
									divTag.closest('td').css('background-color', legends[i].color);
								}
								else if( legend == analyticURL.LEGEND_COLOR_VALUE ){ 
									divTag.html( value );
									divTag.css("float", 'right' );
									divTag.css('color', legends[i].color);
								}
								else if( legend == analyticURL.LEGEND_TRAFFIC_LIGHT ){ 
									divTag.html("");
									var cellTag = divTag.closest('td');
									divTag.css('display','inline');
									divTag.append('<div class="legendTrafficLight" style="border-radius:50%;background-color: ' + legends[i].color + ';width:16px;height:16px;float:right;margin-left:3px;"></div>');
									divTag.append("<div class='legendTrafficLightValue' style='float:right'>" + value + "</div>");
								}
								legendFound = true;
							}
						}
						
						if(!legendFound ){
							divTag.css("float", 'right' );
							divTag.html( value );
						}
					}
					else{											
						divTag.css("float", right );
						divTag.html( value );
					}
				}
			});
		};


		me.retrieveOuAnalytics = function( ouid, url, loadingTag, finishRunFunc, runFunc )
		{
			if( url.indexOf( "filter=ou:" ) < 0 )
			{
				//url += "&filter=ou:" + ouid;
			}
			
			var analyticURL = new AnalyticURL();
			analyticURL.setURL( url );
			
			if( url == "" || analyticURL.checkValid() == analyticURL.INVALID ){
				if ( finishRunFunc !== undefined ) finishRunFunc();
			}
			else{
				me.setLegendSet( "", url );
				
				var analytic = url.replace( me.PARAM_ORGUNIT, ouid);
				var queryURL = _queryURL_api + analytic;
				
				AppUtil.getAsynchData_WithPush( queryURL, function( json_Data )
				{
					var dataIndex = json_Data.width - 1;
					
					var result = "";
					if(  json_Data.rows.length > 0  ) {							
						var total = 0;
						var count = 0;
						$.each( json_Data.rows, function( i_data, item_data )
						{
							if( item_data[ dataIndex ] != "" && item_data[ dataIndex ] != "0.0" ){
								total += parseFloat( item_data[ dataIndex ] );
								count ++;
							}
						});
						
						if( count != 0 )
						{
							result = (total/count);
							if( !Util.isInt( result )){
								result = result.toFixed(2);
							}
						}
						else
						{
							result = 0;
						}
					}
					
					runFunc( result );

				}
				, function() {}
				, function() { Util.showDiv( loadingTag, true ); me.checkRequest( 1 ); }
				, function() { 
						Util.showDiv( loadingTag, false ); 
						if ( finishRunFunc !== undefined ) finishRunFunc();
						me.checkRequest( -1 ); 
					}
				);
			}
		};


		me.retrieveOuCustom = function( ouid, value, loadingTag, finishRunFunc, runFunc )
		{

			var retrieval_WithPush = AppUtil.getAsynchData_WithPush;


			var requestDataType = '[dataType_json]';

			if ( value.indexOf( '[dataType_text]' ) >= 0 )
			{
				value = value.replace( '[dataType_text]', '' );
				requestDataType = '[dataType_text]';

				retrieval_WithPush = AppUtil.getAsynchDataText_WithPush;
			}


			var processAfter = '[after_analytic]';

			if ( value.indexOf( '[after_text]' ) >= 0 )
			{
				value = value.replace( '[after_text]', '' );
				processAfter = '[after_text]';
			}
			else
			{
				value = value.replace( '[after_analytic]', '' );
			}



			// Replace the reserved keys with value
			value = value.replace( '[ouid]', ouid );

			var queryURL = _queryURL_api + value;

			retrieval_WithPush( queryURL, function( returnData )
			{
				var result = '';
				//console.log( 'json_Data STR: ' + json_Data + ', OBJ:' + JSON.stringify( json_Data ) );

				if ( processAfter == '[after_text]' )
				{
					result = returnData;
				}
				else if ( processAfter == '[after_analytic]' )
				{
					result = AppUtil.getAnalyticValue( returnData, 'value' );
				}

				runFunc( result );

			}
			, function() {}
			, function() { Util.showDiv( loadingTag, true ); me.checkRequest( 1 ); }
			, function() { 
					Util.showDiv( loadingTag, false ); 
					if ( finishRunFunc !== undefined ) finishRunFunc();
					me.checkRequest( -1 ); 
				}
			);
		
		};


		me.generateNetworkLinkDivTag = function( id, value, divTdDataTag, optionalData, orgUnit, orgUnitParent )
		{
			value = ( value === undefined ) ? "" : value ;

			var networkCssClass = ( optionalData.isNetwork ) ? 'networkOU' : 'networkChildOU';
			var networkTypeName = optionalData.neworkTypeName;


			var orgUnitEditPermission = me.checkOrgunitEditPermission( orgUnit, orgUnitParent );
			var viewMode = ( orgUnitEditPermission ) ? _mode_Edit : _mode_View;


			var newDivTag = $( '<div ouid="' + id + '">' + value + '</div>' );
			var hiddenLinkDivTag = $( '<div class="openOU" ouid="' + id + '" viewMode="' + viewMode + '" style="display:none;font-size:8px;"></div>' );

			divTdDataTag.html( newDivTag );
			divTdDataTag.append( hiddenLinkDivTag );

			hiddenLinkDivTag.click( function()
			{
				var mode = viewMode;
				
				me.orgUnitPopupManager.openForm( optionalData.countryInfo, optionalData.orgUnitLevel, networkTypeName, mode, id, orgUnit.name );
			});

			return newDivTag;
		};


		me.getParentNameByLevel = function( pivotOuData, pivotLevel, typeValue )
		{
			var parentName = '';
			var parentLevel = Number( typeValue );
			var currentParent = pivotOuData; 
			var parents = pivotOuData.parents;


			if ( parents !== undefined )
			{
				$.each( parents, function( i_oup, item_oup )
				{
					if ( item_oup.level == parentLevel )
					{
						parentName = item_oup.name;
						return false;
					}
				});
			}

			return parentName;
		};


		// -------- End of Populate Methods --------
		// -----------------------------------------


		me.orgUnitsNameTrim = function( ouData )
		{
			$.each( ouData, function( i, item )
			{
				item.name = Util.trim( item.name );
			});
		};


		me.pivotDataRowsCreate = function( ouDataList, tableBodyTag, ouLevel, ouLevelTitle, countryUid )
		{
			// Create rows for each orgunit list - become basis for other column data population
			$.each( ouDataList, function( i_ou, item_ou )
			{
				me.pivotDataRowCreate( item_ou, tableBodyTag );
			});
		};

		
		me.pivotDataRowCreate = function( ouData, tableBodyTag )
		{
			var trRow = $( me.rowTemplate_Pivot );
		
			// Popuate row 'ouid' and column data populate ( org unit name & id )
			trRow.attr( 'ouid', ouData.id );

			if ( ouData.parent !== undefined ) trRow.attr( 'parentNetworkId', ouData.parent.id );

			tableBodyTag.append( trRow );

			return trRow;
		};


		me.createLoadingTr = function()
		{
			var tableTag = me.dataListingTableTag;
			var columnCount = tableTag.find( 'th[rowid]' ).length;

			var trLoading = $( '<tr class="trLoading"><td colspan="' + columnCount + '"><img src="img/ui-anim_basic.gif"/></td></tr>' );

			tableTag.find( 'tbody' ).append( trLoading );

			return trLoading;
		};


		me.addOrgUnitToOrgUnitGroup = function( orgUnitId, orgUnitGroupId, returnFunc )
		{
			
			var queryURL_orgUnitGroups = _queryURL_api + "organisationUnitGroups/";


			if ( orgUnitGroupId != "" && orgUnitId != "" )
			{
				RESTUtil.submitPostAsyn( "PUT", new Object(), queryURL_orgUnitGroups + orgUnitGroupId + '/organisationUnits/' + orgUnitId
				, function( output ) 
				{ 
					console.log( "Added org unit " + orgUnitId + " to group " + orgUnitGroupId + ".  Output: " + output ); 

					if ( returnFunc !== undefined ) returnFunc( true );
				}
				, function() 
				{
					console.log( "Failed to add org unit " + orgUnitId + " to group " + orgUnitGroupId );
					if ( returnFunc !== undefined ) returnFunc( false );
				}
				);
			}
		};


		me.dataRow_SetColumnsAndPopulateData = function( dataListingTableTag, viewColumnTable, optional_SingleRow_OuData, mode, networkType )
		{
			var hasOUGroup = false;
			var hasChildOUGroup = false;


			// STEP 1. For each table header column already placed data,
			// Populate the data (using the column setting info)
			dataListingTableTag.find( 'th[rowid]' ).each( function()
			{

				var rowid = $( this ).attr( 'rowid' );
			
				// For each view, call the apply
				var trViewRowTag = viewColumnTable.find( 'tr.trDataNew[rowid="' + rowid + '"]' );

				if ( trViewRowTag.length > 0 ) // && trViewRowTag.attr( 'applied' ) == 'true' )
				{
					var title = trViewRowTag.find( 'input.settingName' ).val();
					var type = trViewRowTag.find( 'select.settingType' ).val();
					var typeValue = trViewRowTag.find( 'select.settingValue,input.settingValue' ).val();
					


					// On UPDATE case, only update the orgUnit attributes that are passed
					if ( mode == _mode_Edit )
					{
						//console.log( 'title: ' + title + ', type: ' + type + ', typeValue: ' + typeValue );


						// Get 'viewColumnRowData' for matching the orgUnit level
						// with popup OrgUnit info.
						var viewColumnRowData = me.oProviderNetwork.getViewColumnRowData( trViewRowTag );
						var optionalData = me.generateNetworkOptionalData( type, typeValue );
			

						// OrgUnit Attribute cases (Match with popup OrgUnit change level)
						if ( optional_SingleRow_OuData !== undefined 
						&& optional_SingleRow_OuData.level == viewColumnRowData.ouLevel )
						{
							// If 'Relations', or 'OrgUnitGroupSet', then, populate data using below.
							if( type == "OrgUnitRelations" || type == "OrgUnitRelations_NC" 
								|| ( ( type == "OrgUnitAttr" || type == "OrgUnitAttr_NC" ) && AppUtil.startsWith( typeValue, "ougs_" ) ) )
							{
								var ouList = [ optional_SingleRow_OuData ];
								var ou_Data = optional_SingleRow_OuData;
								
								
								/* if( optionalData.columnCase == "ParentAndNetwork" )
								{
									ouList = [optional_SingleRow_OuData];
									ou_Data = optional_SingleRow_OuData.children[0];
								}
								else */
								if( networkType == "NetworkChild" /* && optionalData.columnCase == "Pivot" */ )
								{
									ouList = optional_SingleRow_OuData.parent.children;
									ou_Data = optional_SingleRow_OuData.parent;
								}
								
								
								me.populateColumnData( trViewRowTag, ou_Data, ouList );
							}
							else
							{
								// OrgUnit Attribute cases
								if ( optional_SingleRow_OuData[ typeValue ] !== undefined )
								{
									var ou_Data = optional_SingleRow_OuData;
									/* if( optionalData.columnCase == "ParentAndNetwork" )
									{
										ou_Data = optional_SingleRow_OuData.children[0];
									}
									else 
									*/
									if( networkType == "NetworkChild" /* && optionalData.columnCase == "Pivot" */ )
									{
										ou_Data = optional_SingleRow_OuData.parent;
									}
									//console.log( 'update match found' );

									me.populateColumnData( trViewRowTag, ou_Data );
								}
							}
						}

					}
					else
					{

						// STEP 2. Construct cell body structure (HTML) (& header) on each row - for this column.
						me.setUpColumnTags( trViewRowTag, viewColumnTable, optional_SingleRow_OuData );


						// STEP 3. Depending on 'type', populate rows for the column.
						if( Util.checkValue( typeValue ) )
						{	
							if( type == "OrgUnitRelations" || type == "OrgUnitRelations_NC" ) 
							{	
								if( optional_SingleRow_OuData === undefined )
								{
									//MsgManager.networkListingMsgProgressShow( 'Retrieving data in column "' + title + '" ...' );

									dataListingTableTag.find('tbody td[rowid="' + rowid + '"]').find('.dataLoading').show();

									me.retrieveOuRelations( type, typeValue, function( relationData )
									{
										me.populateColumnData( trViewRowTag, optional_SingleRow_OuData, relationData );
										
										//MsgManager.networkListingMsgProgressShow( 'Retrieved data in column "' + title + '"' );
									});

								}
								else if( optional_SingleRow_OuData !== undefined  )
								{


									if( type == "OrgUnitRelations" )
									{
										var ouList = [ optional_SingleRow_OuData ];

										me.populateColumnData( trViewRowTag, optional_SingleRow_OuData, ouList );
									}
									//else if( type == "OrgUnitRelations_NC" 
									//	&& ( mode =="Add" || ( mode==_mode_Edit && networkType === undefined && networkType == "networkChildOU" ) ) )
									
									// else if( type == "OrgUnitRelations_NC" 
									//	&& ( mode == "Add" || mode == _mode_Edit ) 
									//	&& networkType == me.oProviderNetwork.networkChild_Name )
									
									else if( type == "OrgUnitRelations_NC" 
										// && mode == "Add" 
										// && networkType == me.oProviderNetwork.networkChild_Name
										)
									{
										var ouList = optional_SingleRow_OuData.children;

										me.populateColumnData( trViewRowTag, optional_SingleRow_OuData, ouList );
									}


								}
							}
							else if( type == "OrgUnitAttr" && typeValue.indexOf("ougs_") >= 0 )
							{
								if( optional_SingleRow_OuData === undefined && !hasOUGroup )
								{
									//MsgManager.networkListingMsgProgressShow( 'Retrieving data in column "' + title + '" ...' );
									
									dataListingTableTag.find('tbody td[rowid="' + rowid + '"]').find('.dataLoading').show();
									
									hasOUGroup = true;
									
									me.retrieveOuRelations( type, typeValue, function( relationData )
									{
										me.populateColumnDataOUG( type, dataListingTableTag, viewColumnTable, optional_SingleRow_OuData, relationData );
										
										//MsgManager.networkListingMsgProgressShow( 'Retrieved data in column "' + title + '"' );
									});
								}
								else if( optional_SingleRow_OuData !== undefined )
								{
									var ouList = [];
									
									ouList.push( optional_SingleRow_OuData );
									
									me.populateColumnData( trViewRowTag, optional_SingleRow_OuData, ouList );
								}
							}
							else if( type == "OrgUnitAttr_NC" && typeValue.indexOf("ougs_") >= 0 )
							{
								if( optional_SingleRow_OuData === undefined && !hasChildOUGroup )
								{
									//MsgManager.networkListingMsgProgressShow( 'Retrieving data in column "' + title + '" ...' );
									dataListingTableTag.find('tbody td[rowid="' + rowid + '"]').find('.dataLoading').show();
									
									hasChildOUGroup = true;
									
									me.retrieveOuRelations( type, typeValue, function( relationChildData )
									{
										me.populateColumnDataOUG( type, dataListingTableTag, viewColumnTable, optional_SingleRow_OuData, relationChildData );
										//MsgManager.networkListingMsgProgressShow( 'Retrieved data in column "' + title + '"' );
									});
								}
							}
							else
							{
								/*
								// - Don't need this 'conditional if' anymore??
								if( optional_SingleRow_OuData === undefined 
									|| ( optional_SingleRow_OuData !== undefined 
										// && ( type == "OrgUnitAttr" || type == 'OrgUnitLvl' )
									) )
								{
								*/
								
								me.populateColumnData( trViewRowTag, optional_SingleRow_OuData );

								//}
							}
						}	

					}
				}
			});
		

			// After setting Columns and populating Data, set contextMenu on td cells
			me.setContextMenu( dataListingTableTag.find( 'tr.trData' ) );

		};


		me.setContextMenu = function( trRows )
		{
			// in each td, if buttons exists, add it!!!

			$.contextMenu({
				selector: '.context-menu'
				,build: function( $trigger )
				{
					var options = { "items": {} };

					var openStatus = ( Util.checkDefined( $trigger.attr( 'pop' ) ) ) ? $trigger.attr( 'pop' ) : "";
					var addNewStatus = ( Util.checkDefined( $trigger.attr( 'addNew' ) ) ) ? $trigger.attr( 'addNew' ) : "";
					var level = ( Util.checkDefined( $trigger.attr( 'level' ) ) ) ? $trigger.attr( 'level' ) : "0";


					// 1. depending on the tag (context-menu opened at), construct menu
					if ( openStatus == "Y" )
					{
						var hiddenDivTag = $trigger.find( 'div.openOU' );
						var viewMode = hiddenDivTag.attr( 'viewMode' );
						var orgUnitId = hiddenDivTag.attr( 'ouid' );

						// Need to pass in orgUnit Id, 
						var iconName = ( viewMode == _mode_Edit ) ? "edit" : "copy";  // use 'copy' icon for 'view' for now - since I don't know how to generate/modify the icons..

						options.items.open = { name: viewMode, icon: iconName };
					}


					if ( addNewStatus == "Y" )
					{
						// get level first..
						var lowerOrgUnitLevelName = AppUtil.getOrgUnitLevelName( ( Number( level ) + 1 ), me.oProviderNetwork );

						options.items.addNewChildOU = { name: "Add " + lowerOrgUnitLevelName, icon: "add" };
					}


					// 2. Set menu item 'click' callback event
					options.callback = function( key, opt ) 
					{
						if ( key == "open" )
						{
							$trigger.find( 'div.openOU' ).click();
						}
						else if ( key == "addNewChildOU" )
						{
							$trigger.find( 'div.addNew' ).click();
						}
					}

					return options;
				}

			});
		}

		
		me.populateColumnDataOUG = function( typeRow, dataListingTableTag, viewColumnTable, optional_SingleRow_OuData, relationData )
		{
			dataListingTableTag.find( 'th[rowid]' ).each( function()
			{
				var rowid = $( this ).attr( 'rowid' );
				var trViewRowTag = viewColumnTable.find( 'tr.trDataNew[rowid="' + rowid + '"]' );
				
				if ( trViewRowTag.length > 0 ) // && trViewRowTag.attr( 'applied' ) == 'true' )
				{
					var title = trViewRowTag.find( 'input.settingName' ).val();			
					//MsgManager.networkListingMsgProgressShow( 'Filling data in column "' + title + '" ...' );
					
					var type = trViewRowTag.find( 'select.settingType' ).val();
					var typeValue = trViewRowTag.find( 'select.settingValue,input.settingValue' ).val();
					if( type == typeRow && Util.checkValue( typeValue ) && typeValue.indexOf("ougs_") >= 0 )
					{
						me.populateColumnData( trViewRowTag, optional_SingleRow_OuData, relationData );
					}
				}
			});
		}

		me.findRowByPivotId = function( pivotId )
		{
			var tableBodyTag = me.dataListingTableTag.find( 'tbody' );

			return tableBodyTag.find( 'tr.trData[ouid="' + pivotId + '"]' );
		};


		me.checkRequest = function( count )
		{
			if ( count === undefined )
			{
				// execute the result right away.
				me.performFinish_Check();
			}
			else
			{
				me.dataRetrieveCount = me.dataRetrieveCount + count;
				if ( me.dataRetrieveCount == 0 ) 
				{
					me.performFinish_Check();
				}
			}
		};


		me.performFinish_Check = function()
		{
			me.finishCount++;
			var count = me.finishCount;

			//console.log( 'check count:' + count );
			
			setTimeout( function()
			{
				me.performFinish( count )
			}, 1000 );
		}


		me.performFinish = function( count )
		{
			if ( count == me.finishCount )
			{
				//console.log( 'perform finish:' + me.finishCount );

				// me.orgUnitPopupManager.mode = "";
				
				// Filter values
				me.filterTableValue( me.dataListingTableTag );
				
				me.makeTableSortable();
				
				me.composeRetrievalResults();
			}
		}


		me.composeRetrievalResults = function()
		{
			//console.log( 'composeRetrievalResults' );

			// Compose Run Result Message
			var viewColumnsTableManager = me.oProviderNetwork.viewManager.viewColumnsTableManager;
			
			var messageText = '<b>Result</b>: &nbsp;';  //'Pivot: ' + viewColumnsTableManager.getPivotName();

			var tableBodyTag = me.dataListingTableTag.find( 'tbody' );
			messageText += tableBodyTag.find( "tr:visible" ).length + ' OrgUnit Found';


			var groupFilterName = viewColumnsTableManager.getPivotFilterGroupName();
			if ( groupFilterName != "" )
			{
				messageText += " ('" + groupFilterName + "' OrgUnitGroup filter used)";
			}

			// Display message
			MsgManager.networkListingMsgShow( messageText, true );

			//console.log( 'composeRetrievalResults, messageText: ' + messageText );
		}



		me.applySortingIfReady = function( dataRetrieveCount )
		{
			// In case of no Ajax loading cell data..
			if ( dataRetrieveCount == 0 )
			{
				// For displaying message, run after 0.3 sec..
				setTimeout( function()
				{
					me.checkRequest(); // initiates the sorting right away.
				}, 300 );
			}
		}


		me.getParentStrToTop = function( level )
		{
			if ( level > 0 )
			{
				return ",parent[id,name" + me.getParentStrToTop( level - 1 ) + "]";
			}
			else
			{
				return "";
			}
		}	

		// Add new case?
		me.popupPivotOneOrgUnitData = function( ouId, mode )
		{			
			var queryURL = _queryURL_api + 'organisationUnits/' + ouId + '.json?fields=organisationUnitGroups[id,name],programs[id,name],dataSets[id,name],children[id,organisationUnitGroups[id,name],programs[id,name],dataSets[id,name]]' + me.getParamURLOrgUnitInfo();


			AppUtil.getAsynchData_WithPush( queryURL, function( json_Data )
			{
				//var orgUnitList_One = [];
				//orgUnitList_One.push( json_Data );
				me.constructOuParents( [ json_Data ] );

				me.setMemory_OrgUnitRetrieved_One_OrgUnit( json_Data );
				
				var tableBodyTag = me.dataListingTableTag.find( 'tbody' );
				var trRow_New = me.pivotDataRowCreate( json_Data, tableBodyTag );
										
				var viewColumnsTableManager = me.oProviderNetwork.viewManager.viewColumnsTableManager;
				var viewColumnTable = viewColumnsTableManager.viewColumnsTableTag;

				me.dataRow_SetColumnsAndPopulateData( me.dataListingTableTag, viewColumnTable, json_Data, mode ); 

				
				// Move the new row to the appropriate location - closer to clicked place/row.
				me.moveNewRowTag( trRow_New, tableBodyTag, me.addClickedRowOuId );

			});		
		}
		
		
		me.moveNewRowTag = function( trTag, tableBodyTag, addClickedRowOuId )
		{
			
			//trTag.insert( divHiddenPlaceHolderTag );


			// If 'addNew orgUnit' case, insert after that row.
			if ( addClickedRowOuId !== undefined )
			{
				if ( addClickedRowOuId == "Top" )
				{
					var moveLocation = tableBodyTag.find( 'tr[ouid]:first' );

					if ( moveLocation.length > 0 )
					{
						trTag.detach().insertBefore( moveLocation );
					}
				}
				else
				{
					// If clicked row info is provided, add to below of that row
					var moveLocation = tableBodyTag.find( 'tr[ouid="' + addClickedRowOuId + '"]' );

					if ( moveLocation.length > 0 )
					{
						trTag.detach().insertAfter( moveLocation );
					}
				}
			}
		}
		

		// Edit case?
		me.popupPivotOneOrgUnitJsonData = function( json_Data, mode, networkType )
		{
			me.setMemory_OrgUnitRetrieved_One_OrgUnit( json_Data );
			
			var tableBodyTag = me.dataListingTableTag.find( 'tbody' );

			me.pivotDataRowCreate( json_Data, tableBodyTag );
			

			Util.paintLightGreen( tableBodyTag.find( "div[ouid='" + json_Data.id + "']" ).closest( "tr" ).find( "td" ) );

									
			var viewColumnsTableManager = me.oProviderNetwork.viewManager.viewColumnsTableManager;
			var viewColumnTable = viewColumnsTableManager.viewColumnsTableTag;

			me.dataRow_SetColumnsAndPopulateData( me.dataListingTableTag, viewColumnTable, json_Data, mode, networkType ); 
		}



		// ------------------------------------------------------------

		me.setUp_tableDraggable = function()
		{
			me.dataListingTableTag.dragtable(
			{ 
				placeholder: 'dragtable-col-placeholder'
				,items: 'thead th:not( .notdraggable ):not( :has( .dragtable-drag-handle ) ), .dragtable-drag-handle'
				,scroll: true 
				,stop: function( event, ui )
				{
					//$( this ).removeClass( 'noclick' );

					// Need to reorganize the Column Setting Table..
					me.oProviderNetwork.viewManager.viewColumnsTableManager.reorderViewColumnsRows( me.dataListingTableTag );
				}
				,start: function( event, ui )
				{
					// For resolving the conflict with sorting.
					//$(this).addClass( 'noclick' );
				}
			});
		};

		me.updateHeader = function( tableTag )
		{
			var header_1 = tableTag.find( 'th[data-column="1"]' );

			//header_1.

		}

		me.makeTableSortable = function()
		{
			var dataLstingTableHeaderCount = me.dataListingTableTag.find( 'tr.trHeader th[rowid]' ).length;

			if ( _enable_TableSorting && dataLstingTableHeaderCount > 0 )
			{

				// Display the message.
				MsgManager.networkListingMsgShow( 'Apply Sorting to table' , true, undefined, true );
				console.log( 'Apply Sorting to table' );	

				var sortingData = me.oProviderNetwork.getViewColumnsTableSortings();
				var sortingList = me.generateSortingList( sortingData );

				//( me.sortPerformedBefore ) ? console.log( 'updateAll: ' + JSON.stringify( sortingList ) ) : console.log( 'tableSort: ' + JSON.stringify( sortingList ) );

				var config = me.dataListingTableTag[0].config;
				var callback = function() {};

				if ( me.sortPerformedBefore )
				{
					$.tablesorter.updateAll( config, sortingList, callback );
					$.tablesorter.sortOn( config, sortingList.sortList, callback );
				}
				else
				{
					me.dataListingTableTag.tablesorter( sortingList );
				}

				me.sortPerformedBefore = true;


				// due to sorting update removing the 'add New OrgUnit' event on header, re-set the event.
				var newOuButtons = me.dataListingTableTag.find( 'tr.trHeader th[rowid]' ).find( "button.openOrgUnitForm" );

				newOuButtons.each( function()
				{
					var addOuButtonTag = $( this );

					me.setupEvent_AddOrgUnit( addOuButtonTag, addOuButtonTag.attr( 'networkType' ) );
				});
			}
		};

		
		me.generateSortingList = function( sortingData )
		{
			// Sort (List..) it with index..
			// But we need to put the lower number first in the array..
			var sortList = [];

			if ( sortingData !== undefined && sortingData.length > 0 )
			{
				var sortingData_Ordered = Util.sortByKey( sortingData, "sortNumber" );

				$.each( sortingData_Ordered, function( i, item )
				{
					var direction = ( item.sortDirection == 'A' ) ? 0 : 1 ;
					sortList.push( [ item.rowIndex, direction ] );
				});
			}

			return { 'sortList': sortList };
		}; 

		// ----------------------------------------------------

		// ------------------------------------------------
		// Initial Setup Call

		me.initialSetup();

	}

	// -- End of Data Table Manage Class
	// -------------------------------------

	// -------------------------------------------
	// -- ViewServiceManager Class

	function ViewServiceManager( providerNetwork, viewManager )
	{
		var me = this;

		me.oProviderNetwork = providerNetwork;
		me.viewManager = viewManager; 


		// --- Methods ------

		me.validateViewName = function( networkName, viewName, successFun ) 
		{
			// Check if the view name already exists 
			me.viewManager.checkNetworkViewByName( networkName, viewName, function( exists )
			{
				if ( exists ) alert( "The View name, '" + viewName + "', already exists!" );
				else successFun();
			});
		};

		me.createView = function( networkName, enteredViewName, returnFunc )
		{
			me.validateViewName( networkName, enteredViewName, function()
			{
				var viewObjData = { "name": enteredViewName
					, "id": Util.generateRandomId()
					, "owner": me.oProviderNetwork.getUserId()
					, "security": me.oProviderNetwork.getInitialSecurity()
					, "pivot": me.oProviderNetwork.network_Name
					, "data": [] };

				me.viewManager.saveNetworkViewObjData( networkName, viewObjData, function( success )
				{
					returnFunc( success, viewObjData );
				});																
			});
		};

		me.deleteView = function( networkName, viewId, returnFunc )
		{
			// Delete the view
			me.viewManager.deleteNetworkView( networkName, viewId, function( success )
			{
				returnFunc( success );
			});
		};

		me.copyView = function( networkName, selectedViewId, newViewName, returnFunc )
		{
			me.validateViewName( networkName, newViewName, function()
			{
				me.viewManager.getNetworkViewObjData( networkName, selectedViewId, function( viewData )
				{
					if ( viewData === undefined )
					{
						alert( "Could not rerieve the view data" );
					}
					else
					{
						var viewObjData = { "name": newViewName, "id": Util.generateRandomId(), "owner": me.oProviderNetwork.getUserId() };

						for( var prop in viewData )
						{
							if ( prop != "name" && prop != "id" && prop != "owner" ) viewObjData[ prop ] = viewData[ prop ];
						}


						me.viewManager.saveNetworkViewObjData( networkName, viewObjData, function( success )
						{
							returnFunc( success, viewObjData );
						});		
					}
				});	
			});
		};


		me.renameView = function( networkName, selectedViewId, newViewName, returnFunc )
		{
			me.validateViewName( networkName, newViewName, function()
			{
				me.viewManager.renameNetworkView ( networkName, selectedViewId, newViewName, function( success )
				{
					returnFunc( success );
				});
			});
		}


		me.setViewSecurity = function( security, returnFunc )
		{
			var networkName = me.oProviderNetwork.getSelectedNetworkName();
			var viewId = me.viewManager.getSelectedViewVal();

			// Save it..
			me.viewManager.getNetworkViewObjData( networkName, viewId, function( viewData )
			{
				viewData.security = security;

				me.viewManager.saveNetworkViewObjData( networkName, viewData, function( success )
				{
					if ( returnFunc !== undefined ) returnFunc( success );
				});
			});
		};

		me.addViewSecurityPermissions = function( permission, returnFunc )
		{
			var networkName = me.oProviderNetwork.getSelectedNetworkName();
			var viewId = me.viewManager.getSelectedViewVal();

			// Save it..
			me.viewManager.getNetworkViewObjData ( networkName, viewId, function( viewData )
			{
				viewData.security.permissions.push( permission );

				me.viewManager.saveNetworkViewObjData( networkName, viewData, function( success )
				{
					if ( returnFunc !== undefined ) 
					{
						if ( success ) MsgManager.msgAreaShow( "Added the user group on security" );

						returnFunc( success );
					}
				});
			});
		};

		me.removeViewSecurityPermissions = function( userGroupId, returnFunc )
		{
			var networkName = me.oProviderNetwork.getSelectedNetworkName();
			var viewId = me.viewManager.getSelectedViewVal();

			// Save it..
			me.viewManager.getNetworkViewObjData ( networkName, viewId, function( viewData )
			{				
				Util.RemoveFromArray( viewData.security.permissions, 'id', userGroupId );

				me.viewManager.saveNetworkViewObjData( networkName, viewData, function( success )
				{
					if ( returnFunc !== undefined ) 
					{
						if ( success ) MsgManager.msgAreaShow( "Removed the user group on security." );

						returnFunc( success );
					}
				});
			});
		};

		me.setViewSecurity_anybodyView = function( enabled, returnFunc )
		{
			var networkName = me.oProviderNetwork.getSelectedNetworkName();
			var viewId = me.viewManager.getSelectedViewVal();

			// Save it..
			me.viewManager.getNetworkViewObjData ( networkName, viewId, function( viewData )
			{
				viewData.security.anybodyView = enabled;

				me.viewManager.saveNetworkViewObjData( networkName, viewData, function( success )
				{
					if ( returnFunc !== undefined ) 
					{
						if ( success ) MsgManager.msgAreaShow( "Anybody View set to " + enabled );

						returnFunc( success );
					}
				});
			});
		};


		// -------------------------------
	}

	// -- End of ViewServiceManager Class
	// -------------------------------------------

	// -------------------------------------------
	// -- OrgUnitPopupManager Class --------------

	// --------- Placed In Separate File ---------

	// -- OrgUnitPopupManager Class --------------
	// -------------------------------------------


	// -------------------------------------------
	// -- OrgUnit Selection Popup Class
	function OrgUnitSelectionTreePopup()
	{
		var me = this;

		me.dialogFormTag = $( "#orgUnitSelectionTreeDialogForm" );

		me.selectedOu;

		me.selectedOu_FromSearchPanel;

		me.onOrgUnitSelectFunc;


		// -- Methods ----------------

		me.FormPopupSetup = function()
		{
			// -- Set up the form -------------------
			me.dialogFormTag.dialog({
			  autoOpen: false,
			  dialogClass: "noTitleStuff",
			  width: 530,
			  height: 500,
			  modal: true,
			  buttons: {
				"Close": function() {
					$( this ).dialog( "close" );
				}
			  }
			});		
		}


		me.openForm = function()
		{
			me.dialogFormTag.show();

			me.dialogFormTag.dialog( "open" );
		}


		me.clearSelections = function()
		{
			selectionTreeSelection.clearSelections();
			selectionTreeSelection.collapseTree( $( '#selectionTree' ) );
		}


		// Make the one orgUnit on the tree selected.
		me.selectOrgUnit = function( orgUnitId, parents )
		{
			selectionTreeSelection.collapseTree( $( '#selectionTree' ) );

			setTimeout( function()
			{
				selectionTreeSelection.expandTree( parents, 1, function()
				{
					selectionTreeSelection.select( orgUnitId, true );						
				});

			}, 100 );
		}


		// Register the action method after/when orgUnit is selected from popup
		me.onOrgUnitSelectSet = function( onOrgUnitSelectFunc )
		{
			me.onOrgUnitSelectFunc = onOrgUnitSelectFunc;
		}


		// Set up the OrgUnit Tree OU Selection Click event
		me.setUp_OrgUnitTreeSelection = function()
		{
			selectionTreeSelection.setMultipleSelectionAllowed( false );

			selectionTreeSelection.setOnSelectFunction( function()
			{					
				me.selectedOu = selectionTreeSelection.getSelectedObj();

				if ( me.selectedOu !== undefined )
				{
					if ( me.onOrgUnitSelectFunc !== undefined ) me.onOrgUnitSelectFunc( me.selectedOu, true );

					me.dialogFormTag.dialog( "close" );
				}

			});

			selectionTree.buildSelectionTree();
		}


		// Initial Setup Call
		me.initialSetup = function()
		{				
			me.FormPopupSetup();

			me.setUp_OrgUnitTreeSelection();
		}

		// --------------------------
		// Run methods

		// Initial Run Call
		me.initialSetup();
	}

	// Class - OrgUnit Selection Popup Class
	// -------------------------------------------


	// -------------------------------------------
	// Class - Controls Popup Form
	//		- Used for popup View Form

	function ControlsPopupForm( oProviderNetwork )
	{
		var me = this;
		me.oProviderNetwork = oProviderNetwork;
		
		me.dialogFormTag = $( "#controlsDialogForm" );

		me.useIndividualDataRetrievalTag = $( '#useIndividualDataRetrieval' );
		me.enableEditOrgunitRowTag = $( '#enableEditOrgunitTR' );
		me.enableEditOrgunitTag = $( '#enableEditOrgunit' );

		me.enableAppSecretUserModeRowTag = $( '#enableAppSecretUserModeTR' );
		me.enableAppSecretUserModeTag = $( '#enableAppSecretUserMode' );
		
		me.datatableTag = $("#datatable");

		me.width = me.dialogFormTag.attr( 'formWidth' );
		me.height = me.dialogFormTag.attr( 'formHeight' );

		// -------------------------------------------------------
		// -- Exposed gets

		me.checkUseIndividualDataRetrieval = function()
		{
			return me.useIndividualDataRetrievalTag.is( ':checked' );
		};
		
		me.checkEnableAppSecretUserMode = function()
		{
			return me.enableAppSecretUserModeTag.is( ':checked' );
		};
		

		// -------------------------------------------------------

		me.FormPopupSetup = function()
		{
			// -- Set up the form -------------------
			me.dialogFormTag.dialog(
			{
				autoOpen: false
				,title: "Controls Setting" 
				,width: me.width
				,height: me.height				  
				,modal: true				
				,close: function( event, ui ) 
				{						
						$( this ).dialog( "close" );
				}
				,buttons: {
					"Close": function() 
					{
						me.dialogFormTag.dialog( "close" );
					}
				 }
			});	
		};

		me.openForm = function()
		{
			me.dialogFormTag.dialog( "open" );
		};
		
		// Initial Setup Call
		me.initialSetup = function()
		{
			me.setup_Events();
			
			if( me.oProviderNetwork.isSecretUser() )
			{
				me.enableAppSecretUserModeRowTag.show();
				//me.enableEditOrgunitRowTag.show();
			}
			else
			{
				me.enableAppSecretUserModeRowTag.hide();
				//me.enableEditOrgunitRowTag.hide();
			}
			
			me.FormPopupSetup();
		};

		me.setup_Events = function()
		{
			/*
			me.enableEditOrgunitTag.change( function()
			{
				var addNewBtns = me.datatableTag.find(".openNetworkOrgUnitForm, .openNetworkChildOrgUnitForm, .openNetworkParentOrgUnitForm");
			
				if( me.checkOrgunitEditAuthority() )
				{
					addNewBtns.show();
				}
				else{
					addNewBtns.hide();
				}
			});
			*/
		};
		
		// --------------------------
		// Run methods

		// Initial Run Call
		me.initialSetup();

	}

	// Class - Controls Popup Form
	// -------------------------------------------

	// -------------------------------------------
	// Class - ViewCreatePopupForm
	//		- Used for popup View Form

	function ViewCreatePopupForm( oProviderNetwork, viewManager )
	{
		var me = this;

		me.oProviderNetwork = oProviderNetwork;
		me.viewManager = viewManager;

		me.viewCreatePopupOpenTag = $( '#viewCreatePopupOpen' );

		me.dialogFormTag = $( "#viewCreateDialogForm" );

		me.width = me.dialogFormTag.attr( 'formWidth' );
		me.height = me.dialogFormTag.attr( 'formHeight' );

		me.viewCreateNameTag = $( '#viewCreateName' );

		me.action = "";


		// -----------------------------------------

		// Initial Setup Call
		me.initialSetup = function()
		{
			//me.setOrgUnitList( me.countryLevelTag );
			me.setup_Events();

			me.FormPopupSetup();

			// Set visibility by user permission
			me.setVisibility_ByUserPermission( me.oProviderNetwork.getUserPermission_Authorities() );
			
		};

		// -----------------------------------------

		me.openForm = function( action )
		{
			me.action = action;

			me.viewCreateNameTag.val( '' );

			me.populateSettingData();

			me.dialogFormTag.dialog( "open" );
		};

		// -----------------------------------------


		me.setVisibility_ByUserPermission = function( authorities )
		{
			if ( authorities.View_Edit ) me.viewCreatePopupOpenTag.show();
		}

		me.setup_Events = function()
		{
			me.viewCreatePopupOpenTag.click( function()
			{
				AppUtil.checkAndRedirect_DHISSession( function()
				{
					me.openForm();
				});
			});
		};

		me.FormPopupSetup = function()
		{
			// -- Set up the form -------------------
			me.dialogFormTag.dialog({
			  autoOpen: false
			  ,title: "View Create"
			  ,width: me.width
			  ,height: me.height				  
			  ,modal: true				
			  ,close: function( event, ui ) 
				{
					$( this ).dialog( "close" );
				}
			  ,buttons: {

				"Save": function() 
				{

					var dialogForm = $( this );

					var networkName = me.oProviderNetwork.getSelectedNetworkName();

					var enteredViewName = me.viewCreateNameTag.val();

					//if ( me.action == "Create" )

					me.viewManager.viewServiceManager.createView( networkName, enteredViewName, function( success, viewObjData )
					{
						if ( !success )
						{
							alert( 'Failed to create the view' );
						}
						else
						{
							me.afterSaveAction( viewObjData.id, dialogForm );
						}
					});
				}
				,"Close": function() 
				{
					me.dialogFormTag.dialog( "close" );
				}

			  }				
			});		
		};


		me.afterSaveAction = function( viewId, dialogForm )
		{
			// Refresh the View list!!
			me.viewManager.populateNetworkView();

			dialogForm.dialog( "close" );

			me.viewManager.changeView( viewId );
		};


		me.populateSettingData = function()
		{
		};

		
		// --------------------------
		// Run methods

		// Initial Run Call
		me.initialSetup();

	}

	// Class - ViewCreatePopupForm
	// -------------------------------------------

	// -------------------------------------------
	// Class - View Column Popup Form

	function ViewColumnsPopupForm( oProviderNetwork, viewManager )
	{
		var me = this;

		me.oProviderNetwork = oProviderNetwork;
		me.viewManager = viewManager;

		me.viewColumnsPopupOpenTag = $( '#viewColumnsPopupOpen' );

		me.dialogFormTag = $( "#viewColumnsPopupForm" );

		me.viewColumnsOuterDivTag = $( '#viewColumnsOuterDiv' );
		me.viewColumnsDivTag = $( '#viewColumnsDiv' );

		me.width = me.dialogFormTag.attr( 'formWidth' );
		me.height = me.dialogFormTag.attr( 'formHeight' );


		// --------------------------------------------------

		// Initial Setup Call
		me.initialSetup = function()
		{			
			me.FormPopupSetup();

			me.setup_Events();

			me.setVisibility_ByUserPermission( me.oProviderNetwork.getUserPermission_Authorities() );
		};


		me.openForm = function()
		{
			me.setUI_OnSecurity();

			me.dialogFormTag.dialog( "open" );
		};


		me.FormPopupSetup = function()
		{
			// -- Set up the form -------------------
			me.dialogFormTag.dialog(
			{
				autoOpen: false
				,title: "View Columns"
				,width: me.width
				,height: me.height				  
				,modal: true				
				,close: function( event, ui ) 
				{
					$( this ).dialog( "close" );
				}
				,buttons: 
				{
					"Close": function() 
					{
						me.dialogFormTag.dialog( "close" );
					}
				 }				
			});		
		};

		// --------------------------------------------------
		

		me.setVisibility_ByUserPermission = function( authorities )
		{
			if ( authorities.View_Edit ) me.viewColumnsPopupOpenTag.show();
		}


		me.setUI_OnSecurity = function()
		{
			me.viewTags_Enable( me.viewManager.getCurrentViewPermission() );
		};
		

		me.viewTags_Enable = function( enable )
		{
			Util.disableTag( me.viewColumnsOuterDivTag.find( 'input,select,button' ), !enable );

			if ( !enable )
			{
				// disable the rowMoving..
				var tableTag = me.viewManager.viewColumnsTableManager.viewColumnsTableTag;
				AppUtil.disableRowMoving( tableTag.find( 'tr' ) );

				// disable the buttons..

			}
		};


		me.setup_Events = function()
		{
			me.viewColumnsPopupOpenTag.click( function()
			{
				AppUtil.checkAndRedirect_DHISSession( function()
				{
					me.openForm();
				});
			});
		};


		// --------------------------
		// Run methods

		// Initial Run Call
		me.initialSetup();

	}

	// Class - View Column Popup Form
	// -------------------------------------------


	// -------------------------------------------
	// Class - View Manage Popup Form

	function ViewManagePopupForm( providerNetwork, viewManager )
	{
		var me = this;

		me.oProviderNetwork = providerNetwork;
		me.viewManager = viewManager;

		me.viewManagePopupOpenTag = $( '#viewManagePopupOpen' );

		me.dialogFormTag = $( "#viewManagePopupForm" );

		me.viewCopyTag = $( '#viewCopy' );
		me.viewRenameTag = $( '#viewRename' );
		me.viewChangePivotTag = $( '#viewChangePivot' );
		me.viewSetSecurityTag = $( '#viewSetSecurity' );
		me.viewDeleteTag = $( '#viewDelete' );

		me.divViewCopySectionTag = $( '#divViewCopySection' );
		me.viewCopyNameTag = $( '#viewCopyName' );
		me.viewCopyBtnTag = $( '#viewCopyBtn' );

		me.divViewRenameSectionTag = $( '#divViewRenameSection' );
		me.viewRenameNameTag = $( '#viewRenameName' );
		me.viewRenameBtnTag = $( '#viewRenameBtn' );

		me.divViewChangePivotTag = $( '#divViewChangePivotSection' );
		me.viewChangePivotSelectTag = $( '#viewChangePivotSelect' );

		me.divViewSetSecuritySectionTag = $( '#divViewSetSecuritySection' );
		me.viewUserGroupSelectTag = $( '#viewUserGroupSelect' );
		me.viewSetSecurityBtnTag = $( '#viewSetSecurityBtn' );
		me.divViewUserGroupLoadingTag = $( '#divViewUserGroupLoading' );

		me.width = me.dialogFormTag.attr( 'formWidth' );
		me.height = me.dialogFormTag.attr( 'formHeight' );


		// ---------------------------------
		// -- Methods -----------------


		// Initial Setup Call
		me.initialSetup = function()
		{			
			me.FormPopupSetup();

			me.setup_Events();

			// Set visibility by user permission
			me.setVisibility_ByUserPermission( me.oProviderNetwork.getUserPermission_Authorities() );
		};


		// ----------------------------------------------------

		me.FormPopupSetup = function()
		{
			// -- Set up the form -------------------
			me.dialogFormTag.dialog(
			{
				autoOpen: false
				,title: "View Manage"
				,width: me.width
				,height: me.height				  
				,modal: true				
				,close: function( event, ui ) 
				{
					$( this ).dialog( "close" );
				}
				,buttons: {
					"Close": function() 
					{
						me.dialogFormTag.dialog( "close" );
					}
				}
			});		
		};

		// ---------------------------------------------------

		me.openForm = function()
		{
			me.hideDetailSections();

			me.setUI_OnSecurity();

			me.dialogFormTag.dialog( "open" );
		};


		me.setVisibility_ByUserPermission = function( authorities )
		{
			if ( authorities.View_Edit ) me.viewManagePopupOpenTag.show();
		}


		me.getViewChangePivotSelectTag = function()
		{
			return me.viewChangePivotSelectTag;
		};


		me.hideDetailSections = function()
		{
			me.divViewCopySectionTag.hide( "fast" );
			me.divViewRenameSectionTag.hide( "fast" );
			me.divViewSetSecuritySectionTag.hide( "fast" );
			me.divViewChangePivotTag.hide( "fast" );
		};

		me.setUI_OnSecurity = function()
		{
			me.viewTags_Disable( !me.viewManager.getCurrentViewPermission() );
		};


		me.viewTags_Disable = function( disable )
		{
			me.disableViewTag( me.viewRenameTag, disable );
			me.disableViewTag( me.viewSetSecurityTag, disable );
			me.disableViewTag( me.viewDeleteTag, disable );			
			me.disableViewTag( me.viewChangePivotTag, disable );			
		};


		me.disableViewTag = function( tag, disable )
		{
			Util.disableTag( tag, disable );

			( disable ) ? tag.css( 'background-color', 'lightGray' ).css( 'border-color', 'Gray' ).css( 'cursor', 'auto' ) : tag.css( 'background-color', '' ).css( 'border-color', '' ).css( 'cursor', '' );
		};


		me.afterSaveAction = function( enteredViewName, dialogForm )
		{
			// Refresh the View list!!
			me.viewManager.populateNetworkView();

			dialogForm.dialog( "close" );

			me.viewManager.changeView( enteredViewName );
		};


		// ----------------------------------------------
		// -- Event Related

		me.setup_Events = function()
		{

			me.viewManagePopupOpenTag.click( function()
			{
				AppUtil.checkAndRedirect_DHISSession( function()
				{
					me.openForm();
				});
			});


			me.viewCopyTag.click( function()
			{
				me.hideDetailSections();

				me.viewCopyNameTag.val( 'Copy Of ' + me.viewManager.getSelectedViewName() );

				me.divViewCopySectionTag.show( 'medium' );
			});


			me.viewRenameTag.click( function()
			{
				me.hideDetailSections();

				me.viewRenameNameTag.val( me.viewManager.getSelectedViewName() );

				me.divViewRenameSectionTag.show( 'medium' );
			});


			me.viewChangePivotTag.click( function()
			{
				me.hideDetailSections();

				me.divViewChangePivotTag.show( 'medium' );
			});


			me.viewSetSecurityTag.click( function()
			{
				me.hideDetailSections();


				var networkName = me.oProviderNetwork.getSelectedNetworkName();
				var viewId = me.viewManager.getSelectedViewVal();

				me.viewManager.getNetworkViewObjData( networkName, viewId, function( viewData )
				{

					// if the security does not exists, create one and update it.
					if ( viewData.security === undefined )
					{
						viewData.security = me.oProviderNetwork.getInitialSecurity();

						me.viewManager.viewServiceManager.setViewSecurity( viewData.security, function()
						{
							console.log( 'Note - new view security created: ' + JSON.stringify( viewData.security ) );	
						});
					}


					var securityData = { 'sharingName': me.viewManager.getSelectedViewName(), 'ownerId': viewData.owner, 'targetSecurityData': viewData.security };

					me.oProviderNetwork.securitySettingPopupForm.openForm( securityData, me.viewManager.viewServiceManager.addViewSecurityPermissions, me.viewManager.viewServiceManager.removeViewSecurityPermissions, me.viewManager.viewServiceManager.setViewSecurity_anybodyView );
				});

			});


			me.viewDeleteTag.click( function()
			{
				me.hideDetailSections();

				var networkName = me.oProviderNetwork.getSelectedNetworkName();
				var viewId = me.viewManager.getSelectedViewVal();
				var viewName = me.viewManager.getSelectedViewName();

				if ( confirm( "Are you sure you want to delete '" + viewName + "' view?" ) )
				{
					// Delete the view
					me.viewManager.viewServiceManager.deleteView( networkName, viewId, function( success )
					{
						if ( success )
						{
							me.viewManager.reload_NetworkViewListTag();

							me.dialogFormTag.dialog( "close" );

							MsgManager.msgAreaShow( "'" + viewName + "' view deleted" );
						}
						else
						{
							alert( 'Failed to delete the view' );
						}						
					});
				}				
			});


			me.viewCopyBtnTag.click( function()
			{

				var networkName = me.oProviderNetwork.getSelectedNetworkName();
				var selectedViewId = me.viewManager.getSelectedViewVal();
				var selectedViewName = me.viewManager.getSelectedViewName();
				var newViewName = me.viewCopyNameTag.val();
			
				me.viewManager.viewServiceManager.copyView( networkName, selectedViewId, newViewName, function( success, viewObjData )
				{
					if ( !success ) alert( 'Failed to copy the view' );
					else
					{
						MsgManager.msgAreaShow( "'" + newViewName + "' view was copied from '" + selectedViewName + "' view" );

						me.afterSaveAction( viewObjData.id, me.dialogFormTag );
					}
				});
			});


			me.viewRenameBtnTag.click( function()
			{

				var networkName = me.oProviderNetwork.getSelectedNetworkName();
				var selectedViewId = me.viewManager.getSelectedViewVal();
				var selectedViewName = me.viewManager.getSelectedViewName();
				var newViewName = me.viewRenameNameTag.val();


				me.viewManager.viewServiceManager.renameView( networkName, selectedViewId, newViewName, function( success )
				{
					if ( !success )
					{
						alert( "Failed to rename the view." );
					}
					else
					{
						MsgManager.msgAreaShow( "'" + selectedViewName + "' view was renamed as '" + newViewName + "'" );

						me.afterSaveAction( selectedViewId, me.dialogFormTag );
					}
				});
			});


			me.viewChangePivotSelectTag.change( function()
			{
				var selectedViewName = me.viewManager.getSelectedViewName();
				var selectedValue = $( this ).val();

				me.viewManager.switchPivot( selectedValue );

				MsgManager.msgAreaShow( "Pivot of '" + selectedViewName + "' view has been changed to '" + selectedValue + "'" );

				me.hideDetailSections();
			});


			me.viewSetSecurityBtnTag.click( function()
			{
			});
		};


		// -- Event Related
		// ----------------------------------------------


		// --------------------------
		// Run methods

		// Initial Run Call
		me.initialSetup();

	}

	// Class - View Manage Popup Form
	// -------------------------------------------


	// -------------------------------------------
	// Class - View Link Popup Form

	function ViewLinkPopupForm( providerNetwork, viewManager )
	{
		var me = this;

		me.oProviderNetwork = providerNetwork;
		me.viewManager = viewManager;

		me.viewLinkPopupOpenTag = $( '#viewLinkPopupOpen' );

		me.dialogFormTag = $( "#viewLinkDialogForm" );

		me.viewLinkUrlTag = $( "#viewLinkUrl" );

		me.width = me.dialogFormTag.attr( 'formWidth' );
		me.height = me.dialogFormTag.attr( 'formHeight' );


		// ---------------------------------------

		me.composeViewLinkUrl = function()
		{
			var linkUrl = window.location.href.split('?')[0] 
				+ "?" + _param_viewId + "=" + me.viewManager.getSelectedViewVal() 
				+ "/" + me.oProviderNetwork.getSelectedNetworkVal() 
				+ "-" + me.viewManager.getSelectedViewName();

			me.viewLinkUrlTag.val( linkUrl );
		};

		me.FormPopupSetup = function()
		{
			// -- Set up the form --
			me.dialogFormTag.dialog(
			{
				autoOpen: false
				,title: "View Link"
				,width: me.width
				,height: me.height				  
				,modal: true				
				,close: function( event, ui ) 
				{
					$( this ).dialog( "close" );
				}
				,buttons: 
				{
					"Close": function() 
					{
						me.dialogFormTag.dialog( "close" );
					}
				}				
			});		
		};

		me.openForm = function()
		{
			me.resetControls();

			// get the url composed..
			me.composeViewLinkUrl();

			me.dialogFormTag.dialog( "open" );
		};

		me.resetControls = function()
		{
			me.viewLinkUrlTag.val( '' );
		};


		me.setup_Events = function()
		{
			me.viewLinkPopupOpenTag.click( function()
			{
				me.openForm();
			});
		};

		// Initial Setup Call
		me.initialSetup = function()
		{			
			me.FormPopupSetup();

			me.setup_Events();
		};

		// --------------------------
		// Run methods

		// Initial Run Call
		me.initialSetup();

	}

	// Class - View Link Popup Form
	// -------------------------------------------


	// -------------------------------------------
	// Class - Security Setting Popup Form

	function SecuritySettingPopupForm( providerNetwork )
	{
		var me = this;

		me.oProviderNetwork = providerNetwork;

		me.targetSecurityData;

		me.addSecurityFunc;
		me.removeSecurityFunc;
		me.anybodyViewSecurityFunc;

		me.dialogFormTag = $( "#securitySettingDialogForm" );

		me.width = me.dialogFormTag.attr( 'formWidth' );
		me.height = me.dialogFormTag.attr( 'formHeight' );


		me.sharingNameTag = $( '#sharingName' );
		me.createdUserTag = $( '#createdUser' );
		
		me.sharingAccessTableTag = $( '#sharingAccessTable' );

		me.securityUserGroupsTag = $( '#securityUserGroups' );
		me.securityViewEditChioceTag = $( '#securityViewEditChioce' );
		me.securityUserGroups_loadingTag = $( '#securityUserGroups_loading' );

		me.addSecurityUserGroupAccessTag = $( '#addSecurityUserGroupAccess' );

		me.anybodyViewDisableTag = $( '#anybodyViewDisable' );
		me.anybodyViewEnableTag = $( '#anybodyViewEnable' );

		// ---------------------------------------


		me.openForm = function( securityData, addSecurityFunc, removeSecurityFunc, anybodyViewSecurityFunc )
		{
			me.targetSecurityData = securityData.targetSecurityData;

			me.addSecurityFunc = addSecurityFunc;
			me.removeSecurityFunc = removeSecurityFunc;
			me.anybodyViewSecurityFunc = anybodyViewSecurityFunc;


			me.resetControls();
	
			me.populateData( securityData );

			me.dialogFormTag.dialog( "open" );
		};

		me.resetControls = function()
		{
			me.sharingNameTag.text( '' );

			me.createdUserTag.text( '' ).attr( 'title', '' );
		};

		me.populateData = function( securityData )
		{
			me.sharingNameTag.text( securityData.sharingName );

			me.setOwnerNameById( securityData.ownerId );

			me.userGroupLoad( me.securityUserGroupsTag, me.securityUserGroups_loadingTag, function() {} );
			
			me.clearDataRows( me.sharingAccessTableTag );

			me.populateAnybodyViewPermission( me.targetSecurityData.anybodyView, me.sharingAccessTableTag );

			me.populateExistingUserGroups( me.targetSecurityData.permissions, me.sharingAccessTableTag );
		};

		me.setOwnerNameById = function( ownerId )
		{
			var queryURL = _queryURL_api + 'users/' + ownerId + '.json?fields=name,userCredentials[username]';

			$.get( queryURL, function( userData )
			{
				me.createdUserTag.text( userData.name );

				if ( userData.userCredentials !== undefined && userData.userCredentials.username !== undefined )
				{
					me.createdUserTag.attr( 'title', userData.userCredentials.username );
				}
			});
		};

		me.clearDataRows = function( tableTag )
		{
			tableTag.find( 'tr.addedTrData' ).remove();
		};

		me.populateAnybodyViewPermission = function( anybodyView, sharingAccessTableTag )
		{
			// if data exists
			if ( anybodyView !== undefined && !anybodyView )
			{
				// set the row to be disabled and set up the enable button..
				me.anybodyViewDisableTag.hide();
				me.anybodyViewEnableTag.show();

				sharingAccessTableTag.find( 'tr.trAnybody' ).addClass( 'crossOutDisabled' );
			}
			else
			{
				me.anybodyViewEnableTag.hide();
				me.anybodyViewDisableTag.show();

				sharingAccessTableTag.find( 'tr.trAnybody' ).removeClass( 'crossOutDisabled' );
			}
		}


		me.populateExistingUserGroups = function( permissions, sharingAccessTableTag )
		{
			//var noPermissionFound = true;

			// populate the table permission list
			$.each( permissions, function( i_perm, item_perm )
			{
				//noPermissionFound = false;

				me.retrieveUserGroupName( item_perm.id, function( userGroupName )
				{
					var trTag = me.getNewRow( userGroupName, item_perm.id, item_perm.type );

					sharingAccessTableTag.find( 'tbody' ).append( trTag );
				});
			});
		};

		me.getNewRow = function( userGroupName, userGroupId, type )
		{
			var typeDesc = '';

			if ( type == 'Edit' ) typeDesc = "Can View and Edit";
			else if ( type == 'View' ) typeDesc = "Can View";


			var trTag = $( '<tr class="addedTrData" ugid="' + userGroupId + '"><td style="width: 300px;">' + userGroupName + '</td><td style="text-align: right;"><span>' + typeDesc + '</span> <input type="image" class="userGroupRemove dimImgWHover inputImg" alt="Remove User Group" title="Remove User Group" src="img/cross.png" style="border: 0px solid;"/></td></tr>' );


			// Remove Event
			trTag.find( 'input.userGroupRemove' ).click( function()
			{
				if ( me.removeSecurityFunc !== undefined )
				{
					var parentTrTag = $( this ).closest( 'tr.addedTrData' );
					
					var userGroupId = parentTrTag.attr( 'ugid' );

					me.removeSecurityFunc( userGroupId, function() 
					{
						parentTrTag.remove();
					});
				}
			});


			return trTag;
		};


		me.retrieveUserGroupName = function( id, returnFunc )
		{
			var queryUrl = _queryURL_api + 'userGroups/' + id + '.json?fields=name';

			$.get( queryUrl, function( json_Data )
			{
				returnFunc( json_Data.name );
			});
		};

		me.userGroupLoad = function( listTag, loadingTag, runFunc )
		{
			var queryURL = _queryURL_api + "userGroups.json?paging=false&fields=id,name,displayName";

			RESTUtil.retrieveManager.retrieveData( queryURL
			, function( json_data ) 
			{
				Util.populateSelect( listTag, "User Group", json_data.userGroups );

				runFunc();
			}
			, function() {}
			, function() { loadingTag.show(); }
			, function() { loadingTag.hide(); }			
			);
		};


		me.checkExistingDuplicateCase = function( userGroupId, tableTag )
		{
			var caseCount = tableTag.find( 'tr.addedTrData[ugid="' + userGroupId + '"]' ).length;

			return ( caseCount > 0 );
		};

		// --------------------------------------------------------------

		me.FormPopupSetup = function()
		{
			// -- Set up the form --
			me.dialogFormTag.dialog({
			  autoOpen: false
			  ,title: "Security settings"
			  ,width: me.width
			  ,height: me.height				  
			  ,modal: true				
			  ,close: function( event, ui ) 
				{
					$( this ).dialog( "close" );
				}

			});		
		};


		me.setup_Events = function()
		{
			me.addSecurityUserGroupAccessTag.click( function()
			{
				var selectedVal = me.securityUserGroupsTag.val();
				var viewEditChocie = me.securityViewEditChioceTag.val();

				if ( selectedVal != "" )
				{
					var userGroupName = me.securityUserGroupsTag.find( 'option:selected' ).text();

					// Check for existing duplicate case..
					var alreadyExists = me.checkExistingDuplicateCase( selectedVal, me.sharingAccessTableTag );

					if ( alreadyExists )
					{
						alert( 'The selected user group, \'' + userGroupName + '\', was already added to the list before.' );
					}
					else
					{
						var newPermission = { 'id': selectedVal, 'type': viewEditChocie };

						//me.oProviderNetwork.viewServiceManager.addViewSecurityPermissions( 
						if ( me.addSecurityFunc !== undefined )
						{
							me.addSecurityFunc( newPermission, function()
							{						
								var trTag = me.getNewRow( userGroupName, selectedVal, viewEditChocie );

								me.sharingAccessTableTag.find( 'tbody' ).append( trTag );
							});
						}
					}
				}
			});


			me.anybodyViewDisableTag.click( function()
			{
				if ( me.anybodyViewSecurityFunc !== undefined )
				{
					me.anybodyViewSecurityFunc( false, function()
					{
						me.populateAnybodyViewPermission( false, me.sharingAccessTableTag );
					});
				}
			});

			me.anybodyViewEnableTag.click( function()
			{
				if ( me.anybodyViewSecurityFunc !== undefined )
				{
					me.anybodyViewSecurityFunc( true, function()
					{
						me.populateAnybodyViewPermission( true, me.sharingAccessTableTag );
					});
				}
			});

		};


		// Initial Setup Call
		me.initialSetup = function()
		{			
			me.FormPopupSetup();

			me.setup_Events();
		};

		// --------------------------
		// Run methods

		// Initial Run Call
		me.initialSetup();

	}

	// Class - Security Setting Popup Form
	// -------------------------------------------



	// -------------------------------------------
	// Class - ConfigDialogForm
	//		- Used for popup Config Form

	function ConfigDialogForm()
	{
		var me = this;

		me.dialogFormTag = $( "#configDialogForm" );

		me.spanCurrentVersionTag = $( '#spanCurrentVersion' );
		me.trLatestVersionTag = $( '#trLatestVersion' );
		me.latestVersionTag = $( '#latestVersion' );

		me.width = me.dialogFormTag.attr( 'formWidth' );
		me.height = me.dialogFormTag.attr( 'formHeight' );

		me.dbSettingName = "App_ProviderNetwork_AppConfigData";

		me.configData;


		me.FormPopupSetup = function()
		{
			// -- Set up the form -------------------
			me.dialogFormTag.dialog({
			  autoOpen: false
			  ,dialogClass: "noTitleStuff"
			  ,width: me.width
			  ,height: me.height				  
			  ,modal: true				
			  ,buttons: {
				"Save": function() {
					var dialogForm = $( this );


					var json_SettingData = ( me.configData !== undefined ) ? me.configData : { }; 

					json_SettingData.latestVersion = me.latestVersionTag.val();

					
					DBSetting.saveSettingValue( me.dbSettingName, json_SettingData
					, function()
					{
						me.configData = json_SettingData;
						dialogForm.dialog( "close" );
					}
					, function()
					{
						alert( "Failed to save the configuration information." );		
					});	
				
				}
				,"Close": function()
				  {
					$( this ).dialog( "close" );
				  }

			  }				
			});		
		}


		me.openForm = function( status )
		{
			me.populateSettingData();

			me.dialogFormTag.dialog( "open" );
		}


		me.populateSettingData = function()
		{
			if ( me.configData !== undefined )
			{
				if ( me.configData.latestVersion !== undefined )
				{
					me.latestVersionTag.val( me.configData.latestVersion );
				}
			}
		}


		me.getSettingData = function( execFunc )
		{
			if ( me.configData !== undefined )
			{
				execFunc( me.configData );
			}
			else
			{
				DBSetting.getSettingValue( me.dbSettingName
				, function( json_Data ) 
				{
					me.configData = json_Data;

					execFunc( me.configData );
				}
				, function( json_Data ) 
				{
					execFunc( me.configData );
				}
				, "noErrorMsg" );
			}
		}


		me.checkIfNotLastVersion = function( json_Data )
		{
			// If the user is deploymentManager, show the version as editable
			if ( json_Data !== undefined && Util.checkValue( json_Data.latestVersion ) )
			{
				//get current version..
				var currentVersion = me.spanCurrentVersionTag.text();

				if ( currentVersion != json_Data.latestVersion )
				{
					message = 'This is old cached version, v ' + currentVersion + '.  Please refresh the browser to get the latest version, v ' + json_Data.latestVersion + '.';

					alert( message ); 

					MsgManager.msgAreaShow( message );
				}				
			}
		}


		me.checkForLatestVersion = function()
		{
			me.getSettingData( function( json_Data )
			{
				me.checkIfNotLastVersion( json_Data );
			});
		}


		// Initial Setup Call
		me.initialSetup = function()
		{		
			me.FormPopupSetup();
		}

		// --------------------------
		// Run methods

		// Initial Run Call
		me.initialSetup();

	}

	// Class - SettingForm
	// -------------------------------------------


	// -------------------------------------------
	// Class - View Link Popup Form

	function LoginPagePopupForm()
	{
		var me = this;

		me.dialogFormTag = $( '#loginPageDialogForm' );

		me.btnLoginPageTag = $( '#btnLoginPage' );

		me.width = me.dialogFormTag.attr( 'formWidth' );
		me.height = me.dialogFormTag.attr( 'formHeight' );


		// ---------------------------------------

		me.setUp_Events = function()
		{
			me.btnLoginPageTag.click( function()
			{
				window.location.href = _dhisURL;
			});
		}

		me.FormPopupSetup = function()
		{
			// -- Set up the form --
			me.dialogFormTag.dialog(
			{
				autoOpen: false
				,title: "Login Session Expired"
				,width: me.width
				,height: me.height				  
				,dialogClass: "noTitleClose"
				,modal: true				
				,close: function( event, ui ) 
				{
					alert( "Please click 'Login Page' button and login again." );
					//$( this ).dialog( "close" );
				}
			});		
		};

		me.openForm = function()
		{
			me.dialogFormTag.dialog( "open" );
		};


		// Initial Setup Call
		me.initialSetup = function()
		{			
			me.FormPopupSetup();

			me.setUp_Events();
		};

		// --------------------------
		// Run methods

		// Initial Run Call
		me.initialSetup();

	}

	// Class - View Link Popup Form
	// -------------------------------------------

	// -------------------------------------------
	// Classes - AnalyticRelated Classes

	// Classes - AnalyticRelated Classes
	// -------------------------------------------



	// ========================================================
	// ========================================================
	// Classes - Supporting Popups/Etc...


	// -------------------------------------
	// -- Static Classes - Message Manager Class

	function MsgManager() {}


	// --- App block/unblock ---
	MsgManager.cssBlock_Body = { 
		border: 'none'
		,padding: '15px'
		,backgroundColor: '#000'
		,'-webkit-border-radius': '10px'
		,'-moz-border-radius': '10px'
		,opacity: .5
		,color: '#fff'
		,width: '200px'
	};

	MsgManager.appBlock = function( msg )
	{
		if ( !Util.checkValue( msg ) ) msg = "Processing..";

		FormBlock.block( true, msg, MsgManager.cssBlock_Body );
	};

	MsgManager.appUnblock = function()
	{
		FormBlock.block( false );
	};


	// --- Messaging ---
	MsgManager.divMsgAreaTag;
	MsgManager.spanMsgAreaCloseTag;
	MsgManager.btnMsgAreaCloseTag;
	MsgManager.spanMsgAreaTextTag;

	// TODO: Rename these as 'NetworkListMsg'
	MsgManager.divNetworkListingMsg_loadingTag;
	MsgManager.divNetworkListingMsgTag;
	MsgManager.divNetworkListingMsgAreaTag;


	MsgManager.initialSetup = function()
	{
		MsgManager.divMsgAreaTag = $( '#divMsgArea' );
		MsgManager.spanMsgAreaCloseTag = $( '#spanMsgAreaClose' );
		MsgManager.btnMsgAreaCloseTag = $( '#btnMsgAreaClose' );
		MsgManager.spanMsgAreaTextTag = $( '#spanMsgAreaText' );
	
		MsgManager.divNetworkListingMsg_loadingTag = $( '#divNetworkListingMsg_loading');
		MsgManager.divNetworkListingMsgTag = $( '#divNetworkListingMsg' );
		MsgManager.divNetworkListingMsgAreaTag = $( '.divNetworkListingMsgArea' );

		MsgManager.searchTextBoxTdTag = $( '#searchTextBoxTd' );
			

		MsgManager.btnMsgAreaCloseTag.click( function()
		{
			MsgManager.divMsgAreaTag.hide( 'fast' );
		});
	};

	MsgManager.msgAreaShow = function( msg )
	{
		MsgManager.divMsgAreaTag.hide( 'fast' );
		MsgManager.spanMsgAreaTextTag.text( '' );

		MsgManager.spanMsgAreaTextTag.text( msg );
		MsgManager.divMsgAreaTag.show( 'medium' );

		console.log( ' ==[MsgArea]: ' + msg );


		if ( _appSetting.msgAutoHide ) {

			// Call to hide once after some time...
			Util.delayOnceTimeAction( 5000, 'msgArea', function() {

				MsgManager.divMsgAreaTag.hide( 'fast' );
			});
		}
	};


	MsgManager.networkListingMsgShow = function( msgText, hideLoadingCircle, closeAfter, performRightAway )
	{
		// if message has not changed, do nothing..
		if ( msgText != MsgManager.divNetworkListingMsgTag.html() )
		{
			var actionSpeed = ( performRightAway !== undefined && performRightAway ) ? '' : 'fast';

			MsgManager.networkListingMsgHide( performRightAway );


			MsgManager.divNetworkListingMsgTag.html( msgText );

			MsgManager.divNetworkListingMsgAreaTag.show( actionSpeed );

			if ( hideLoadingCircle === undefined || !hideLoadingCircle ) MsgManager.divNetworkListingMsg_loadingTag.show();

			// Need to be canceled if 'MsgShow' is called again...
			//if ( closeAfter !== undefined ) setTimeout( MsgManager.networkListingMsgHide, closeAfter );
		}
	};

	MsgManager.networkListingMsgHide = function( performRightAway )
	{
		//var actionSpeed = ( performRightAway !== undefined && performRightAway ) ? '' : 'fast';
		//MsgManager.divNetworkListingMsgAreaTag.hide( actionSpeed );

		MsgManager.divNetworkListingMsg_loadingTag.hide();
		MsgManager.divNetworkListingMsgTag.html( '' );

		MsgManager.divNetworkListingMsgAreaTag.hide();
	};

	// -- End of Message Manager Class
	// -------------------------------------


	// -------------------------------------------
	// Static Class - AppUtil

	function AppUtil() {}

	AppUtil.dynamicAttrStr = "dynamicAttr_";

	AppUtil.ajaxGetRequests = [];

	
	AppUtil.getDhisVersion = function( returnFunc )
	{		
		// set the data..
		var queryURL = _queryURL_api + "system/info";

		RESTUtil.getAsynchData( queryURL, function( json_Data )
		{ 
			returnFunc( parseFloat( json_Data.version ) );
		}
		, function() 
		{
			alert( 'Failed to retrieve DHIS version info.' );
		});
	}


	AppUtil.getArrayFromTags = function( tags, attr )
	{
		var list = [];

		// put it on array
		tags.each( function()
		{
			list.push( $( this ).attr( attr ) );
		});

		return list;
	};


	AppUtil.getPreviousRowIdInfo = function( rowIdList, rowId )
	{
		var previousIdInfo;	// { rowId: 3, location: right/left }

		// get previousRowId (from left or right of it) with location info
		if ( Util.checkValue( rowIdList ) )
		{
			for ( i = 0; i < rowIdList.length; i++ )
			{
				if ( rowIdList[i] == rowId )
				{
					if ( i == 0 )
					{
						// Get next one as previousRowId
						previousRowIdInfo = { rowId: rowIdList[ i + 1 ], loc: 'right' }
					}
					else
					{
						// Get next one as previousRowId
						previousRowIdInfo = { rowId: rowIdList[ i - 1 ], loc: 'left' }
					}

					break;
				}
			}
		}

		return previousIdInfo;
	};


	AppUtil.getDynamicAttrId = function( typeValue )
	{
		var dynamicAttrId = "";

		if ( typeValue.indexOf( AppUtil.dynamicAttrStr ) != -1 )
		{
			dynamicAttrId = typeValue.replace( AppUtil.dynamicAttrStr, "" );
		}

		return dynamicAttrId;
	};


	AppUtil.getNetworkLevel_ByNetworkType = function( networkType, networkData, oProviderNetwork )
	{
		var orgUnitLevel = 0;

		if ( networkType == oProviderNetwork.network_Name )
		{
			orgUnitLevel = networkData.Network_LVL;
		}
		else if ( networkType == oProviderNetwork.networkChild_Name )
		{
			orgUnitLevel = networkData.NetworkChild_LVL;
		}

		return orgUnitLevel;
	};


	AppUtil.getOrgUnitLevelName = function( level, oProviderNetwork )
	{
		var name = "";

		$.each( oProviderNetwork.loadedInfo.orgUnitLevelsInfo, function( i_oul, item_oul )
		{
			if ( item_oul.level == level )
			{
				name = item_oul.name;
				return false;
			}
		});

		return name;
	}


	AppUtil.getOrgUnitLevelName_ByNetworkType = function( networkType, networkData, oProviderNetwork )
	{
		return AppUtil.getOrgUnitLevelName( AppUtil.getNetworkLevel_ByNetworkType( networkType, networkData, oProviderNetwork ), oProviderNetwork );
	}


	AppUtil.getNetworkTypeName_ByViewColumnType = function( viewColumnType, oProviderNetwork )
	{
		var networkTypeName = "";

		if ( viewColumnType == "OrgUnitAttr" )
		{
			networkTypeName = oProviderNetwork.network_Name;
		}
		else if ( viewColumnType == "OrgUnitAttr_NC" )
		{
			networkTypeName = oProviderNetwork.networkChild_Name;
		}

		return networkTypeName;
	}


	AppUtil.formatValByType = function( typeValue, value )
	{
		return ( typeValue == "openingDate" || typeValue == "closedDate" ) ? value.substring( 0, 10 ) : value;
	}


	// ---- 'Cancel' Ajax Requests Related ---- 

	AppUtil.abortAndClear_XhrRequest = function( xhrRequests )
	{
		$.each( xhrRequests, function( i_xhr, item_xhr )
		{
			item_xhr.abort();
		});

		return [];
	}

	AppUtil.getAsynchData_WithPush = function( url, actionSuccess, actionError, loadingStart, loadingEnd ) 
	{
		AppUtil.ajaxGetRequests.push( RESTUtil.getAsynchData( url, actionSuccess, actionError, loadingStart, loadingEnd ) );
	}


	AppUtil.getAsynchDataText_WithPush = function( url, actionSuccess, actionError, loadingStart, loadingEnd ) 
	{
		AppUtil.ajaxGetRequests.push( RESTUtil.getAsynchData_DataType( url, 'text', actionSuccess, actionError, loadingStart, loadingEnd ) );
	}


	AppUtil.cancelGetAsynchDataRequests = function()
	{
		AppUtil.ajaxGetRequests = AppUtil.abortAndClear_XhrRequest( AppUtil.ajaxGetRequests );
	}


	// ---- 'Ancestors' copy to 'Parents' Related ---- 

	AppUtil.copyAncestorsToParents = function( ouList )
	{
		if ( ouList.length > 0 
			&& ouList[0].parents === undefined 
			&& ouList[0].ancestors !== undefined 
			)
		{
			$.each( ouList, function( i_ou, item_ou )
			{
				item_ou.parents = item_ou.ancestors;
			});
		}
	}

	AppUtil.copyAncestorsToParents_Single = function( orgUnit )
	{
		if ( orgUnit !== undefined && orgUnit.parents === undefined 
			&& orgUnit.ancestors !== undefined 
			)
		{
			orgUnit.parents = orgUnit.ancestors;
		}			
	}


	// ---- 'DHIS' connection Check Related ---- 

	AppUtil.checkAndRedirect_DHISSession = function( returnFunc )
	{
		var queryURL = _queryURL_api + "me.json?fields=id";

		RESTUtil.getAsynchData( queryURL, function( json_Data )
		{ 
			returnFunc(); 
		}
		, function() 
		{
			_loginPagePopupForm.openForm();
		});
	}

	AppUtil.getOUTagClass = function( tag )
	{
		var clazz = tag.attr( "class" );
		if( clazz != undefined )
		{
			var clazzNames = clazz.split(" ");
			for( var i=0; i<clazzNames.length; i++ )
			{
				var name = clazzNames[i];
				if( name.indexOf("ouAdd_")>=0 || name.indexOf("dynamicAttr_")>=0 || name.indexOf("ougs_")>=0 ){
					return name;
				}
			}
		}
		
		return "";
	}


	AppUtil.disableRowMoving = function( trAttributeRowTags )
	{
		trAttributeRowTags.each( function()
		{
			var trRowTag = $( this );

			// Disabling (by inserting empty hidden td) before Row move is applied.
			if ( trRowTag.find( 'td.disableMoving' ).length == 0 ) trRowTag.prepend( '<td class="disableMoving" style="display:none;"></td>' );

			// This is for being called after already applied
			trRowTag.find( 'td.dragHandle,td.dimImgWHover' ).removeClass( 'dragHandle' ).removeClass( 'dimImgWHover' );
			trRowTag.addClass( 'nodrag nodrop' );
		});
	}


	AppUtil.replaceObjectValue = function( obj, removalStr )
	{
		for ( var propName in obj )
		{
			var value = obj[ propName ];
			
			if ( $.type( value ) === "string" )
			{
				obj[ propName ] = value.replace( removalStr, "" );
			}
		}
	};


	AppUtil.getAnalyticValue = function( json_Data, headerName )
	{
		var dataVal = "";

		if ( json_Data.rows.length > 0 )
		{
			var headers = json_Data.headers;

			for ( var i = 0; i < headers.length; i++ )
			{
				var header = headers[ i ];

				if ( header.name == headerName )
				{
					dataVal = json_Data.rows[0][ i ];
					break;
				}
			}
		}

		return dataVal;
	};

	// Placed here instead of 'Util' for cache issue for now.
	AppUtil.startsWith = function( input, suffix )
	{
		return ( Util.checkValue( input ) && input.substring( 0, suffix.length ) == suffix );
	};

	// Static Class - AppUtil
	// -------------------------------------------

	// -------------------------------------------
	// -- Static Classes - DB Setting Related

	function DBSetting() {}
	
	DBSetting._queryURL_SystemSettings = _queryURL_api + "systemSettings/";

	DBSetting.getSettingValue = function( settingName, successFunc, failFunc, option )
	{
		RESTUtil.getAsynchData( DBSetting._queryURL_SystemSettings + settingName
		, function( data )
		{
			successFunc( data );
		}
		, function( failMsg )
		{
			if ( !( option !== undefined && option == "noErrorMsg" ) )
			{
				console.log( '[DBSetting.getSettingValue] Failed to get data from systemSettings/' + settingName + '.  Info: ' + JSON.stringify( failMsg ) );
			}

			failFunc( failMsg );
		});
	}

	DBSetting.saveSettingValue = function( settingName, jsonData, successFunc, failFunc )
	{
		RESTUtil.submitData_Text( DBSetting._queryURL_SystemSettings + settingName, jsonData
		,successFunc, failFunc );
	}


	// -- Static Classes - DB Setting Related
	// -------------------------------------------

</script>

</head>

<body>

<div id="mainBodyDiv">

	<div id="header">
		<img id="headerBanner" src="img/logo_banner.png" style="cursor:pointer" title="View home page">
		<span id="headerText" style="cursor:pointer" title="View home page"></span>
		<div id="headerRightSideControls">

			<table>
				<tr>
					<td>
						<div class='configControlSection' style="display:none;">
							<button id='configPopupFormOpen' type="button">Config</button> |
						</div>
					</td>
					<!--<td>
						<div class='settingControlSection' style="display:none;">
							<div id='divControlsPopupFormOpen' style="display:none;">
								<button type="button" id='controlsPopupFormOpen'>Controls</button> | 
							</div>
						</div>
					</td>-->
					<td>
						<div class='settingControlSection' style="display:none;">
							<button id='settingPopupFormOpen' type="button">Setting</button> |
						</div>
					</td>
					<td>						
						<a href="https://docs.google.com/document/d/12S_hAUSepS7fpHw7y92pm-wsa4MkS2LF6pwNraPrgUY" target="_blank" style="color: White;">v <span id="spanCurrentVersion">0.123</span></a>
						| <button type="button" id="closeButton"><span nameId='closeButton'>Close</span></button>
					</td>
				</tr>
			</table>
		</div>
	</div>

	<div style="margin-top: 40px;">

		<div>		
			<table>
			<tr>
			<td>
				<span nameId='sectionNetworkList' style="font-size: 13px; font-weight: bold;">Network:</span>
				&nbsp;<select id="sectionNetworkList"></select> 
				<div id='sectionNetworkListLoading' style='display:none;'>
					<img src='img/ui-anim_basic.gif'/>
				</div>
			</td>
			<td>

				<div id="divViewOUSearchSection" style="display:none; clear: both; margin-left: 6px;">
				  
				  <table>
				  <tr>
				    <td>
						<span style="border-left: 1px solid #AAAAAA;"></span>
					</td>
					<td>

					  <div id="divViewSection" style="margin-left: 5px; padding-right:4px; padding-left:4px; border-radius: 4px;">

					    <table>
						<tr>
							<td>
							  <span class="divSectionTitle">View: </span>
							</td>
							<td>
							  <div id="divNetworkViewList" style="margin-left: 3px;">
								<table>
								<tr>
									<td>
										<select id="networkViewList">
											<option>Select View</option>
											<option>Test View 1</option>
											<option>Test View 2</option>
											<option>Test View 3</option>
										</select> 
									</td>
									<td>
										<div id="divViewAssociatedButtons" style="margin-right: 7px;">
											<table>
											<tr>
												<td>
													<button type="button" id="runBtn" class="steelBlueButton" style="width: 60px;">Run</button>
												</td>
												<td>
													<button type="button" id="viewColumnsPopupOpen" style="display: none; margin-left: 10px;">Columns</button>
												</td>
												<td>
													<button type="button" id="viewManagePopupOpen" style="display: none; margin-left: 5px;">Manage</button>
												</td>
												<td>
													<button type="button" id="viewLinkPopupOpen" style="margin-left: 5px;">Link</button>
												</td>

											</tr>
											</table>
										</div>
									</td>
									<td>
										<button type="button" id="viewCreatePopupOpen" style="display:none;">New</button>
									</td>
								</tr>
								</table>
						
							  </div>
							</td>
					      </tr>
						  </table>

						</div>
					</td>
					<td>

						<div id="divOuSearchSection" style="background-color: #F7FBFF; border: 1px solid LightGray; margin-left: 10px; padding-right:4px; padding-left:4px; border-radius: 4px;"> 

							<table>
							<tr>
							  <td>
								<span class="divSectionTitle">OrgUnit Search:</span>
							  </td>
							  <td style="white-space: nowrap;">
								<div id="divOuSearch" style="margin-left: 4px;">
									<input type="search" id="orgUnitName" size="30" placeholder="Type Network/Child Name" style="background-color: #FFF; padding-left: 3px;" /><input type="button" id="orgUnitTreeBtn" value="T" title="Open OrgUnitTree" style="cursor:pointer; margin:0px; padding:1px 2px; color:#777777; background-color: #DAE4FF; border-left: none; display:none;">
								</div>
							  </td>
							  <td>
								<div id='orgUnitLoading' style='display:none'>
									<img src='img/ui-anim_basic.gif'/><span>retrieving..</span>
								</div>
							  </td>
							 </tr>
							 </table>

						</div>
					</td>
				  </tr>
				  </table>

					<!-- Copy & Rename & Delete should only appear on selection -->
					<!-- Also need user ownership to show - rename/delete -->
				</div>

			</td>
			<td>
				<div id="divMsgArea" style="display: none;">
					<span id="spanMsgAreaClose"><img src="img/hide.png" title="Close" id="btnMsgAreaClose"></span>
					<span id="spanMsgAreaText"></span>
				</div>
			</td>
			</tr>
			</table>
			

			<div id="mainContent" style="display:none; clear: both; ">

				<div id="divDataListing" style="display:none; margin-top: 1px; margin-right:10px;">

					<table style="min-width:460px;" >
					<tr>
						<td>
							<hr noshade size="1" align="left" style="border-color: #DDD;">
						</td>
					</tr>
					<tr>
						<td>
							<table width="100%" style="margin-top:0px;">
								<tr>
									<td>
										<table>
										<tr>
										  <td height="30px;">

											<div class="divNetworkListingMsgArea" style="margin-right: 10px;">
												<table>
												<tr>
													<td>
														<div id="divNetworkListingMsg_loading" style="display: none; margin-left: 1px; margin-right: 3px;">
															<img src="img/ui-anim_basic.gif">
														</div>
													</td>
													<td>
														<div id="divNetworkListingMsg" style="margin-left: 3px; color: #333; font-style: italic; font-size: 12px;">
														</div>										
													</td>
												</tr>
												</table>
											</div>
									      </td>
										</tr>
										</table>

									</td>
									<td align="right" id='searchTextBoxTd'>
										Search: <input type="text" id="searchTextBox" size="15" /> <span id="searchResult" title="# of Search Found" style="color: Gray;"></span>
										&nbsp;<a id="excelDownload" class="grayButton smallButton" title="Excel Download" download="networkData.xls" href="#" >Excel</a>
									</td>
								</tr>
								
							</table>

						</td>
					</tr>
					<tr>
						<td>
							<table id="datatable" class="tbDataListingTable dataListTable alternateColor tablesorter" style="min-width:500px; margin-top: 0px; display:none;" >
								<thead></thead>
								<tbody></tbody>
								<tfoot></tfoot>
							</table>
						</td>
					</tr>
					</table>

					<br>
					<br>

				</div>
			</div>

		</div>

	<div>


	<div id="dialog-loading" style="display:none;">
		<table border="0" cellpadding="0" cellspacing="0" align="right" valign="top">
		<tr>
		<td><a id="forceClose" href="" style="color:Tomato;font-size:75%;">[X]</a></td>
		</tr>
		</table>
		<table border="0" cellpadding="0" cellspacing="0" width="180px" height="100%" align="center" valign="middle">
			<tr valign="middle">
				<td height="50px" valign="middle" align="right">
					<img src="img/loading_big_blue.gif" alt="Loading" />
				</td>
				<td height="50px" valign="middle" align="left" style="font-size: medium;">
					&nbsp;&nbsp;- Processing... Please Wait
				</td>
			</tr>
		</table>
	</div>

	<div id="controlsDialogForm" class="ui-widget" formWidth="450" formHeight="200" style="margin:0;padding:0;display:none;"">

		<div style="margin-left: 6px; margin-top: 9px;">
			<table id="view_Table" class="listTable0" style="width:95%;">
			<tbody>

				<tr>
					<td><span title="Makes individual requests for each orgUnit and attributes.  ">Individual Data Retrieval</span></td>
					<td>
						<input type="checkbox" id="useIndividualDataRetrieval" />
					</td>
				</tr>

				<tr id="enableEditOrgunitTR" style="display:none;">
					<td>Enable Orgunit Edit</td>
					<td>
						<input type="checkbox" id="enableEditOrgunit" checked />
					</td>
				</tr>

				<tr id="enableAppSecretUserModeTR" style="display:none;">
					<td>Enable App SecretUser Mode</td>
					<td>
						<input type="checkbox" id="enableAppSecretUserMode" checked />
					</td>
				</tr>

			</tbody>
			</table>
		</div>
	</div>

	<div id="settingDialogForm" class="ui-widget" formWidth="700" formHeight="540" style="margin:0;padding:0;display:none;">

		<div id="settingDataEditDiv" style="display:none;padding-left:15px;">

			<textarea cols="87" rows="24" id="settingDataEdit" ></textarea>
			<br>
			<button id="settingDataEdit_Save" type="button">Save</button>
			<button id="settingDataEdit_Cancel" type="button">Cancel</button>

		</div>

		<div id="mainSec" style="margin-top: 5px; margin-left: 4px; margin-right: 4px;">
			
			<div style="text-align: right; margin-right: 0px;">
				<select id="settingMode" style="background-color: #DDD;">
					<option value="network">Network</option>
					<option value="script">Script</option>
					<option value="htmlTab">HtmlTab</option>
				</select>
			</div>


			<div id="divSettingMode_Script" style="display:none;">

				<table width="100%">
				  <tr>
					<td>

						<table>
							<tr>
								<td>
									<span style="color:#555555;"><b>Script:</b></span>
								</td>
								<td>
									<select id="scriptList"></select>
								</td>
								<td>
									&nbsp;
								</td>
								<td>
									<button type="button" id="btnAddScript" class="grayButton" style="display:none;">Add Script</button>
								</td>
								<td>
									&nbsp;&nbsp;
								</td>
								<td>
									<table>
									  <tr>
										<td>
											<div id="tdScriptAdd" style="display:none;">
												<table>
													<tr>
														<td>
															<input type="text" id="scriptName" placeholder="Set Script Name Here!!" />
														</td>
														<td>
															&nbsp;<button type="button" id="btnCreateScript" class="steelBlueButton">Create</button>
														</td>
														<td>
															&nbsp;<button type="button" id="btnCreateScript_Cancel" class="steelBlueButton">Cancel</button>
														</td>
													</tr>
												</table>
											</div>
										</td>
									  </tr>
									</table>
								</td>
							</tr>
						</table>
					
					</td>
				</tr>
				</table>


				<div style="border: 1px solid LightGray; margin-top:5px;">
				<!--padding-top: 10px; padding-bottom: 30px; padding-right: 10px; padding-left: 8px;">-->

					<div id="divScriptMainContent" style="display:none; margin: 13px 10px 13px 10px;" >

						<table class="tblScriptData listTable_D1"  style="font-size:small; margin-left:0px; margin-top:3px;" width="100%">
							<thead>
								<tr class="trHeader" style="font-size: 1px;">
									<th width='30%' style="font-size: 1px;">&nbsp;</th>
									<th width='70%' style="font-size: 1px;">&nbsp;</th>
								</tr>
							</thead>
							<tbody>

								<tr class="trScriptSetting">
									<td valign="top" class="scriptNameTd" style="background-color: #fafafa;">
										<span style="color: #555; font-weight: bold;">Script</span>
									</td>
									<td valign="top" style="background-color: #fff;">
										
										<table class="tbNone">
										  <tr>
											<td>
												<span class="spanScriptName" style="margin-right: 5px; font-color: #555; font-weight: bold;"> Script-Name </span> <span style="font-weight: bold;">|</span>
											</td>
											<td>

												<div id="divScriptSetting" style="margin-left: 9px;" >

													<table class="tbNone"> 
													<tr>
														<td>
															<div id="divRenameScript" style="margin-left: 1px; margin-right: 5px;">
																<button id="btnScriptRenameShow" type="button" style="font-size:11px;">Rename</button>
															</div>
														</td>
														<td>
															<div id="divDeleteScript" style="margin-right: 5px;">
																<button type="button" id="btnDeleteScript" class="redButton" disabled style="font-size:11px; background-color: silver; cursor: context-menu;">Delete</button>
															</div>
														</td>
														<td>
															<div id="divSecurityScript">
																<button type="button" id="btnSecurityScript" class="steelBlueButton" disabled style="font-size:11px; background-color: silver; cursor: context-menu;" >Security</button>
															</div>
														</td>
													  </tr>
													</table>
												</div>
											</td>
										  </tr>
										</table>

									</td>
								</tr>

								<tr>
									<td valign="top" style="background-color: #fafafa;">
										<span style="color: #555; font-weight: bold;">Script Content</span>

										<div style="margin-top: 10px; margin-bottom: 7px; text-decoration: underline;">Reserved variables</div>
										<div style="color: #555; font-size: 11px;">
												<div class="scriptTooltipNote" title="var orgUnitId = '[ouid]';">[ouid]</div>
												 <div class="scriptTooltipNote" title="var tabScriptManager = new TabScriptManager( $( 'div[HtmlTabId]' ) );">[HtmlTabId]</div>
												 <div class="scriptTooltipNote" title="console.log( '_script_CountryOuid': ' + _script_CountryOuid );">_script_CountryOuid</div>
												 <div class="scriptTooltipNote" title="_fromScriptCallFunc = function( returnFunc ){  ... returnFunc( orgUnitsJSON  );  }">_fromScriptCallFunc</div>
										</div>

									</td>
									<td valign="top" style="background-color: #fff;">
										<div style="padding: 5px;">
											<textarea id="txtScriptData" cols="70" rows="18" style="background-color: #FFF;" ></textarea>
										</div>

										<div style="text-align: center; margin-top: 1px; margin-bottom: 3px;">
											<button type="button" id="btnScriptSave" class="steelBlueButton" >Save</button>
										</div>
					
									</td>
								</tr>

							</tbody>
						</table>

					</div>
				</div>

			</div>


			<div id="divSettingMode_HtmlTab" style="display:none;">

				<table width="100%">
				  <tr>
					<td>

						<table>
							<tr>
								<td>
									<span style="color:#555555;"><b>Html Tab:</b></span>
								</td>
								<td>
									<select id="htmlTabList"></select>
								</td>
								<td>
									&nbsp;
								</td>
								<td>
									<button type="button" id="btnAddHtmlTab" class="grayButton" style="display:none;">Add Html Tab</button>
								</td>
								<td>
									&nbsp;&nbsp;
								</td>
								<td>
									<table>
									  <tr>
										<td>
											<div id="tdHtmlTabAdd" style="display:none;">
												<table>
													<tr>
														<td>
															<input type="text" id="htmlTabName" placeholder="Set Html Tab Name Here!!" />
														</td>
														<td>
															&nbsp;<button type="button" id="btnCreateHtmlTab" class="steelBlueButton">Create</button>
														</td>
														<td>
															&nbsp;<button type="button" id="btnCreateHtmlTab_Cancel" class="steelBlueButton">Cancel</button>
														</td>
													</tr>
												</table>
											</div>
										</td>
									  </tr>
									</table>
								</td>
							</tr>
						</table>
					
					</td>
				</tr>
				</table>


				<div style="border: 1px solid LightGray; margin-top:5px;">
				<!--padding-top: 10px; padding-bottom: 30px; padding-right: 10px; padding-left: 8px;">-->

					<div id="divHtmlTabMainContent" style="display:none; margin: 13px 10px 13px 10px;" >

						<table class="tblHtmlTabData listTable_D1"  style="font-size:small; margin-left:0px; margin-top:3px;" width="100%">
							<thead>
								<tr class="trHeader" style="font-size: 1px;">
									<th width='30%' style="font-size: 1px;">&nbsp;</th>
									<th width='70%' style="font-size: 1px;">&nbsp;</th>
								</tr>
							</thead>
							<tbody>

								<tr class="trHtmlTabSetting">
									<td valign="top" class="htmlTabNameTd" style="background-color: #fafafa;">
										<span style="color: #555; font-weight: bold;">Html Tab</span>
									</td>
									<td valign="top" style="background-color: #fff;">
										
										<table class="tbNone">
										  <tr>
											<td>
												<span class="spanHtmlTabName" style="margin-right: 5px; font-color: #555; font-weight: bold;"> HtmlTab-Name </span> <span style="font-weight: bold;">|</span>
											</td>
											<td>

												<div id="divHtmlTabSetting" style="margin-left: 9px;" >

													<table class="tbNone"> 
													<tr>
														<td>
															<div id="divRenameHtmlTab" style="margin-left: 1px; margin-right: 5px;">
																<button id="btnHtmlTabRenameShow" type="button" style="font-size:11px;">Rename</button>
															</div>
														</td>
														<td>
															<div id="divDeleteHtmlTab" style="margin-right: 5px;">
																<button type="button" id="btnDeleteHtmlTab" class="redButton" disabled style="font-size:11px; background-color: silver; cursor: context-menu;">Delete</button>
															</div>
														</td>
														<td>
															<div id="divSecurityHtmlTab">
																<button type="button" id="btnSecurityHtmlTab" class="steelBlueButton" disabled style="font-size:11px; background-color: silver; cursor: context-menu;" >Security</button>
															</div>
														</td>
													  </tr>
													</table>
												</div>
											</td>
										  </tr>
										</table>

									</td>
								</tr>

								<tr>
									<td valign="top" style="background-color: #fafafa;">
										<span style="color: #555; font-weight: bold;">HtmlTab Content</span>
									</td>
									<td valign="top" style="background-color: #fff;">
										<div style="padding: 5px;">
											<div style="margin-bottom: 3px; color: #555; font-size: 11px; font-style: italic;">* Use '[ouid]' for inserting orgUnit Id.  ex. var testStr = 'ougUnit: ' + '[ouid]';</div>
											<textarea id="txtHtmlTabData" cols="70" rows="18" style="background-color: #FFF;" ></textarea>
										</div>

										<div style="text-align: center; margin-top: 1px; margin-bottom: 3px;">
											<button type="button" id="btnHtmlTabSave" class="steelBlueButton" >Save</button>
										</div>
					
									</td>
								</tr>

							</tbody>
						</table>

					</div>
				</div>

			</div>

			<div id="divSettingMode_Network">

				<table width="100%">
				  <tr>
					<td>

						<table>
							<tr>
								<td>
									<span style="color:#555555;"><b>Network:</b></span>
								</td>
								<td>
									<select id="sectionList"></select>
								</td>
								<td>
									<div id="settingDataEditLinkDiv" style="display:none;" >
										<a id="settingDataEditLink" title="View/Edit Source Data" href="" style="color: #ccc">[s]</a>
									</div>
								</td>
								<td>
									<div id="settingDataClearLinkDiv" style="display:none;" >
										<a id="settingDataClearLink" title="Clear Setting Data" href="" style="color: #ccc;">[c]</a>
									</div>
								</td>
								<td>
									&nbsp;
								</td>
								<td>
									<button type="button" id="btnAddNetwork" class="grayButton" style="display:none;">Add Network</button>
								</td>
								<td>
									&nbsp;&nbsp;
								</td>
								<td>
									<table>
									  <tr>
										<td>
											<div id="tdNetworkAdd" style="display:none;">
												<table>
													<tr>
														<td>
															<input type="text" id="networkName" placeholder="Set Network Name Here!!" />
														</td>
														<td>
															&nbsp;<button type="button" id="btnCreateSection" class="steelBlueButton">Create</button>
														</td>
														<td>
															&nbsp;<button type="button" id="btnCreateSection_Cancel" class="steelBlueButton">Cancel</button>
														</td>
													</tr>
												</table>
											</div>
										</td>
									  </tr>
									</table>
								</td>
							</tr>
						</table>
					
					</td>
					<td align="right">
						<div id="divSettingDataChanged" style="display: none; font-weight: bold; color: White; background-color: Red; display: -webkit-inline-box; padding: 3px 10px;">[Changed]</div>
					</td>
				</tr>
				</table>

				<div style="border: 1px solid LightGray; margin-top:5px;">

					<div id="divSettingMainContent" style="display:none; margin-top:10px; margin-left:4px; margin-right: 4px;">

						<div id="networkSettingTabs" class="tabStyle_Simple">
							<ul>
								<li code="details"><a class="tabAnchor" href="#Sec1">Network Setup</a></li>
								<li code="network_Attr"><a class="tabAnchor" href="#Sec2">Network Details</a></li>
								<li code="networkChild_Attr"><a class="tabAnchor" href="#Sec3">Network Child Details</a></li>
							</ul>

							<div class="networkSettingTab" code="details" id="Sec1">

								<table class="tblNetworkSetting listTable_D1"  style="font-size:small; margin-left:0px; margin-top:3px;" width="100%">
									<thead>
										<tr class="trHeader" style="font-size: 1px;">
											<th width='30%' style="font-size: 1px;">&nbsp;</th>
											<th width='70%' style="font-size: 1px;">&nbsp;</th>
										</tr>
									</thead>
									<tbody>

										<tr class="trNetworkSetting">
											<td valign="top" class="settingNameTd">
												<span>Network</span>
											</td>
											<td valign="top">
												
												<table class="tbNone">
												  <tr>
													<td>
														<span class="spanNetworkName" style="margin-right: 5px; font-color: #555; font-weight: bold;"> Network-Name </span> <span style="color: #999; font-weight: bold;">|</span>
													</td>
													<td>

														<div id="divNetworkSettingSection" style="display:none; margin-left: 9px;" >

															<table class="tbNone"> 
															<tr>
																<td>
																	<div id="divNetworkRenameSection" style="display:none; margin-left: 1px; margin-right: 5px;">
																		<button id="btnNetworkRenameShow" type="button" style="font-size:11px;">Rename</button>
																	</div>
																</td>
																<td>
																	<div id="divDeleteSection" style="display: none; margin-right: 5px;">
																		<button type="button" id="deleteSection" class="redButton" style="font-size:11px;">Delete</button>
																	</div>
																</td>
																<td>
																	<div id="divSecuritySection">
																		<button type="button" id="securitySection" class="steelBlueButton" style="font-size:11px;">Security</button>
																	</div>
																</td>
															  </tr>
															</table>
														</div>
													</td>
												  </tr>
												</table>

											</td>
										</tr>

										<tr class="trData" settingtype="Country_LVL" mandatory="Y">
											<td valign="top" class="settingNameTd">
												<span class="settingName">Country Level</span><span title="Mandatory" class="mandatory">*</span>
											</td>
											<td valign="top">
												<select class="settingValue" mandatory="true"></select>
											</td>
										</tr>

										<tr class="trData" settingtype="CountryID" mandatory="Y">
											<td valign="top" class="settingNameTd">
												<span class="settingName">Country</span><span title="Mandatory" class="mandatory">*</span>
											</td>
											<td valign="top">
												<select class="settingValue" mandatory="true"></select>
											</td>
										</tr>

										<tr class="trData" settingtype="Network_LVL" mandatory="Y">
											<td valign="top" class="settingNameTd">
												<span class="settingName">Network Level</span><span title="Mandatory" class="mandatory">*</span>
											</td>
											<td valign="top">
												<select class="settingValue" mandatory="true"></select>
											</td>
										</tr>

										<tr class="trData" settingtype="Network_OUGroup">
											<td valign="top" class="settingNameTd">
												<span class="settingName">Network OrgUnitGroup</span>
											</td>
											<td valign="top">
												<div style="display: inline;">
													<select class="settingValue"></select>
												</div>
												<div style="display: inline;">
													<div class="dataLoading" style="display:none;"><img src="img/ui-anim_basic.gif"></div>
												</div>											
											</td>
										</tr>

										<tr class="trData" settingtype="NetworkChild_Use">
											<td valign="top" class="settingNameTd">
												<span class="settingName">NetworkChild Use</span>
											</td>
											<td valign="top">
												<select class="useNetworkChild settingValue">
													<option value="">No</option>
													<option value="Y">Yes</option>
												</select>
											</td>
										</tr>

										<tr class="trData" settingtype="NetworkChild_OUGroup">
											<td valign="top" class="settingNameTd">
												<span class="settingName">NetworkChild OrgUnitGroup</span>
											</td>
											<td valign="top">
												<div style="display: inline;">
													<select class="settingValue"></select>
												</div>
												<div style="display: inline;">
													<div class="dataLoading" style="display:none;"><img src="img/ui-anim_basic.gif"></div>
												</div>											
											</td>
										</tr>

										<tr class="trData" settingtype="CoordinateMapShow">
											<td valign="top" class="settingNameTd">
												<span class="settingName">Coordinate Map Show</span>
											</td>
											<td valign="top">
												<div style="display: inline;">
													<select class="settingValue">
														<option value="">None</option>
														<option value="ReadOnly">Read-Only</option>
														<option value="Editable">Editable</option>
													</select>
												</div>
											</td>
										</tr>

										<tr class="trData" settingtype="OUGroupsTabShow">
											<td valign="top" class="settingNameTd">
												<span class="settingName">OU Groups Tab Show</span>
											</td>
											<td valign="top">
												<div style="display: inline;">
													<select class="settingValue">
														<option value="">None</option>
														<option value="ReadOnly">Read-Only</option>
														<option value="ReadWrite">Read Write</option>
													</select>
												</div>
											</td>
										</tr>

										<tr class="trData" settingtype="ProgramsDataSetsTabShow">
											<td valign="top" class="settingNameTd">
												<span class="settingName">Programs & DataSets Tab</span>
											</td>
											<td valign="top">
												<div style="display: inline;">
													<select class="settingValue">
														<option value="">None</option>
														<option value="ReadOnly">Read-Only</option>
														<option value="ReadWrite">Read Write</option>
													</select>
												</div>
											</td>
										</tr>

										<tr class="trData" settingtype="Analytics">
											<td valign="top" class="settingNameTd">
												<span class="settingName">Analytics</span>
											</td>
											<td valign="top">
												<div style="display: inline;">
													<select class="settingValue">
														<option value="">None</option>
														<option value="Enable">Enable</option>
													</select>
												</div>
											</td>
										</tr>



									</tbody>
								</table>

							</div>


							<div class="networkSettingTab" code="network_Attr" id="Sec2">

								<table class="tblNetworkSetting listTable_D1"  style="margin-left:0px; margin-top:3px;" width="100%">
									<thead>
										<tr class="trHeader" style="font-size: 1px;">
											<th width='20%' style="font-size: 1px;">&nbsp;</th>
											<th width='80%' style="font-size: 1px;">&nbsp;</th>
										</tr>
									</thead>
									<tbody>
										<tr class="trData" settingtype="Network_Attr">
											<td valign="top" class="settingNameTd">
												<span class="settingName">Fields</span>
											</td>
											<td valign="top">
												<table class="tblNetworkAttributes tbPadding2" style="margin-left: 10px; margin-top: 5px;" networktype="Network_Attr">
													<thead>
														<tr>
															<th>&nbsp;</th>
															<th class="thShow">Type</th>
															<th class="thShow">Value</th>
															<th class="thShow">ReadOnly</th>
															<th>&nbsp;</th>
														</tr>
													</thead>
													<tbody>
													</tbody>
												</table> 

												<div style="margin-top: 7px; margin-left: 110px; margin-bottom: 10px;">  
													<button type="button" class="addNewRow_Attributes steelBlueButton">Add Fields</button> 
												</div>
											</td>
										</tr>

										<tr class="scriptAction Network" area="NetworkScripts">
											<td valign="top" class="settingNameTd">
												<span>Script Choice</span>
											</td>
											<td valign="top">

												<table class="tbPadding4" style="margin-left: 10px; margin-top: 5px; margin-bottom: 10px;">
													<thead>
														<tr>
															<th width="130px">Action</th>
															<th width="150px">Script</th>
														</tr>
													</thead>
													<tbody>
														<tr>
															<td align="right">Before Creation:</td>
															<td><select class="scriptSelection" action="BeforeCreation"></select></td>
														</tr>
														<tr>
															<td align="right">After Creation:</td>
															<td><select class="scriptSelection" action="AfterCreation"></select></td>
														</tr>
														<tr>
															<td align="right">Before Edit:</td>
															<td><select class="scriptSelection" action="BeforeUpdate"></select></td>
														</tr>
														<tr>
															<td align="right">After Edit:</td>
															<td><select class="scriptSelection" action="AfterUpdate"></select></td>
														</tr>
													</tbody>
												</table> 
											</td>
										</tr>

										<tr class="trData HtmlTabList" settingtype="Network_HtmlTab">
											<td valign="top" class="settingNameTd">
												<span class="settingName">HtmlTabs</span>
											</td>
											<td valign="top">

												<table class="tblNetworkHtmlTab tbPadding2" style="margin-left: 10px; margin-top: 5px;" networktype="Network_HtmlTab">
													<thead>
														<tr>
															<th>&nbsp;</th>
															<th class="thShow">Tab Title</th>
															<th class="thShow">Html Content</th>
															<th class="thShow">Javascript</th>
															<th>&nbsp;</th>
														</tr>
													</thead>
													<tbody>
													</tbody>
												</table> 

												<div style="margin-top: 7px; margin-left: 110px; margin-bottom: 10px;">  
													<button type="button" class="addNewRow_HtmlTab steelBlueButton">Add HtmlTab</button> 
												</div>

											</td>
										</tr>

									</tbody>
								</table>

							</div>

							<div class="networkSettingTab" code="networkChild_Attr" id="Sec3">

								<div class="divNetworkChildAttributesHideNote" style="display:none; text-align:center; margin-top: 10px;">
									<span style="font-weight: bold; color: #555;">*'NetworkChild Use' was not selected, thus, this section is hidden.</span>
								</div>
								<div class="divNetworkChildAttributes" style="display:none;">

									<table class="tblNetworkSetting listTable_D1"  style="margin-left:0px; margin-top:3px;" width="100%">
										<thead>
											<tr class="trHeader" style="font-size: 1px;">
												<th width='20%' style="font-size: 1px;">&nbsp;</th>
												<th width='80%' style="font-size: 1px;">&nbsp;</th>
											</tr>
										</thead>
										<tbody>

											<tr class="trData" settingtype="NetworkChild_Attr">
												<td valign="top" class="settingNameTd">
													<span class="settingName">Fields</span>
												</td>
												<td valign="top">
													<table class="tblNetworkAttributes tbPadding2" style="margin-left: 10px; margin-top: 5px;" networktype="NetworkChild_Attr">
														<thead>
															<tr>
																<th>&nbsp;</th>
																<th class="thShow">Type</th>
																<th class="thShow">Value</th>
																<th class="thShow">ReadOnly</th>
																<th>&nbsp;</th>
															</tr>
														</thead>
														<tbody>
														</tbody>

													</table> 
													
													<div style="margin-top: 7px; margin-left: 110px; margin-bottom: 10px;">  
														<button type="button" class="addNewRow_Attributes steelBlueButton">Add Fields</button> 
													</div>
												</td>
											</tr>

											<tr class="scriptAction NetworkChild" area="NetworkChildScripts">
												<td valign="top" class="settingNameTd">
													<span>Script Choice</span>
												</td>
												<td valign="top">

													<table class="tbPadding4" style="margin-left: 10px; margin-top: 5px; margin-bottom: 10px;">
														<thead>
															<tr>
																<th width="130px">Action</th>
																<th width="150px">Script</th>
															</tr>
														</thead>
														<tbody>
															<tr>
																<td align="right">Before Creation:</td>
																<td><select class="scriptSelection" action="BeforeCreation"></select></td>
															</tr>
															<tr>
																<td align="right">After Creation:</td>
																<td><select class="scriptSelection" action="AfterCreation"></select></td>
															</tr>
															<tr>
																<td align="right">Before Edit:</td>
																<td><select class="scriptSelection" action="BeforeUpdate"></select></td>
															</tr>
															<tr>
																<td align="right">After Edit:</td>
																<td><select class="scriptSelection" action="AfterUpdate"></select></td>
															</tr>
														</tbody>
													</table> 
												</td>
											</tr>

											<tr class="trData HtmlTabList" settingtype="NetworkChild_HtmlTab">
												<td valign="top" class="settingNameTd">
													<span class="settingName">HtmlTabs</span>
												</td>
												<td valign="top">

													<table class="tblNetworkHtmlTab tbPadding2" style="margin-left: 10px; margin-top: 5px;" networktype="NetworkChild_HtmlTab">
														<thead>
															<tr>
																<th>&nbsp;</th>
																<th class="thShow">Title</th>
																<th class="thShow">Selection</th>
																<th>&nbsp;</th>
															</tr>
														</thead>
														<tbody>
														</tbody>
													</table> 

													<div style="margin-top: 7px; margin-left: 110px; margin-bottom: 10px;">  
														<button type="button" class="addNewRow_HtmlTab steelBlueButton">Add HtmlTab</button> 
													</div>

												</td>
											</tr>


										</tbody>
									</table>

								</div>

							</div>
													
						</div>

					</div>	

					<br>

				</div>
			</div>
				
		</div>
	</div>


	<div id="networkRenameDialogForm" class="ui-widget" formWidth="450" formHeight="100" style="margin:0;padding:0;display:none;">
		
		<table class="listTable_OuEdit" width="98%" align="center" style="margin-top: 10px;">
			<tbody>
				<tr>
					<td>
						<span style="font-weight: bold; font-size: 12px; color:#555555;">Network Name:</span>
					</td>
					<td>
						&nbsp;<input id="inputNetworkRename" type="text" style="background-color: White;" size="30" />
						<button id="btnNetworkRenameChange" type="button" class="steelBlueButton" style="margin-left: 2px; font-size:11px;" >Change</button>
					</td>
				</tr>
			</tbody>
			</table>
		</div>
	</div>

	<div id="scriptRenameDialogForm" class="ui-widget" formWidth="450" formHeight="100" style="margin:0;padding:0;display:none;">
		
		<table class="listTable_OuEdit" width="98%" align="center" style="margin-top: 10px;">
			<tbody>
				<tr>
					<td>
						<span style="font-weight: bold; font-size: 12px; color:#555555;">Script Name:</span>
					</td>
					<td>
						&nbsp;<input id="inputScriptRename" type="text" style="background-color: White;" size="30" />
						<button id="btnScriptRenameChange" type="button" class="steelBlueButton" style="margin-left: 2px; font-size:11px;" >Change</button>
					</td>
				</tr>
			</tbody>
			</table>
		</div>
	</div>

	<div id="htmlTabRenameDialogForm" class="ui-widget" formWidth="450" formHeight="100" style="margin:0;padding:0;display:none;">
		
		<table class="listTable_OuEdit" width="98%" align="center" style="margin-top: 10px;">
			<tbody>
				<tr>
					<td>
						<span style="font-weight: bold; font-size: 12px; color:#555555;">Script Name:</span>
					</td>
					<td>
						&nbsp;<input id="inputHtmlTabRename" type="text" style="background-color: White;" size="30" />
						<button id="btnHtmlTabRenameChange" type="button" class="steelBlueButton" style="margin-left: 2px; font-size:11px;" >Change</button>
					</td>
				</tr>
			</tbody>
			</table>
		</div>
	</div>

	<div id="viewCreateDialogForm" class="ui-widget" formWidth="400" formHeight="150" style="margin:0;padding:0;display:none;">

		<div style="margin-left: 6px; margin-top: 12px;">
			<table id="view_Table" class="listTable0" style="width:95%;">
			<tbody>
				<tr>
					<td>View Name</td><td><input type="text" id="viewCreateName" class="inputWhite" size="40"></input></td>
				</tr>
			</tbody>
			</table>
		</div>
	</div>


	<div id="viewManagePopupForm" class="ui-widget" formWidth="550" formHeight="310" style="margin:0;padding:0;display:none;"">

		<div style="margin-left: 6px; margin-top: 6px;">
			<table class="listTable0" style="width:97%;">
			<tbody>
				<tr>
					<td align="center">
						<button type="button" id="viewCopy" style="margin-top:3px; margin-bottom:3px;">Copy The View</button>
						&nbsp;
						<button type="button" id="viewRename" style="margin-top:3px; margin-bottom:3px;">Rename The View</button>
						&nbsp;
						<button type="button" id="viewChangePivot" style="display: none; margin-top:3px; margin-bottom:3px;">Change Pivot</button>
						&nbsp;
						<button type="button" id="viewSetSecurity" style="margin-top:3px; margin-bottom:3px;">Set Security</button>
						&nbsp;
						<button type="button" id="viewDelete" class="redButton" style="margin-top:3px; margin-bottom:3px;">Delete The View</button>	
					</td>
				</tr>
			</tbody>
			</table>
		</div>

		<br>

		<div id="divViewCopySection" style="margin-left: 6px; margin-top: 12px; display: none;">

			<table class="listTable0" style="width:97%;">
			<tbody>
				<tr>
					<td style="background-color: #e9e9e9;">
						<span style="color: #555; font-weight: bold;">Copy The View</span>
					</td>
				</tr>
				<tr>
					<td height="20px" valign="middle" style="background-color: #f9f9f9;">
						<div align="center" style="margin-top:10px;">
							New View Copy Name: &nbsp;<input type="text" id="viewCopyName" size="45" class="inputWhite" style="padding-left: 5px;" />
						</div>

						<div align="center" style="margin-top: 14px; margin-bottom: 10px;">
							<button type="button" id="viewCopyBtn" class="steelBlueButton" style="width: 100px;">Copy</button>
						</div>
					</td>
				</tr>
			</tbody>
			</table>
		</div>

		<div id="divViewRenameSection" style="margin-left: 6px; margin-top: 12px; display: none;">
			
			<table class="listTable0" style="width:97%;">
			<tbody>
				<tr>
					<td style="background-color: #e9e9e9;">
						<span style="color: #555; font-weight: bold;">Rename The View</span>
					</td>
				</tr>
				<tr>
					<td height="20px" valign="middle" style="background-color: #f9f9f9;">
						<div align="center" style="margin-top:10px;">
							The View Rename: &nbsp;<input type="text" id="viewRenameName" size="45" class="inputWhite" style="padding-left: 5px;" />
						</div>

						<div align="center" style="margin-top: 14px; margin-bottom: 10px;">
							<button type="button" id="viewRenameBtn" class="steelBlueButton" style="width: 100px;">Rename</button>
						</div>
					</td>
				</tr>
			</tbody>
			</table>
		</div>

		<div id="divViewSetSecuritySection" style="margin-left: 6px; margin-top: 12px; display: none;">
			
			<table class="listTable0" style="width:97%;">
			<tbody>
				<tr>
					<td style="background-color: #e9e9e9;">
						<span style="color: #555; font-weight: bold;">Set Security</span>
					</td>
				</tr>
				<tr>
					<td height="20px" valign="middle" style="background-color: #f9f9f9;">
						<div align="center" style="margin-top:10px;">
							<table>
							<tr>
								<td style="border: none;">
									User Group: &nbsp;<select id="viewUserGroupSelect"></select>
								</td>
								<td style="border: none;">
									<div id='divViewUserGroupLoading' style='display:none'>
										<img src='img/ui-anim_basic.gif'/>
									</div>
								</td>
							</tr>
							</table>
						</div>

						<div align="center" style="margin-top: 14px; margin-bottom: 10px;">
							<button type="button" id="viewSetSecurityBtn" class="steelBlueButton" style="width: 100px;">Set</button>
						</div>
					</td>
				</tr>
			</tbody>
			</table>
		</div>

		<div id="divViewChangePivotSection" style="margin-left: 6px; margin-top: 12px; display: none;">
			
			<table class="listTable0" style="width:97%;">
			<tbody>
				<tr>
					<td style="background-color: #e9e9e9;">
						<span style="color: #555; font-weight: bold;">Change Pivot</span>
					</td>
				</tr>
				<tr>
					<td height="40px" valign="middle" style="background-color: #f9f9f9;">
						<div align="center" style="margin-top:10px;">
							Pivot: <select id="viewChangePivotSelect"></select>
						</div>
					</td>
				</tr>
			</tbody>
			</table>
		</div>

	</div>


	<div id="viewColumnsPopupForm" class="ui-widget" formWidth="650" formHeight="480" style="margin:0;padding:0;display:none;">

		<div style="margin-left: 6px; margin-top: 6px;">

				<table style="min-width:520px;">
				<tr>
					<td>

					<table>
					  <tr>
						<td>
							<div id="viewColumnsOuterDiv">

								<div id="viewColumnsDiv" style="border: 1px solid #AAA; padding: 8px; min-width:460px;">
								
									<table id="viewColumnsTable" class="listTable_viewColumn" style="margin-top:5px;">
									<thead>
										<tr class="trHeader">
											<th>&nbsp;</th>
											<th>Title</th>
											<th>Type</th>
											<th>Value</th>
											<th>Sort</th>
											<th>Filter</th>
											<th></th>
										</tr>
									</thead>
									<tbody></tbody>
									</table>

									<div id="divViewPivot_OUGroupUse" style="display:none;margin-top:5px;">&nbsp;&nbsp;<span style="font-style: italic; font-size: 11px; color: #333333;"></span></div>
	
									<div style="margin-top:10px;">
										<button type="button" id="addNewRow_ViewColumns" class="steelBlueButton">Add new row</button>
									</div>

									<div style="margin-top:25px; display: none;">
										Pivot: <select id="viewPivot"></select>
									</div>

								</div>
								
								
								<fieldset style="border: 1px solid #AAA; padding-left: 2px; padding-right: 2px; margin-top: 15px; min-width:460px;padding: 8px;">
									
									<legend>Filter By OrgUnit Group</legend>
									
									<table>
										<tbody id='viewOrgunitFilterTB'>
										
										</tbody>
										<tr>
											<td colspan='3'>
												<button type="button" id="addViewOrgunitGroupFilter">Add filter</button>
											</td>
											<td>
												<button type="button" id="applyOUGroupFilterBtn" class="steelBlueButton">Re-Run with Filter</button>
											</td>
										</tr>
									</table>
									
								</fieldset>

							</div>
								
						</td>
					  </tr>
					</table>
					
					</td>
				</tr>
				</table>
		</div>
	</div>

	
	<div id="filterValuePopup" class="ui-widget" formWidth="600" formHeight="170" style="margin:0;padding:0;display:none;">
	
		<table id="viewColumnFilterTable" class="listTable_OuEdit" style="margin-top:10px;">
			<tr>
				<td>Operator <span class="required">*</span></td>
				<td>
					<select id="filterOperator" style='width:222px;'>
						<option value="">[Please select]</option>
						<option value="begins_with">Begins with</option>
						<option value="ending_with">Ending with</option>
						<option value="within">Wihin</option>
						<option value="not_within">Not within</option>
						<option value="diff">&lt;&gt;</option>
						<option value="equals">== </option>
						<option value="less_than">&lt;</option>
						<option value="less_equals">&lt;=</option>
						<option value="greater_than">&gt;</option>
						<option value="greater_equals">&gt;=</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>Filter <span class="required">*</span></td>
				<td><input type="text" id="filterValue" style='width:220px;'/></td>
			</tr>
		</table>
	</div>
	
	<div id="viewLinkDialogForm" class="ui-widget" formWidth="500" formHeight="200" style="margin:0;padding:0;display:none;">

		<div align="center" style="margin-left: 6px; margin-top: 12px;">
			<table id="view_Table" class="listTable0" style="width:95%;">
			<tbody>
				<tr>
					<td height="80px" valign="middle">
						<textarea id="viewLinkUrl" cols="62" rows="3" readonly="readonly" style="background-color: #FFF;" ></textarea>
					</td>
				</tr>
			</tbody>
			</table>
		</div>
	</div>


	<div id="orgUnitInfoDialogForm" class="ui-widget" formWidth="670" formHeight="620" style="margin:0;padding:0;display:none;">

		<div id="orgUnitAddTitle" style="margin-left:5px; margin-top:5px; margin-bottom: 10px; font-weight:bold; font-size:15px;">Org Unit Info</div>
		
		
		<div style="border: 1px solid LightGray; margin-top:5px;">

			<div id="orgUnitAddTab" class="tabStyle_Simple" style="margin: 5px; width: 640px;" ouid="" >
			  
			  <input type="hidden" id="parentOrgUnit">				

			  <ul id="orgUnitFormTabUl">
				<li><a href="#detailTab">Details</a></li>
				<li><a href="#programDataSetTab">Programs & Data sets</a></li>
				<li><a href="#orgUnitGroupTab">OrgUnit Groups</a></li>
			  </ul>

			  <div id="detailTab">

				<table id="ouDetailsTable" class="listTable_OuEdit">

					<tr id="searchParentOuTR">
						<td>Parent <span class="required">*</span></td>
						<td>
							<table class="tbNone">
							<tr>
							<td>
								<input type="text" id="parentOrgUnitSearch" class="ouForm" mandatory="true" hasMsgDiv="divParentOrgUnitMsg" size="57" placeholder="Type Parent OrgUnit Name Here.">
							</td>
							<td>
								<div id='parentOuLoading' style='display:none'>
									<img src='img/ui-anim_basic.gif'/>
								</div>
							</td>
							</tr>
							</table>
							<div id="divParentOrgUnitMsg" style="display: none; color: Red;">Please select a valid parent Org Unit</div>
						</td>
					</tr>

					<tr id="trOuCoordinateSection" style="display: none;">
						<td valign="top">
							<div>Coordinates</div>
						</td>
						<td>
							<table class="tbNone">
								<tr>
									<td style="padding: 2px 0px 2px 0px; background-color: #fff;">
										<input type="text" class="ouAdd_coordinates ouForm" size="50" placeholder="Coordinate" style="background-color:#fff;"> &nbsp;<span id="spanCoordinateInfo" title="Shape Type" style="color: Green;"></span>
									</td>	
								</tr>
								<tr id="trOuAdd_LocationFind">
									<td style="padding: 2px 0px 2px 0px;">
										<input type="text" size="60" id="searchLocation" class="ouForm" placeholder="Search" style="background-color:#fff;">
									</td>
								</tr>
								<tr id="divCountryBoundaryNotReady" style="display:none;">
									<td style="padding: 2px 0px 2px 0px;">
										<div id="divCountryBoundaryNotReady" style="font-weight:bold; color:Red;">
											*Country boundary is not available, yet!
										</div>
									</td>
								</tr>
								<tr id="trOuAdd_Map" style="display:none;">
									<td width="480px" style="padding: 2px 0px 2px 0px;">

										<div id="divCoordinateNote" style="display:none; color: gray; font-size: 10px; margin-bottom: 2px; text-align: right;">
											** Right mouse click on map to add/change coordinate.
										</div>

										<!-- This div does not set width? -->
										<div style="border:1px width:100px; height: 300px;">
												<div id="divOrgUnitMap" class="gmap3"></div>
										</div>			
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			  </div>

			  <div id="programDataSetTab">
				<table style="width:100%;" class="listTable_OuEdit" >
					<tr>
						<td><b>Program</b></td>
						<td>
							<table class="tbNone">
							<tr>
								<td>
									<div style="font-weight: bold;">AVAILABLE</div>
									<div style="margin-top: 4px;">
										<select id='avalableProgramAssignedOU' multiple style="border: 1px solid #999; width:250px; height: 150px; background-color: #fff;"></select>
									</div>
								</td>
								<td>
									&nbsp;&nbsp;&nbsp;
								</td>
								<td>
									<div style="font-weight: bold;">SELECTED</div>
									<div style="margin-top: 4px;">
										<select id='selectedProgramAssignedOU' multiple style="border: 1px solid #999; width:250px; height: 150px; background-color: #fff;"></select>
									</div>
								</td>
							</tr>
							</table>
						</td>
					</tr>
					
					<tr>
						<td><b>Data set</b></td>
						<td>					
							<table class="tbNone">
							<tr>
								<td>
									<div style="font-weight: bold;">AVAILABLE</div>
									<div style="margin-top: 4px;">
										<select id='avalableDatasetAssignedOU' multiple style="border: 1px solid #999; width:250px; height: 150px; background-color: #fff;"></select>
									</div>
								</td>
								<td>
									&nbsp;&nbsp;&nbsp;
								</td>
								<td>
									<div style="font-weight: bold;">SELECTED</div>
									<div style="margin-top: 4px;">
										<select id='selectedDatasetAssignedOU' multiple style="border: 1px solid #999; width:250px; height: 150px; background-color: #fff;"></select>
									</div>
								</td>
							</tr>
							</table>								
						</td>
					</tr>
				</table>
			  </div>
			  <div id="orgUnitGroupTab">
					<table style="width:100%;" class="listTable_OuEdit" >
						<tr>
							<td style="border-right:none;">
								<div style="font-weight: bold;">AVAILABLE</div>
								<div style="margin-top: 4px;">
									<select id='avalableOUGroupAssignedOU' multiple style="border: 1px solid #999; width:250px; height: 150px; background-color: #fff;"></select>
								</div>
							</td>
							<td  style="border-left:none;border-right:none;">
								&nbsp;&nbsp;&nbsp;
							</td>
							<td  style="border-left:none;">
								<div style="font-weight: bold;">SELECTED</div>
								<div style="margin-top: 4px;">
									<select id='selectedOUGroupAssignedOU' multiple style="border: 1px solid #999; width:250px; height: 150px; background-color: #fff;"></select>
								</div>
							</td>
						</tr>
					</table>
					
					<p style="color:gray;font-style:italic;">*** Please refresh page if OrgUnit Groups are added new or changed</p>
			  </div>

			</div>

		</div>
		
	</div>


	<div id="securitySettingDialogForm" class="ui-widget" formWidth="500" formHeight="340" style="margin:0;padding:0;display:none;">

		<div id="sharingSettings" style="width: auto;" class="page ui-dialog-content ui-widget-content">
			<table>
				<tbody>
					<tr>
						<td colspan="3" style="height: 40px"><span class="settingHeader" id="sharingName"></span></td>
					</tr>
					<tr>
						<td>
							<select id="securityUserGroups"></select>
						</td>
						<td>
							<select id="securityViewEditChioce">
								<option value="View">View</option>
								<option value="Edit">Edit</option>
							</select>
						</td>

						<td>
							<div id='securityUserGroups_loading' style='display:none'>
								<img src='img/ui-anim_basic.gif'/> loading..
							</div>
						</td>
						<td>
							<button id="addSecurityUserGroupAccess" style="width: 20px;">+</button>
						</td>
					</tr>
				</tbody>
			</table>

			<table id="sharingAccessTable" style="width: 450px; margin-top: 6px;">
				<tbody>
					<tr>
						<td colspan="2"><span class="tipText">Created by: </span><span class="tipText" title="" id="createdUser"></span></td>
					</tr>
					<tr class="trAnybody">
						<td style="width: 300px;">Anybody</td>
						<td style="text-align: right;"><span class="spanAnybodyViewDesc">Can View</span> <input ID="anybodyViewDisable" type="image" class="dimImgWHover inputImg" alt="Disable Anybody View" title="Disable Anybody View" src="img/cross.png" style="border: 0px solid;"/><input id="anybodyViewEnable" type="image" class="dimImgWHover inputImg" alt="Enable Anybody View" title="Enable Anybody View" src="img/add_small.png" style="border: 0px solid; display: none;"/>						
						</td>
					</tr>
				</tbody>
			</table>

		</div>

	</div>


	<div id="analyticEditDialogForm" class="ui-widget" formWidth="490" formHeight="530" style="margin:0;padding:0;display:none;">
		
		<table class="listTable_OuEdit" width="98%" align="center" style="margin-top: 10px;">
			<tr>
				<td width="82px">Data</td>
				<td>
					<select id="analyticsDataType" style="width:277px;">
						<option value="aggregatedDE">Aggregated data element</option>
						<option value="aggregatedIndicator">Aggregated indicator</option>
						<option value="eventDE">Event data element</option>
						<option value="eventIndicator">Event indicator</option>
					</select>
				</td>
			</tr>
			
			<!-- Aggregate && Event Analytic Data -->

			<tr id="aggDeRow" name="aggregateRow">
				<td>Data Element</td>
				<td>
					<input id="aggDeIdAutoComplete" style="width:277px;">
					<input id="aggDeId" type="hidden">
				</td>
			</tr>
			<tr id="aggIndicatorRow" style="display:none;" name="aggregateRow">
				<td>Indicator</td>
				<td>
					<input id="aggIndicatorIdAutoComplete" style="width:277px;">
					<input id="aggIndicatorId" type="hidden">
				</td>
			</tr>

			
			<!-- Event Analytic Data -->

			<tr name="eventAnalyticRow" style="display:none;">
				<td>Program</td>
				<td>
					<select id="programId" style="width:277px;"></select>
				</td>
			</tr>
			<tr name="eventAnalyticRow" style="display:none;">
				<td>Program Stage</td>
				<td>
					<select id="programStageId" style="width:277px;"></select>
				</td>
			</tr>

			<tr id="eventDeRow" name="eventAnalyticRow" style="display:none;">
				<td>Data Element</td>
				<td>
					<input id="eventDeIdAutoComplete" style="width:277px;">
					<input id="eventDeId" type="hidden">
				</td>
			</tr>
			<tr id="eventIndicatorRow" style="display:none;" name="eventAnalyticRow"  style="display:none;">
				<td>Indicator</td>
				<td>
					<input id="eventIndicatorIdAutoComplete" style="width:277px;">
					<input id="eventIndicatorId" type="hidden">
				</td>
			</tr>
			
			<!-- Legend -->

			<tr id="legendRow" style="display:none;">
				<td>Legend</td>
				<td>
					<select id="legend" style="width:277px;">
						<option value="no">No</option>
						<option value="colorCell">Colored Cell (background of the cell)</option>
						<option value="colorValue">Colored Value (Font Color)</option>
						<option value="trafficLight">Traffic Light - Right</option>
					</select>
				</td>
			</tr>
			
			<tr>
				<td>Period</td>
				<td>
					<select id="periodSelector" style="width:277px;">
						<option value="relativePe">Relative</option>
						<option value="fixedPe">Fixed</option>
					</select>
				</td>
			</tr>
			<tr id="relativePeriodRow">
				<td></td>
				<td style="padding-top:10px;">
					<table>
						<tr style="text-align:left">
							<th>Weeks</th>
							<th>Months</th>
							<th>Bi-months</th>
						</tr>
						<tr>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="THIS_WEEK">This week</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="THIS_MONTH">This month</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_BIMONTH">This bi-month</td>
						</tr>
						<tr>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_WEEK">Last week</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_MONTH">Last month</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_BIMONTH">Last bi-month</td>
						</tr>
						<tr>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_4_WEEKS">Last 4 weeks</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_3_MONTHS">Last 3 months</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_6_BIMONTHS">Last 6 bi-months</td>
						</tr>
						<tr>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_12_WEEKS">Last 12 weeks</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_6_MONTHS">Last 6 months</td>
							<td></td>
						</tr>
						<tr>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_52_WEEKS">Last 52 weeks</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_12_MONTHS">Last 12 months</td>
							<td></td>
						</tr>
						<tr style="text-align:left;padding-top:10px;">
							<th>Quarters</th>
							<th>Six-months</th>
							<th>Financial Years</th>
						</tr>
						<tr>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="THIS_QUARTER">This quarter</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="THIS_SIX_MONTH">This six-month</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="THIS_FINANCIAL_YEAR">This financial year</td>
						</tr>
						<tr>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_QUARTER">Last quarter</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_SIX_MONTHS">Last six-month</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_FINANCIAL_YEAR">Last financial year</td>
						</tr>
						<tr>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_4_QUARTERS">Last 4 quarters</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_2_SIX_MONTHS">Last 2 six-months</td>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_5_FINANCIAL_YEARS">Last 5 financial years</td>
						</tr>
						<tr style="text-align:left;padding-top:10px;">
							<th>Years</th>
							<th></th>
							<th></th>
						</tr>
						<tr>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="THIS_YEAR">This year</td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_YEAR">Last year</td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td><input type="checkbox" relativePeriod="relativePeriod" value="LAST_5_YEARS">Last 5 years</td>
							<td></td>
							<td></td>
						</tr>
					</table>
				</td>
			</tr>
			<tr id="fixedPeriodRow" style="display:none;">
				<td>Fixed Period</td>
				<td>
					<select id="periodType" style="width:100px;">
						<option value="Daily">Daily</option>
						<!-- option value="Weekly">Weekly</option -->
						<option value="Monthly">Monthly</option>
						<!-- option value="Bi-monthly">Bi-monthly</option -->
						<option value="Quarterly">Quarterly</option>
						<option value="SixMonthly">Six-monthly</option>
						<!-- option value="Six-monthly April">Six-monthly April</option -->
						<option value="Yearly">Yearly</option>
						<!-- option value="Financial October">Financial October</option -->
						<!-- option value="Financial July">Financial July</option -->
						<!-- option value="Financial April">Financial April</option -->
					</select>
					<select id="periodList" style="width:177px;"></select>
					<input id="periodDate" style="width:173px;" style="display:none;" />
				</td>
			</tr>

			
		
			<!-- Result Row -->

			<tr style="display:none;">
				<td>URL Generated </td>
				<td>
					<input id="urlLink" style="width:277px;" readonly>
				</td>
			</tr>
			
		</table>
		
		<p>
			<input id='urlLinkTD' style="padding-left:5px; border:0px; color:#eee; font-size:9px; width:98%;">
		</p>
		
		<p id="analyticsDataObjectNote" style="color:gray;font-style:italic;">** Default Aggregate Type is SUM</p>
		
		<!-- Successfull message -->
		<div id='successURLDiv' style="display:none; margin-left:10px; margin-top: 5px;">
			<table>
				<tr>
					<td>
						<div style="height: 14px; width: 14px; background-color: LightGreen;"></div> 
					</td>
					<td>
						<span style="margin-left: 5px; font-size: 13px; font-weight: bold; color: #777;">This analytic has been set up properly.</span>
					</td>
				</tr>
			</table>
		</div>
		
	</div>

	<div id="configDialogForm" class="ui-widget" formWidth="300" formHeight="150" style="display:none;">
		<b>App Configuration</b>
		<br>
		<br>
		<table id="configTable" class="listTable" style="width:95%;">
			<tr id="trLatestVersion">
				<td>Latest Version</td>
				<td>
					<input id="latestVersion" type="Text" size="6" />
				</td>
			</tr>
		</table>
	</div>

	<div id="loginPageDialogForm" class="ui-widget" formWidth="300" formHeight="160" style="margin:0;padding:0;display:none;">

		<div align="center" style="margin-left: 6px; margin-top: 12px;">
			<table class="listTable0" style="width:95%;">
			<tbody>
				<tr>
					<td height="80px" valign="middle">
						<div style="padding: 7px;">DHIS Login Session has expired. &nbsp;Please click below button to go to login page.</div>
						<div style="text-align: center; margin-top: 0px;">
							<button id="btnLoginPage" class="steelBlueButton">Login Page</button>
						</div>
					</td>
				</tr>
			</tbody>
			</table>
		</div>
	</div>

	
	<div id="orgUnitSelectionTreeDialogForm" class="ui-widget" style="margin:0;padding:0;display:none;">
		<table style="padding: 0; margin: 0;">
			<thead>
				<tr>
					<td>
						<select id="treeSelectedId" name="treeSelectedId" multiple="multiple" style="display:none"/>
					</td>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>											
						<div id="selectionTree"></div>	
					</td>
				</tr>
			</tbody>
		</table>

	</div>


	<div id="divRESTTest" style="display:none; clear: both; margin-top: 20px;">

		REST Call Test: <input id="inputRESTTest" type="Text" size="80"> &nbsp;<button id="btnRESTTest" type="button">Run</button>

		<div id='RESTTest_loading' style='display:none; margin-left: 10px;'>
			<img src='img/ui-anim_basic.gif'/> loading..
		</div>

	</div>


</div>

</body>

</html>
